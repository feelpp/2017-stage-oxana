var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function s(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),fft;!function(e){function t(e){return n(e).FFT()}function i(e){return n(e).InvFFT()}function s(e,t){return n(e).frequencyMap(t)}function n(e){return e instanceof y&&e||new y(e)}function r(e,t){var i=e.length;return i&i-1?o(e,t):a(e,t)}function o(e,t){var i=e.length;if(1===i)return e;for(var s=new y(i,e.ArrayType),n=u(i),o=i/n,a=1/Math.sqrt(n),h=new y(o,e.ArrayType),l=0;l<n;l++){for(g=0;g<o;g++)h.real[g]=e.real[g*n+l],h.imag[g]=e.imag[g*n+l];o>1&&(h=r(h,t));for(var c=Math.cos(2*f*l/i),m=(t?-1:1)*Math.sin(2*f*l/i),p=1,d=0,g=0;g<i;g++){var v=h.real[g%o],b=h.imag[g%o];s.real[g]+=p*v-d*b,s.imag[g]+=p*b+d*v,p=(w=[p*c-d*m,d=p*m+d*c])[0],d=w[1]}}for(g=0;g<i;g++)e.real[g]=a*s.real[g],e.imag[g]=a*s.imag[g];return e;var w}function a(e,t){for(var i=e.length,s=l(e),n=s.real,r=s.imag,o=1;o<i;){for(var a=Math.cos(f/o),h=(t?-1:1)*Math.sin(f/o),u=0;u<i/(2*o);u++)for(var c=1,m=0,p=0;p<o;p++){var d=2*u*o+p,g=d+o,y=n[d],b=r[d],w=c*n[g]-m*r[g],x=m*n[g]+c*r[g];n[d]=v*(y+w),r[d]=v*(b+x),n[g]=v*(y-w),r[g]=v*(b-x),c=(M=[c*a-m*h,c*h+m*a])[0],m=M[1]}o<<=1}return s;var M}function h(e,t){for(var i=0;t>1;)i<<=1,i+=1&e,e>>=1,t>>=1;return i}function l(e){for(var t=e.length,i=[],s=0;s<t;s++){var n=h(s,t);s in i||(r=[e.real[n],e.real[s]],e.real[s]=r[0],e.real[n]=r[1],o=[e.imag[n],e.imag[s]],e.imag[s]=o[0],e.imag[n]=o[1],i.push(n))}return e;var r,o}function u(e){for(var t=Math.sqrt(e),i=3;i<=t;){if(e%i==0)return i;i+=2}return e}function c(e,t,i){var s=m(e);return p(d(new y(s[0],Float32Array),t,i),d(new y(s[1],Float32Array),t,i),d(new y(s[2],Float32Array),t,i))}function m(e){for(var t=e.length/4,i=new Uint8ClampedArray(t),s=new Uint8ClampedArray(t),n=new Uint8ClampedArray(t),r=0;r<t;r++)i[r]=e[4*r],s[r]=e[4*r+1],n[r]=e[4*r+2];return[i,s,n]}function p(t,i,s){for(var n=t.length,r=new e.ComplexArray(4*n),o=0;o<n;o++)r.real[4*o]=t.real[o],r.imag[4*o]=t.imag[o],r.real[4*o+1]=i.real[o],r.imag[4*o+1]=i.imag[o],r.real[4*o+2]=s.real[o],r.imag[4*o+2]=s.imag[o];return r}function d(e,t,i,s){void 0===s&&(s=!1);for(var n=s?"InvFFT":"FFT",r=new y(e.length,e.ArrayType),o=new y(t,e.ArrayType),a=new y(i,e.ArrayType),h=0;h<i;h++)!function(i){o.map(function(s,n){s.real=e.real[n+i*t],s.imag=e.imag[n+i*t]}),o[n]().forEach(function(e,s){r.real[s+i*t]=e.real,r.imag[s+i*t]=e.imag})}(h);for(var l=0;l<t;l++)!function(e){a.map(function(i,s){i.real=r.real[e+s*t],i.imag=r.imag[e+s*t]}),a[n]().forEach(function(i,s){r.real[e+s*t]=i.real,r.imag[e+s*t]=i.imag})}(l);return r}var g=function(){function e(t,i){void 0===i&&(i=Float32Array),t instanceof e?(this.ArrayType=t.ArrayType,this.real=new this.ArrayType(t.real),this.imag=new this.ArrayType(t.imag)):(this.ArrayType=i,this.real=new this.ArrayType(t),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length}return e.prototype.toString=function(){var e=[];return this.forEach(function(t,i){e.push("("+t.real.toFixed(2)+", "+t.imag.toFixed(2)+")")}),"["+e.join(", ")+"]"},e.prototype.forEach=function(e){for(var t=this.length,i=Object.seal(Object.defineProperties({},{real:{writable:!0},imag:{writable:!0}})),s=0;s<t;s++)i.real=this.real[s],i.imag=this.imag[s],e(i,s,t)},e.prototype.map=function(e){var t=this;return this.forEach(function(i,s,n){e(i,s,n),t.real[s]=i.real,t.imag[s]=i.imag}),this},e.prototype.conjugate=function(){return new e(this).map(function(e){e.imag*=-1})},e.prototype.magnitude=function(){var e=new this.ArrayType(this.length);return this.forEach(function(t,i){e[i]=Math.sqrt(t.real*t.real+t.imag*t.imag)}),e},e}();e.BaseComplexArray=g;var f=Math.PI,v=Math.SQRT1_2;e.FFT=t,e.InvFFT=i,e.frequencyMap=s;var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.FFT=function(){return r(this,!1)},t.prototype.InvFFT=function(){return r(this,!0)},t.prototype.frequencyMap=function(e){return this.FFT().map(e).InvFFT()},t}(g);e.ComplexArray=y,e.FFTImageDataRGBA=c,e.FFT2D=d}(fft||(fft={}));var exports;!function(e){function t(e,t){return t<=1.5?t/2:(t-t*(2-t)/(3*e*(e*e-1))*(e-1)*(e-1)*(e+2))/2}function i(e,t,i,s){var n,r,o;s<=1.5?(n=0,r=1-(o=s/2)):(o=(s-(n=s*(2-s)/(3*i*(i*i-1)))*(i-1)*(i-1)*(i+2))/2,r=n*Math.pow(i-1,3)+1-o);var a=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]));return a<=1?r-Math.pow(a,s)+o*a*a:a<=i?n*Math.pow(i-a,3)/a:0}function s(e,s,n){void 0===e&&(e=100),void 0===s&&(s=2),void 0===n&&(n=.8);for(var r=e,o=[2*e-2,2*r-2],a=o[0],h=o[1],l=new Float32Array(a*h),u=[0,0],c=0;c<e;c++)for(w=0;w<r;w++)l[c*h+w]=i([c*s/e,w*s/r],u,s,2*n);for(c=1;c<e-1;c++)l[(a-c)*h]=l[c*h];for(w=1;w<r-1;w++)l[h-w]=l[w];for(c=1;c<e-1;c++)for(w=1;w<r-1;w++)l[(a-c)*h+w]=l[c*h+w],l[c*h+(h-w)]=l[c*h+w],l[(a-c)*h+(h-w)]=l[c*h+w];var m=fft.FFT2D(new fft.ComplexArray(l),h,a),p=random.randomGaussians(a*h),d=random.randomGaussians(a*h);m.map(function(e,t,i){e.real*=Math.sqrt(a*h),e.real/=a*h,e.real>=0?(e.imag=Math.sqrt(e.real)*p[t],e.real=Math.sqrt(e.real)*d[t]):(e.imag=Math.sqrt(-e.real)*d[t],e.real=-Math.sqrt(-e.real)*p[t])}),m=fft.FFT2D(m,h,a);for(var g=new Float32Array(e*r),c=0;c<e;c++)for(w=0;w<r;w++)g[c*r+w]=m.real[c*h+w]*Math.sqrt(a*h);for(var f=g[0],c=0;c<e*r;c++)g[c]-=f;for(var v=[random.nextGaussian(),random.nextGaussian()],y=v[0],b=v[1],c=0;c<e;c++)for(var w=0;w<r;w++)g[c*r+w]+=(c*s/e*y+w*s/r*b)*Math.sqrt(2*t(s,2*n));return g}function n(){for(var e=new Float32Array(2e4),t=0;t<2e4;t++)e[t]=1;var i=new fft.ComplexArray(e);(i=fft.FFT2D(i,100,200)).map(function(e,t,i){console.log(t," -> ",e.real," + ",e.imag,"i")})}e.genBrownian=s,e.test_fft=n}(exports||(exports={}));var random;!function(e){function t(e,t){void 0===e&&(e=0),void 0===t&&(t=1);var i;if(n)n=!1,i=s;else{var r=void 0,o=void 0,a=void 0;do{a=(r=2*Math.random()-1)*r+(o=2*Math.random()-1)*o}while(a>=1);a=Math.sqrt(-2*Math.log(a)/a),n=!0,s=o*a,i=r*a}return e+t*i}function i(e,i,s){void 0===i&&(i=0),void 0===s&&(s=1);var n=null;n=e instanceof Float32Array?e:new Float32Array(e);for(var r=0;r<n.length;r++)n[r]=t(i,s);return n}var s,n=!1;e.nextGaussian=t,e.randomGaussians=i}(random||(random={}));var mathis;!function(e){e.PI=Math.PI,e.cos=Math.cos,e.sin=Math.sin,e.exp=Math.exp,e.sqrt=Math.sqrt;var t=function(){function e(e,t){this.u=e,this.v=t}return e}();e.UV=t;var i=function(){function e(){this.m11=0,this.m12=0,this.m21=0,this.m22=0}return e.prototype.determinant=function(){return this.m11*this.m22-this.m21*this.m12},e.prototype.inverse=function(){var t=new e,i=this.determinant();return t.m11=this.m22/i,t.m22=this.m11/i,t.m12=-this.m12/i,t.m21=-this.m21/i,t},e.prototype.multiplyUV=function(e){return new t(this.m11*e.u+this.m12*e.v,this.m21*e.u+this.m22*e.v)},e}();e.M22=i;var s=function(t){function i(e,i,s){return t.call(this,e,i,s)||this}return __extends(i,t),i.resetDefaultNbDecimalForHash=function(){i.nbDecimalForHash=5},Object.defineProperty(i.prototype,"hashString",{get:function(){return e.roundWithGivenPrecision(this.x,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.y,i.nbDecimalForHash)+","+e.roundWithGivenPrecision(this.z,i.nbDecimalForHash)},enumerable:!0,configurable:!0}),i.newZero=function(){return new i(0,0,0)},i.newFrom=function(e){return null==e?null:new i(e.x,e.y,e.z)},i.newOnes=function(){return new i(1,1,1)},i.newRandom=function(){return new i(Math.random(),Math.random(),Math.random())},i.temp0=function(e,t,i){return n.copyFromFloats(e,t,i),n},i.temp1=function(e,t,i){return r.copyFromFloats(e,t,i),r},i.prototype.add=function(t){return e.geo.add(this,t,this),this},i.prototype.resizes=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},i.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},i.prototype.length=function(){return e.geo.norme(this)},i.prototype.lengthSquared=function(){return e.geo.squareNorme(this)},i.prototype.substract=function(t){return e.geo.substract(this,t,this),this},i.prototype.scale=function(t){return e.geo.scale(this,t,this),this},i.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},i.prototype.changeBy=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},i.prototype.normalize=function(){var t=e.geo.norme(this);if(t<e.geo.epsilon)throw"be careful, you have normalized a very small vector";return this.scale(1/t)},i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this,t)},i.prototype.toString=function(e){return void 0===e&&(e=2),"("+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+")"},i}(BABYLON.Vector3);s.lexicalOrder=function(e,t){return e.x!=t.x?e.x-t.x:e.y!=t.y?e.y-t.y:e.z!=t.z?e.z-t.z:0},s.lexicalOrderInverse=function(e,t){return-s.lexicalOrder(e,t)},s.nbDecimalForHash=5,e.XYZ=s;var n=new s(0,0,0),r=new s(0,0,0),o=function(t){function i(e,i,s,n){return t.call(this,e,i,s,n)||this}return __extends(i,t),i.prototype.multiply=function(t){return e.geo.quaternionMultiplication(t,this,this),this},i}(BABYLON.Quaternion);e.XYZW=o;var a=function(){function e(){}return e.segment=function(e,t){return d.segmentId(e.hashNumber,t.hashNumber)},e.segmentOrd=function(e,t){return e.hashNumber>t.hashNumber&&(i=[t,e],e=i[0],t=i[1]),[e,t];var i},e.quad=function(t,i,s,n){return r=e.quadOrd(t,i,s,n),t=r[0],i=r[1],s=r[2],n=r[3],t.hashNumber+","+i.hashNumber+","+s.hashNumber+","+n.hashNumber;var r},e.quadOrd=function(e,t,i,s){for(;e.hashNumber>t.hashNumber||e.hashNumber>i.hashNumber||e.hashNumber>s.hashNumber;)n=[t,i,s,e],e=n[0],t=n[1],i=n[2],s=n[3];return t.hashNumber<s.hashNumber&&(r=[s,t],t=r[0],s=r[1]),[e,t,i,s];var n,r},e}();e.Hash=a;var h=function(){function t(){this.position=new s(0,0,0),this.frontDir=new s(1,0,0),this.upVector=new s(0,1,0),this.scaling=new s(1,1,1),this.defaultUpDirIfTooSmall=new s(1,1,0),this.defaultFrontDirIfTooSmall=new s(0,0,1)}return t.prototype.copyFrom=function(e){this.position=s.newFrom(e.position),this.upVector=s.newFrom(e.upVector),this.frontDir=s.newFrom(e.frontDir),this.scaling=s.newFrom(e.scaling)},t.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)},t.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)},t.prototype.setOrientation=function(t,i){this.upVector=new s(0,0,0),this.frontDir=new s(0,0,0),e.geo.orthonormalizeKeepingFirstDirection(t,i,this.frontDir,this.upVector)},t.prototype.quaternion=function(t){if(void 0===t&&(t=!0),null==this.frontDir&&null==this.upVector)throw"you must precise a frontDir or a upVector or both of them";null==this.frontDir?(this.frontDir=new s(0,0,0),e.geo.getOneOrthonormal(this.upVector,this.frontDir)):null==this.upVector&&(this.upVector=new s(0,0,0),e.geo.getOneOrthonormal(this.frontDir,this.upVector)),this.frontDir.length()<e.geo.epsilon&&(this.frontDir=this.defaultFrontDirIfTooSmall,e.logger.c("a tangent was too small, and so replaced by a default one")),this.upVector.length()<e.geo.epsilon&&(this.upVector=this.defaultUpDirIfTooSmall,e.logger.c("a normal was too small, and so replaced by a default one"));var i=new o(0,0,0,1);return e.geo.twoVectorsToQuaternion(this.frontDir,this.upVector,!t,i),i},t.prototype.applyToMeshes=function(e){var t=null;null==this.frontDir&&null==this.upVector||(t=this.quaternion());for(var i=0,n=e;i<n.length;i++){var r=n[i];null!=this.scaling&&(null==r.scaling&&(r.scaling=new s(1,1,1)),r.scaling.copyFrom(this.scaling)),null!=t&&(null==r.rotationQuaternion&&(r.rotationQuaternion=new o(0,0,0,1)),r.rotationQuaternion.copyFrom(t)),null!=this.position&&(null==r.position&&(r.position=new s(0,0,0)),r.position.copyFrom(this.position))}},t.prototype.applyToMesh=function(e){this.applyToMeshes([e])},t.prototype.applyToVertices=function(t){var i=this.quaternion(),s=new l;e.geo.quaternionToMatrix(i,s);for(var n=0,r=t;n<r.length;n++){var o=r[n];o.position.multiply(this.scaling),e.geo.multiplicationMatrixVector(s,o.position,o.position),o.position.add(this.position)}},t}();e.Positioning=h;var l=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.newIdentity=function(){var e=new i;return e.m[0]=1,e.m[5]=1,e.m[10]=1,e.m[15]=1,e},i.newFrom=function(e){for(var t=new i,s=0;s<16;s++)t.m[s]=e.m[s];return t},i.newRandomMat=function(){for(var e=new i,t=0;t<16;t++)e.m[t]=Math.random();return e},i.newZero=function(){return new i},i.prototype.equal=function(t){return e.geo.matEquality(this,t)},i.prototype.almostEqual=function(t){return e.geo.matAlmostEquality(this,t)},i.prototype.leftMultiply=function(t){return e.geo.multiplyMatMat(t,this,this),this},i.prototype.rightMultiply=function(t){return e.geo.multiplyMatMat(this,t,this),this},i.prototype.inverse=function(){return e.geo.inverse(this,this),this},i.prototype.copyFrom=function(t){return e.geo.copyMat(t,this),this},i.prototype.transpose=function(){return e.geo.transpose(this,this),this},i.prototype.toString=function(){return"\n"+this.m[0]+this.m[1]+this.m[2]+this.m[3]+"\n"+this.m[4]+this.m[5]+this.m[6]+this.m[7]+"\n"+this.m[8]+this.m[9]+this.m[10]+this.m[11]+"\n"+this.m[12]+this.m[13]+this.m[14]+this.m[15]+"\n"},i}(BABYLON.Matrix);e.MM=l;var u=function(){function e(e){if(this.customerOb=null,null==e)throw"a links is construct with a null vertex";this.to=e}return e}();e.Link=u;var c=function(){function t(){this.links=[],this.isInvisible=!1,this.dichoLevel=0,this.markers=[],this.customerObject={},this._hashCode=t.hashCount++}return Object.defineProperty(t.prototype,"hashNumber",{get:function(){return this._hashCode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hashString",{get:function(){return this._hashCode+""},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(e,t,i,n){return void 0===n&&(n=!0),this.position=new s(e,t,i),n&&(this.param=new s(e,t,i)),this},t.prototype.hasMark=function(e){return-1!=this.markers.indexOf(e)},t.prototype.getOpposites=function(e){var t=this.findLink(e);if(null==t)throw"the vertex is not a neighbor. Probably your neighborhood relation is not symetric. Please, perform the graph analysis, with the help of the function linkModule.checkTheRegularityOfAGRaph";if(null==t.opposites)return null;for(var i=[],s=0,n=t.opposites;s<n.length;s++){var r=n[s];i.push(r.to)}return i},t.prototype.hasBifurcations=function(){for(var e=0,t=this.links;e<t.length;e++){var i=t[e];if(null!=i.opposites&&i.opposites.length>1)return!0}return!1},t.prototype.hasVoisin=function(e){for(var t=0,i=this.links;t<i.length;t++)if(i[t].to==e)return!0;return!1},t.prototype.isBorder=function(){return this.hasMark(t.Markers.border)},t.prototype.findLink=function(e){for(var t=0,i=this.links;t<i.length;t++){var s=i[t];if(s.to==e)return s}return null},t.prototype.setTwoOppositeLinks=function(e,t){var i=this.findLink(e),s=this.findLink(t);return null==i&&(i=new u(e),this.links.push(i)),null==s&&(s=new u(t),this.links.push(s)),null==i.opposites&&(i.opposites=[]),null==s.opposites&&(s.opposites=[]),i.opposites.push(s),s.opposites.push(i),this},t.prototype.setOneLink=function(e){if(e==this)throw"it is forbidden to link to itself";return this.suppressOneLink(e),this.links.push(new u(e)),this},t.separateTwoVoisins=function(e,t){e.suppressOneLink(t),t.suppressOneLink(e)},t.prototype.suppressOneLink=function(t){var i=this.findLink(t);if(null!=i&&(e.tab.removeFromArray(this.links,i),null!=i.opposites))for(var s=0,n=i.opposites;s<n.length;s++){var r=n[s];r.opposites.length>=2?e.tab.removeFromArray(r.opposites,i):r.opposites=null}},t.prototype.changeToLinkWithoutOpposite=function(t){var i=this.findLink(t);if(null!=i){if(null!=i.opposites)for(var s=0,n=i.opposites;s<n.length;s++){var r=n[s];r.opposites.length>=2?e.tab.removeFromArray(r.opposites,i):r.opposites=null}i.opposites=null}},t.prototype.toString=function(e){return this.hashNumber-e+""},t.prototype.toStringComplete=function(e){for(var i=this.hashNumber-e+"|links:",s=0,n=this.links;s<n.length;s++){var r=n[s],o="";if(null!=r.opposites){o+=",";for(var a=0,h=r.opposites;a<h.length;a++)o+=h[a].to.hashNumber-e+","}i+="("+(r.to.hashNumber-e)+o+")"}null!=this.position&&(i+="|pos:"+this.position.toString(1)+","),i+="|mark:";for(var l=0,u=this.markers;l<u.length;l++){var c=u[l];i+=t.Markers[c]+","}return i},t}();c.hashCount=0,e.Vertex=c,function(e){!function(e){e[e.honeyComb=0]="honeyComb",e[e.corner=1]="corner",e[e.center=2]="center",e[e.border=3]="border",e[e.polygonCenter=4]="polygonCenter",e[e.selectedForLineDrawing=5]="selectedForLineDrawing"}(e.Markers||(e.Markers={}))}(c=e.Vertex||(e.Vertex={}));var m=function(){function t(){this.vertices=[],this.smallestTriangles=[],this.smallestSquares=[],this.hexahedrons=[],this.cutSegmentsDico={}}return Object.defineProperty(t.prototype,"polygons",{get:function(){for(var e=[],t=0;t<this.smallestSquares.length;t+=4)e.push([this.smallestSquares[t],this.smallestSquares[t+1],this.smallestSquares[t+2],this.smallestSquares[t+3]]);for(t=0;t<this.smallestTriangles.length;t+=3)e.push([this.smallestTriangles[t],this.smallestTriangles[t+1],this.smallestTriangles[t+2]]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linesWasMade",{get:function(){return null!=this.lines},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"segments",{get:function(){for(var e=[],t=0,i=this.vertices;t<i.length;t++)for(var s=i[t],n=0,r=s.links;n<r.length;n++){var o=r[n];s.hashNumber<o.to.hashNumber&&e.push([s,o.to])}return e},enumerable:!0,configurable:!0}),t.prototype.addATriangle=function(e,t,i){return this.smallestTriangles.push(e,t,i),this},t.prototype.addASquare=function(e,t,i,s){return this.smallestSquares.push(e,t,i,s),this},t.prototype.addHexahedron=function(e){return this.hexahedrons.concat(e),this},t.prototype.getVertex=function(e){var t=this.findVertexFromParam(e);return null==t&&(t=this.newVertex(e)),t},t.prototype.newVertex=function(e,t,i){void 0===t&&(t=0);var s=new c;return s.position=e,s.param=i||e,s.dichoLevel=t,this.addVertex(s),s},t.prototype.findVertexFromParam=function(e){for(var t=0,i=this.vertices;t<i.length;t++){var s=i[t];if(s.param.hashString==e.hashString)return s}return null},t.prototype.addVertex=function(e){this.vertices.push(e)},t.prototype.hasVertex=function(e){for(var t=0,i=this.vertices;t<i.length;t++)if(i[t].hashNumber==e.hashNumber)return!0;return!1},t.prototype.getStraightLines=function(){for(var e=[],t=0,i=this.lines;t<i.length;t++){var s=i[t];s.isLoop||e.push(s)}return e},t.prototype.getLoopLines=function(){for(var e=[],t=0,i=this.lines;t<i.length;t++){var s=i[t];s.isLoop&&e.push(s)}return e},t.prototype.getStraightLinesAsVertices=function(){for(var e=[],t=0,i=this.lines;t<i.length;t++){var s=i[t];s.isLoop||e.push(s.vertices)}return e},t.prototype.getLoopLinesAsVertices=function(){for(var e=[],t=0,i=this.lines;t<i.length;t++){var s=i[t];s.isLoop&&e.push(s.vertices)}return e},t.prototype.toString=function(e){void 0===e&&(e=!0);var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,s=this.vertices;i<s.length;i++)(a=s[i]).hashNumber<t&&(t=a.hashNumber)}var n="\n";null!=this.name&&(n+=this.name+"\n");for(var r=0,o=this.vertices;r<o.length;r++){var a=o[r];n+=a.toStringComplete(t)+"\n"}n+="tri:";for(h=0;h<this.smallestTriangles.length;h+=3)n+="["+(this.smallestTriangles[h].hashNumber-t)+","+(this.smallestTriangles[h+1].hashNumber-t)+","+(this.smallestTriangles[h+2].hashNumber-t)+"]";n+="\nsqua:";for(var h=0;h<this.smallestSquares.length;h+=4)n+="["+(this.smallestSquares[h].hashNumber-t)+","+(this.smallestSquares[h+1].hashNumber-t)+","+(this.smallestSquares[h+2].hashNumber-t)+","+(this.smallestSquares[h+3].hashNumber-t)+"]";if(this.linesWasMade){n+="\nstrai:";for(var l=0,u=this.getStraightLines();l<u.length;l++){n+="[";for(var c=0,m=(g=u[l]).vertices;c<m.length;c++)n+=(y=m[c]).hashNumber-t+",";n+="]"}n+="\nloop:";for(var p=0,d=this.getLoopLines();p<d.length;p++){var g=d[p];n+="[";for(var f=0,v=g.vertices;f<v.length;f++){var y=v[f];n+=y.hashNumber-t+","}n+="]"}}n+="\ncutSegments";for(var b in this.cutSegmentsDico){var w=this.cutSegmentsDico[b];n+="{"+(w.a.hashNumber-t)+","+(w.middle.hashNumber-t)+","+(w.b.hashNumber-t)+"}"}return n},t.prototype.fillLineCatalogue=function(t){void 0===t&&(t=this.vertices),this.lines=e.lineModule.makeLineCatalogue2(t,!0)},t.prototype.addSimpleLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging()},t.prototype.addOppositeLinksAroundPolygons=function(){new e.linkModule.SimpleLinkFromPolygonCreator(this).goChanging(),new e.linkModule.OppositeLinkAssocierByAngles(this.vertices).goChanging()},t.prototype.isolateMameshVerticesFromExteriorVertices=function(){for(var e=[],t=0,i=this.vertices;t<i.length;t++)for(var s=i[t],n=0,r=s.links;n<r.length;n++){var o=r[n];this.hasVertex(o.to)||e.push({vertex:s,link:o})}for(var a=0,h=e;a<h.length;a++){var l=h[a];c.separateTwoVoisins(l.link.to,l.vertex)}},t.prototype.getOrCreateSegment=function(e,t,i){var s=this.cutSegmentsDico[d.segmentId(e.hashNumber,t.hashNumber)];null==s&&(s=new d(e,t),this.cutSegmentsDico[d.segmentId(e.hashNumber,t.hashNumber)]=s),i[d.segmentId(e.hashNumber,t.hashNumber)]=s},t.prototype.maxLinkLength=function(){var t=-1;if(this.vertices.forEach(function(i){i.links.forEach(function(s){var n=e.geo.distance(i.position,s.to.position);n>t&&(t=n)})}),-1==t)throw"your IN_mamesh seems empty";return t},t.prototype.clearLinksAndLines=function(){this.vertices.forEach(function(t){e.tab.clearArray(t.links)}),this.lines=null},t.prototype.clearOppositeInLinks=function(){this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})})},t.prototype.allLinesAsASortedString=function(t){void 0===t&&(t=!0);var i,s,n="";if(t){s=Number.MAX_VALUE;for(var r=0,o=this.vertices;r<o.length;r++){var a=o[r];a.hashNumber<s&&(s=a.hashNumber)}}if(this.linesWasMade){var h=this.getStraightLines(),l=this.getLoopLines();this.linesWasMade&&h.length>0&&(i=[],h.forEach(function(e){var t=[];e.vertices.forEach(function(e){t.push(e.hashNumber-s)}),i.push(JSON.stringify(t))}),i.sort(),n="straightLines:"+JSON.stringify(i)),l.length>0&&(i=[],l.forEach(function(t){var n=[];t.vertices.forEach(function(e){n.push(e.hashNumber-s)});for(var r=e.tab.minIndexOfNumericList(n),o=[],a=0;a<n.length;a++)o[a]=n[(a+r)%n.length];i.push(JSON.stringify(o))}),i.sort(),n+="|loopLines:"+JSON.stringify(i))}return n},t.prototype.allSquareAndTrianglesAsSortedString=function(e){void 0===e&&(e=!0);var t=0;if(e){t=Number.MAX_VALUE;for(var i=0,s=this.vertices;i<s.length;i++){var n=s[i];n.hashNumber<t&&(t=n.hashNumber)}}return"square:"+this.allSquaresOrTrianglesAsASortedString(this.smallestSquares,4,t)+("triangle:"+this.allSquaresOrTrianglesAsASortedString(this.smallestTriangles,3,t))},t.prototype.allSquaresOrTrianglesAsASortedString=function(t,i,s){for(var n,r="",o=[],a=0;a<t.length;a+=i){for(var h=[],l=0;l<i;l++)h.push(t[a+l]);o.push(h)}return n=[],o.forEach(function(t){var i=[];t.forEach(function(e){i.push(e.hashNumber-s)});for(var r=e.tab.minIndexOfNumericList(i),o=[],a=0;a<i.length;a++)o[a]=i[(a+r)%i.length];n.push(JSON.stringify(o))}),n.sort(),r+=JSON.stringify(n)},t}();e.Mamesh=m;var p=function(){function t(e,t){this.vertices=e,this.isLoop=t}return t.prototype.getVertex=function(e,t){return void 0===t&&(t=!0),this.isLoop&&t?this.vertices[e%this.vertices.length]:this.vertices[e]},t.prototype.hashForDirected=function(){var t=[];if(this.isLoop)for(var i=e.tab.minIndexOb(this.vertices,function(e,t){return e.hashNumber-t.hashNumber}),s=0;s<this.vertices.length;s++)t.push(this.vertices[(s+i)%this.vertices.length].hashNumber);else for(var n=0,r=this.vertices;n<r.length;n++){var o=r[n];t.push(o.hashNumber)}return JSON.stringify(t)},t.prototype.inverted=function(){for(var e=[],i=0;i<this.vertices.length;i++)e.push(this.vertices[this.vertices.length-1-i]);return new t(e,this.isLoop)},t.prototype.positionList=function(){for(var e=[],t=0,i=this.vertices;t<i.length;t++){var s=i[t];e.push(s.position)}return e},Object.defineProperty(t.prototype,"hashString",{get:function(){var e=this.hashForDirected(),t=this.inverted().hashForDirected();return e<t?e:t},enumerable:!0,configurable:!0}),t.prototype.positionnalHashForDirected=function(t){void 0===t&&(t=1);var i=[];if(s.nbDecimalForHash=t,this.isLoop)for(var n=this.positionList(),r=e.tab.minIndexOb(n,s.lexicalOrder),o=0;o<n.length;o++)i.push(n[(o+r)%n.length].hashString);else for(var a=0,h=this.vertices;a<h.length;a++){var l=h[a];i.push(l.position.hashString)}return s.resetDefaultNbDecimalForHash(),JSON.stringify(i)},t.prototype.positionnalHash=function(e){void 0===e&&(e=1);var t=this.positionnalHashForDirected(e),i=this.inverted().positionnalHashForDirected(e);return t<i?t:i},t.prototype.hashStringUpToSymmetries=function(i,s){for(var n=[this.positionnalHash()],r=0,o=i;r<o.length;r++){for(var a=o[r],h=[],l=0,u=this.vertices;l<u.length;l++){var m=u[l],p=new c;p.position=a(s?m.position:m.param),h.push(p)}var d=new t(h,this.isLoop);n.push(d.positionnalHash())}return e.tab.minValueString(n)},t.prototype.allSegments=function(){for(var e=[],t=this.isLoop?1:0,i=0;i<this.vertices.length-1+t;i++)e.push(new d(this.vertices[i],this.vertices[(i+1)%this.vertices.length]));return e},t}();e.Line=p;var d=function(){function e(e,t){this.a=e.hashNumber<t.hashNumber?e:t,this.b=e.hashNumber<t.hashNumber?t:e}return e.segmentId=function(e,t){return e<t?e+","+t:t+","+e},Object.defineProperty(e.prototype,"hashString",{get:function(){return e.segmentId(this.a.hashNumber,this.b.hashNumber)},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.a==e.a&&this.b==e.b},e.prototype.getOther=function(e){return e==this.a?this.b:this.a},e.prototype.getFirst=function(){return this.a},e.prototype.getSecond=function(){return this.b},e.prototype.has=function(e){return e==this.a||e==this.b},e}();e.Segment=d}(mathis||(mathis={}));var mathis;!function(e){var t=function(){function e(e){if("number"==typeof e){t=this.hex2rgb(this.intToColorName(e));this.rgb=new s(t[0],t[1],t[2])}else if("string"==typeof e){var t=this.hex2rgb(e);this.rgb=new s(t[0],t[1],t[2])}else e instanceof s?this.rgb=e:e instanceof i&&(this.rgb=e.toRGB())}return e.prototype.hex2rgb=function(e){var t=e.replace("#","");t=t.match(new RegExp("(.{"+t.length/3+"})","g"));for(var i=0;i<t.length;i++)t[i]=parseInt(1==t[i].length?t[i]+t[i]:t[i],16);return t},e.prototype.lighten=function(e){return this.rgb=this.rgb.lighten(e),this},e.prototype.darken=function(e){return this.rgb=this.rgb.darken(e),this},e.prototype.toBABYLON_Color4=function(){return new BABYLON.Color4(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255,this.rgb.alpha)},e.prototype.toBABYLON_Color3=function(){return new BABYLON.Color3(this.rgb.r/255,this.rgb.g/255,this.rgb.b/255)},e.prototype.toString=function(){return this.rgb.toString()},e.prototype.intToColorName=function(t){var i=0;for(var s in e.names)if(e.names.hasOwnProperty(s)){if(i==763*t%148)return e.names[s];i++}},e}();t.names={favoriteGreen:"7CFC00",aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},e.Color=t;var i=function(){function e(e,t,i,s){void 0===s&&(s=1),this.h=e,this.s=t,this.v=i,this.alpha=s}return e.HSV_01_toRGB_01=function(e,t,i){var s,n,r,o,a,h,l,u;switch(o=Math.floor(6*e),a=6*e-o,h=i*(1-t),l=i*(1-a*t),u=i*(1-(1-a)*t),o%6){case 0:s=i,n=u,r=h;break;case 1:s=l,n=i,r=h;break;case 2:s=h,n=i,r=u;break;case 3:s=h,n=l,r=i;break;case 4:s=u,n=h,r=i;break;case 5:s=i,n=h,r=l}return{r:s,g:n,b:r}},e.prototype.toRGB=function(){var t=e.HSV_01_toRGB_01(this.h,this.s,this.v);return new s(255*t.r,255*t.g,255*t.b,1)},e}();e.HSV_01=i;var s=function(){function e(e,t,i,s){void 0===s&&(s=1),this.r=0,this.g=0,this.b=0,this.alpha=1,this.setRed(e).setGreen(t).setBlue(i).setAlpha(s)}return e.prototype.getHexPart=function(e){var t=e.toString(16);return t.length>1?t:"0"+t},e.prototype.setRed=function(e){return this.r=e>255?255:e<0?0:Math.floor(e),this},e.prototype.setGreen=function(e){return this.g=e>255?255:e<0?0:Math.floor(e),this},e.prototype.setBlue=function(e){return this.b=e>255?255:e<0?0:Math.floor(e),this},e.prototype.setAlpha=function(e){return this.alpha=e<=1&&e>=0?e:1,this},e.prototype.lighten=function(e){return this.setRed(this.r+e).setBlue(this.g+e).setGreen(this.b+e),this},e.prototype.darken=function(e){return this.setRed(this.r-e).setBlue(this.g-e).setGreen(this.b-e),this},e.prototype.toString=function(){return this.alpha<1?"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")":"rgb("+this.r+","+this.g+","+this.b+")"},e}();e.RGB_range255=s;!function(e){!function(e){e.defaultSurfaceColor=new t(new s(255,50,50)),e.defaultVertexColor=new t(new s(255,50,50)),e.defaultLinkColor=new t(new s(124,252,0))}(e.thema||(e.thema={}))}(e.color||(e.color={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i;!function(e){e[e.triangulatedTriangle=0]="triangulatedTriangle",e[e.triangulatedRect=1]="triangulatedRect",e[e.square=2]="square",e[e.polygon3=3]="polygon3",e[e.polygon4=4]="polygon4",e[e.polygon5=5]="polygon5",e[e.polygon6=6]="polygon6",e[e.polygon7=7]="polygon7",e[e.polygon8=8]="polygon8",e[e.polygon9=9]="polygon9",e[e.polygon10=10]="polygon10",e[e.polygon11=11]="polygon11",e[e.polygon12=12]="polygon12"}(i=t.PartShape||(t.PartShape={}));var s=function(){function t(t,s){this.SUB_gratAndStick=new e.grateAndGlue.ConcurrentMameshesGraterAndSticker,this.SUB_oppositeLinkAssocierByAngles=new e.linkModule.OppositeLinkAssocierByAngles(null),this.SUB_mameshCleaner=new e.mameshModification.MameshCleaner(null),this.origine=new e.XYZ(0,0,0),this.end=new e.XYZ(1,1,0),this.rotation=.001,this.shapes=[i.square],this.proportions=[new e.UV(1,1),new e.UV(1,1)],this.individualScales=[new e.UV(1,1)],this.individualRotations=[0],this.individualTranslation=[new e.XYZ(0,0,0),new e.XYZ(0,0,0)],this.nbPatches=2,this.toleranceToBeOneOfTheClosest=.55,this.stratesToSuppressFromCorners=[0],this.scalingBeforeOppositeLinkAssociations=null,this.exponentOfRoundingFunction=[1],this.percolationProba=[0],this.forceToGrate=[.1],this.nbI=t,this.nbJ=s}return t.prototype.go=function(){for(var t=[],s=this,n=0;n<this.nbPatches;n++)!function(n){var r=n%s.shapes.length,o=s.shapes[r],a=i[o],h=Math.round(s.nbI*s.proportions[n%s.proportions.length].u),l=Math.round(s.nbJ*s.proportions[n%s.proportions.length].v),u=.5*s.individualScales[n%s.individualScales.length].u*s.proportions[n%s.proportions.length].u,c=.5*s.individualScales[n%s.individualScales.length].v*s.proportions[n%s.proportions.length].v,m=void 0;if(-1!=a.indexOf("polygon")){var p=parseInt(a.slice(7,a.length)),d=new e.reseau.TriangulatedPolygone(p);d.origin=new e.XYZ(-u,-c,0),d.end=new e.XYZ(u,c,0),d.nbSubdivisionInARadius=Math.floor((h+l)/4),m=d.go()}else if(o==i.square||o==i.triangulatedRect){var g=new e.reseau.BasisForRegularReseau;g.origin=new e.XYZ(-u,-c,0),g.end=new e.XYZ(u,c,0),g.nbU=h,g.nbV=l,o==i.triangulatedRect&&(g.squareMailleInsteadOfTriangle=!1),g.go();var f=new e.reseau.Regular2d(g);o==i.triangulatedRect&&(f.oneMoreVertexForOddLine=!0),m=f.go()}else if(o==i.triangulatedTriangle){var v=new e.reseau.TriangulatedTriangle;v.origin=new e.XYZ(-u,-c,0),v.end=new e.XYZ(u,c,0),v.nbSubdivisionInSide=(h+l)/2,m=v.go()}if(s.propBeginToRound||s.propEndToRound||s.integerBeginToRound||s.integerEndToRound){var y=new e.spacialTransformations.RoundSomeStrates(m);null==s.propBeginToRound?y.propBeginToRound=0:y.propBeginToRound=s.propBeginToRound[n%s.propBeginToRound.length],null==s.propEndToRound?y.propEndToRound=1:y.propEndToRound=s.propEndToRound[n%s.propEndToRound.length],null!=s.integerBeginToRound&&(y.integerBeginToRound=s.integerBeginToRound[n%s.integerBeginToRound.length]),null!=s.integerEndToRound&&(y.integerEndToRound=s.integerEndToRound[n%s.integerEndToRound.length]),y.exponentOfRoundingFunction=s.exponentOfRoundingFunction[n%s.exponentOfRoundingFunction.length],y.referenceRadiusIsMinVersusMaxVersusMean=2,y.preventStratesCrossings=!0,y.goChanging()}var b=s.percolationProba[n*s.percolationProba.length];if(b>0){var w=new e.mameshModification.PercolationOnLinks(m);w.percolationProba=b,w.goChanging()}if(s.stratesToSuppressFromCorners[n%s.stratesToSuppressFromCorners.length]>0){var x=new e.grateAndGlue.ExtractCentralPart(m,s.stratesToSuppressFromCorners[n%s.stratesToSuppressFromCorners.length]);x.suppressFromBorderVersusCorner=!1,(m=x.go()).isolateMameshVerticesFromExteriorVertices()}t.push(m);var M=s.individualTranslation[n%s.individualTranslation.length],T=s.individualRotations[n%s.individualRotations.length],V=new e.MM;e.geo.axisAngleToMatrix(new e.XYZ(0,0,-1),T,V),m.vertices.forEach(function(t){e.geo.multiplicationMatrixVector(V,t.position,t.position),t.position.add(M)})}(n);var r;return this.nbPatches>1?(this.SUB_gratAndStick.IN_mameshes=t,this.SUB_gratAndStick.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest,this.SUB_gratAndStick.SUB_grater.proportionOfSeeds=this.forceToGrate,r=this.SUB_gratAndStick.goChanging()):(r=t[0],e.spacialTransformations.adjustInASquare(r,new e.XYZ(0,0,0),new e.XYZ(1,1,0)),r.clearOppositeInLinks()),null!=this.scalingBeforeOppositeLinkAssociations&&e.spacialTransformations.adjustInASquare(r,new e.XYZ(0,0,0),new e.XYZ(this.scalingBeforeOppositeLinkAssociations.x,this.scalingBeforeOppositeLinkAssociations.y,0)),this.SUB_oppositeLinkAssocierByAngles.vertices=r.vertices,this.SUB_oppositeLinkAssocierByAngles.goChanging(),this.SUB_mameshCleaner.IN_mamesh=r,this.SUB_mameshCleaner.goChanging(),new e.spacialTransformations.Similitude(r.vertices,this.rotation).goChanging(),e.spacialTransformations.adjustInASquare(r,this.origine,this.end),r},t}();t.Concentric=s;var n=function(t){function i(e,i,s,n){var r=t.call(this,e,i)||this;return r.nbPatchesI=2,r.nbPatchesJ=2,r.patchesInQuinconce=!1,r.oddPatchLinesAreTheSameVersusLongerVersusShorter=0,r.alternateShapeAccordingIPlusJVersusCounter=!0,r.nbPatchesI=s,r.nbPatchesJ=n,r.nbPatches=0,r.individualTranslation=[],r}return __extends(i,t),i.prototype.go=function(){this.individualTranslation=[],this.nbPatches=0;for(var i=[],s=0,n=0;n<this.nbPatchesJ;n++){var r=0;if(n%2==1)if(0==this.oddPatchLinesAreTheSameVersusLongerVersusShorter)r=0;else if(1==this.oddPatchLinesAreTheSameVersusLongerVersusShorter)r=1;else{if(2!=this.oddPatchLinesAreTheSameVersusLongerVersusShorter)throw"must be 0 or 1 or 2";r=-1}for(var o=0;o<this.nbPatchesI+r;o++){this.nbPatches++;var a=0;this.patchesInQuinconce&&n%2==1&&(0==this.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=-.5),1==this.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=-.5),2==this.oddPatchLinesAreTheSameVersusLongerVersusShorter&&(a=.5)),this.individualTranslation.push(new e.XYZ(o+a,n,0)),s++;var h=this.alternateShapeAccordingIPlusJVersusCounter?o+r+n:s;i.push(this.shapes[h%this.shapes.length])}}return this.shapes=i,t.prototype.go.call(this)},i}(s);t.Patchwork=n}(e.creation2D||(e.creation2D={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(t){this.maxLength=500,this.curentLength=0,this.serpentRadius=.03,this.path=[],this.sliceInsteadOfElongateWhenMaxLengthIsReached=!0,this.initialPosition=new e.XYZ(0,0,0),this.mathisFrame=t}return t.prototype.go=function(){for(var e=0;e<this.maxLength;e++)this.path.push(this.initialPosition);this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,10,null,BABYLON.Mesh.CAP_ALL,this.mathisFrame.scene,!0);var t=new BABYLON.StandardMaterial("",this.mathisFrame.scene);t.diffuseColor=new BABYLON.Color3(124/255,252/255,0),this.serpentMesh.material=t,this.headSerpent=BABYLON.Mesh.CreateSphere("",10,2.5*this.serpentRadius,this.mathisFrame.scene);var i=new BABYLON.StandardMaterial("",this.mathisFrame.scene);i.diffuseColor=new BABYLON.Color3(1,0,0),this.headSerpent.material=i,this.headSerpent.position.copyFrom(this.initialPosition)},t.prototype.contractInOnePoint=function(e){for(var t=0;t<this.maxLength;t++)this.path[t]=e;this.curentLength=0,this.updateMeshes()},t.prototype.elongateTo=function(e){if(this.curentLength<this.maxLength){for(var t=this.curentLength;t<this.maxLength;t++)this.path[t]=e;this.curentLength++,this.updateMeshes()}else{if(!this.sliceInsteadOfElongateWhenMaxLengthIsReached)throw"snake reaches his maximal length";this.bobySliceTo(e)}},t.prototype.bobySliceTo=function(e){this.path.splice(0,1),this.path.push(e),this.updateMeshes()},t.prototype.updateMeshes=function(){this.serpentMesh=BABYLON.Mesh.CreateTube("",this.path,this.serpentRadius,null,null,null,null,!0,null,this.serpentMesh),this.headSerpent.position=this.getHeadPosition()},t.prototype.getHeadPosition=function(){return this.path[this.path.length-1]},t}();t.Snake=i;var s=function(){function t(e){this.totalHeight=1,this.bodyProp=.75,this.headProp=.25,this.bodyDiameterProp=.1,this.headDiameterProp=.2,this.headUp=!0,this.arrowFootAtOrigin=!0,this.quaternion=null,this.subdivision=6,this.scene=e}return t.prototype.go=function(){var t=this.bodyProp*this.totalHeight,i=this.headProp*this.totalHeight,s=BABYLON.Mesh.CreateCylinder("",t,this.bodyDiameterProp*this.totalHeight,this.bodyDiameterProp*this.totalHeight,this.subdivision,null,this.scene);s.position=new e.XYZ(0,t/2,0);var n=BABYLON.Mesh.CreateCylinder("",i,0,this.headDiameterProp*this.totalHeight,this.subdivision,null,this.scene);n.position=new e.XYZ(0,t+i/2,0);var r=BABYLON.Mesh.MergeMeshes([s,n]);this.arrowFootAtOrigin||(r.position.addInPlace(new e.XYZ(0,-this.totalHeight/2,0)),r.bakeCurrentTransformIntoVertices());var o=new e.XYZW(0,0,0,1);if(this.headUp||e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),Math.PI,o),null!=this.quaternion&&o.multiply(this.quaternion),r.rotationQuaternion=o,r.bakeCurrentTransformIntoVertices(),null!=this.color){var a=new BABYLON.StandardMaterial("",this.scene);a.diffuseColor=this.color.toBABYLON_Color3(),r.material=a}return r},t}();t.ArrowCreator=s;var n=function(){function e(e){this.scene=e,this.twoOrThreeAxis=new r(this.scene)}return e.prototype.go=function(){this.twoOrThreeAxis.addColor=!1;var e=this.twoOrThreeAxis.go(),t=BABYLON.Mesh.MergeMeshes(e),i=e[0].getTotalIndices(),s=e[1].getTotalIndices(),n=e[2].getTotalIndices(),r=new BABYLON.StandardMaterial("",this.scene);r.diffuseColor=new BABYLON.Color3(1,0,0);var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=new BABYLON.Color3(0,1,0);var a=new BABYLON.StandardMaterial("",this.scene);a.diffuseColor=new BABYLON.Color3(0,0,1);var h=t.getTotalVertices();t.subMeshes=[],t.subMeshes.push(new BABYLON.SubMesh(0,0,h,0,i,t)),t.subMeshes.push(new BABYLON.SubMesh(1,0,h,i,s,t)),t.subMeshes.push(new BABYLON.SubMesh(2,0,h,i+s,n,t));var l=new BABYLON.MultiMaterial("multi",this.scene);return l.subMaterials.push(r),l.subMaterials.push(o),l.subMaterials.push(a),t.material=l,t},e}();t.TwoOrThreeAxisMerged=n;var r=function(){function i(e){this.isLeftHandSided=!0,this.addColor=!0,this.threeVersusTwoAxis=!0,this.addLabelsXYZ=!1,this.scene=e,this.SUB_x_axisCreator=new s(this.scene),this.SUB_y_axisCreator=new s(this.scene),this.SUB_z_axisCreator=new s(this.scene)}return i.prototype.go=function(){this.addColor&&(this.SUB_x_axisCreator.color=new e.Color(e.Color.names.red),this.SUB_y_axisCreator.color=new e.Color(e.Color.names.green),this.SUB_z_axisCreator.color=new e.Color(e.Color.names.blue));var i=[];if(this.addLabelsXYZ){var s=new t.FlagWithText(this.scene);s.text="x";var n=s.go();n.position=new e.XYZ(1.1,0,0),i.push(n);var r=new t.FlagWithText(this.scene);r.text="y";var o=r.go();o.position=new e.XYZ(0,1.15,0),i.push(o);var a=new t.FlagWithText(this.scene);a.text="z";var h=a.go();h.position=new e.XYZ(0,.1,1),i.push(h)}var l=this.SUB_y_axisCreator.go();l.bakeCurrentTransformIntoVertices();var u=this.SUB_x_axisCreator.go();if(e.geo.axisAngleToQuaternion(new e.XYZ(0,0,1),-Math.PI/2,u.rotationQuaternion),u.bakeCurrentTransformIntoVertices(),this.threeVersusTwoAxis){var c=this.SUB_z_axisCreator.go(),m=this.isLeftHandSided?Math.PI/2:-Math.PI/2;return e.geo.axisAngleToQuaternion(new e.XYZ(1,0,0),m,c.rotationQuaternion),c.bakeCurrentTransformIntoVertices(),[u,l,c].concat(i)}return[u,l].concat(i)},i}();t.TwoOrTreeAxis=r;var o=function(){function e(e){this.text="TOTO",this.font="bold 140px verdana",this.color="black",this.backgroundColor="transparent",this.scene=e}return e.prototype.go=function(){var e=new BABYLON.DynamicTexture("dynamic texture",512,this.scene,!0);e.drawText(this.text,null,300,this.font,this.color,this.backgroundColor),e.hasAlpha=!0;var t=BABYLON.Mesh.CreatePlane("textPlane",1,this.scene,!1),i=new BABYLON.StandardMaterial("textPlane",this.scene);return i.diffuseTexture=e,i.specularColor=new BABYLON.Color3(0,0,0),i.emissiveColor=new BABYLON.Color3(1,1,1),i.backFaceCulling=!1,t.material=i,t},e}();t.FlagWithText=o}(e.creation3D||(e.creation3D={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(e){for(var t=[],i=0,s=e;i<s.length;i++){var n=s[i];t.push(n.hashNumber)}return JSON.stringify(t.sort())}function s(t){for(var i=[],s=0,n=t;s<n.length;s++){for(var r=[],o=0,a=n[s];o<a.length;o++){var h=a[o];r.push(h.hashNumber)}i.push(e.tab.indicesUpPermutationToString(r))}return JSON.stringify(i.sort())}function n(e){for(var t="",i=0,s=e;i<s.length;i++)t+=s[i].toString();return t}function r(e){for(var t=0,i=e;t<i.length;t++)for(var s=i[t],n=null,r=0,o=s.links;r<o.length;r++){if(!(n=o[r]).to.hasVoisin(s))throw"neighborhood relation is not reflexive. The vertex:"+s.toString(0)+"\n has a link which gos to:"+n.to.toString(0)+"\n but no link in the other direction. A possible cause: you vertices is only a part of a graph";if(null!=n.opposites)for(var a=0,h=n.opposites;a<h.length;a++){var l=h[a];if(-1==s.links.indexOf(l))throw"a link attached to a vertex has an opposite link which is not attached of this vertex \n problem takes place at vertex:"+s.toString(0)+"\n link going to:"+n.to.toString(0)+"\n opposite link going to:"+l.to.toString(0);if(-1==l.opposites.indexOf(n))throw"opposite of  opposite do not give the same link"}}}t.verticesToString=i,t.verticesFamilyToString=s,t.objToString=n,t.checkTheRegularityOfAGraph=r}(e.debug||(e.debug={}))}(mathis||(mathis={}));var mathis;!function(e){var t=function(){function t(){this.epsilon=1e-8,this.epsilonSquare=this.epsilon*this.epsilon,this.epsitlonForAlmostEquality=1e-6,this._resultTransp=new e.MM,this.baryResult=new e.XYZ(0,0,0),this._scaled=new e.XYZ(0,0,0),this._matUn=new e.MM,this._source=new e.XYZ(0,0,0),this._axis=new e.XYZ(0,0,0),this._ortBasisV1=new e.XYZ(0,0,0),this._ortBasisV2=new e.XYZ(0,0,0),this._ortBasisV3=new e.XYZ(0,0,0),this._ortBasisAll=new e.MM,this._basisOrtho0=new e.XYZ(0,0,0),this._basisOrtho1=new e.XYZ(0,0,0),this._basisOrtho2=new e.XYZ(0,0,0),this._basisMatrix=new e.MM,this._transposedBasisMatrix=new e.MM,this._diagoMatrix=new e.MM,this.matt1=new e.MM,this.matt2=new e.MM,this.oor1=new e.XYZ(0,0,0),this.oor2=new e.XYZ(0,0,0),this.copA=new e.XYZ(0,0,0),this.copB=new e.XYZ(0,0,0),this.copC=new e.XYZ(0,0,0),this.copD=new e.XYZ(0,0,0),this.matBefore=new e.MM,this.v1nor=new e.XYZ(0,0,0),this.v2nor=new e.XYZ(0,0,0),this._aCros=new e.XYZ(0,0,0),this._quat0=new e.XYZW(0,0,0,0),this._quat1=new e.XYZW(0,0,0,0),this._quatAlpha=new e.XYZW(0,0,0,0),this._mat0=new e.MM,this._mat1=new e.MM,this._matAlpha=new e.MM,this._c0=new e.XYZ(0,0,0),this._c1=new e.XYZ(0,0,0),this._crossResult=new e.XYZ(0,0,0),this.v1forSubstraction=new e.XYZ(0,0,0),this.randV2=new e.XYZ(0,0,0),this._result1=new e.XYZ(0,0,0),this._result2=new e.XYZ(0,0,0),this.spheCentToRayOri=new e.XYZ(0,0,0),this._resultInters=new e.XYZ(0,0,0),this.difference=new e.XYZ(0,0,0),this._xAxis=e.XYZ.newZero(),this._yAxis=e.XYZ.newZero(),this._zAxis=e.XYZ.newZero()}return t.prototype.copyXYZ=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},t.prototype.copyXyzFromFloat=function(e,t,i,s){return s.x=e,s.y=t,s.z=i,s},t.prototype.copyMat=function(e,t){for(var i=0;i<16;i++)t.m[i]=e.m[i];return t},t.prototype.matEquality=function(e,t){for(var i=0;i<16;i++)if(e.m[i]!=t.m[i])return!1;return!0},t.prototype.matAlmostEquality=function(e,t){for(var i=0;i<16;i++)if(!this.almostEquality(e.m[i],t.m[i]))return!1;return!0},t.prototype.xyzEquality=function(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z},t.prototype.xyzAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality},t.prototype.xyzwAlmostEquality=function(e,t){return Math.abs(e.x-t.x)<this.epsitlonForAlmostEquality&&Math.abs(e.y-t.y)<this.epsitlonForAlmostEquality&&Math.abs(e.z-t.z)<this.epsitlonForAlmostEquality&&Math.abs(e.w-t.w)<this.epsitlonForAlmostEquality},t.prototype.almostLogicalEqual=function(t,i){return e.geo.xyzwAlmostEquality(t,i)||e.geo.almostEquality(t.x,-i.x)&&e.geo.almostEquality(t.y,-i.y)&&e.geo.almostEquality(t.z,-i.z)&&e.geo.almostEquality(t.w,-i.w)},t.prototype.xyzAlmostZero=function(e){return Math.abs(e.x)<this.epsilon&&Math.abs(e.y)<this.epsilon&&Math.abs(e.z)<this.epsilon},t.prototype.almostEquality=function(e,t){return Math.abs(t-e)<this.epsitlonForAlmostEquality},t.prototype.inverse=function(e,t){var i=e.m[0],s=e.m[1],n=e.m[2],r=e.m[3],o=e.m[4],a=e.m[5],h=e.m[6],l=e.m[7],u=e.m[8],c=e.m[9],m=e.m[10],p=e.m[11],d=e.m[12],g=e.m[13],f=e.m[14],v=e.m[15],y=m*v-p*f,b=c*v-p*g,w=c*f-m*g,x=u*v-p*d,M=u*f-m*d,T=u*g-c*d,V=a*y-h*b+l*w,C=-(o*y-h*x+l*M),k=o*b-a*x+l*T,S=-(o*w-a*M+h*T),O=1/(i*V+s*C+n*k+r*S),A=h*v-l*f,_=a*v-l*g,P=a*f-h*g,F=o*v-l*d,N=o*f-h*d,L=o*g-a*d,Y=h*p-l*m,B=a*p-l*c,X=a*m-h*c,I=o*p-l*u,Z=o*m-h*u,D=o*c-a*u;t.m[0]=V*O,t.m[4]=C*O,t.m[8]=k*O,t.m[12]=S*O,t.m[1]=-(s*y-n*b+r*w)*O,t.m[5]=(i*y-n*x+r*M)*O,t.m[9]=-(i*b-s*x+r*T)*O,t.m[13]=(i*w-s*M+n*T)*O,t.m[2]=(s*A-n*_+r*P)*O,t.m[6]=-(i*A-n*F+r*N)*O,t.m[10]=(i*_-s*F+r*L)*O,t.m[14]=-(i*P-s*N+n*L)*O,t.m[3]=-(s*Y-n*B+r*X)*O,t.m[7]=(i*Y-n*I+r*Z)*O,t.m[11]=-(i*B-s*I+r*D)*O,t.m[15]=(i*X-s*Z+n*D)*O},t.prototype.transpose=function(t,i){this._resultTransp.m[0]=t.m[0],this._resultTransp.m[1]=t.m[4],this._resultTransp.m[2]=t.m[8],this._resultTransp.m[3]=t.m[12],this._resultTransp.m[4]=t.m[1],this._resultTransp.m[5]=t.m[5],this._resultTransp.m[6]=t.m[9],this._resultTransp.m[7]=t.m[13],this._resultTransp.m[8]=t.m[2],this._resultTransp.m[9]=t.m[6],this._resultTransp.m[10]=t.m[10],this._resultTransp.m[11]=t.m[14],this._resultTransp.m[12]=t.m[3],this._resultTransp.m[13]=t.m[7],this._resultTransp.m[14]=t.m[11],this._resultTransp.m[15]=t.m[15],e.geo.copyMat(this._resultTransp,i)},t.prototype.multiplyMatMat=function(e,t,i){var s=e.m[0],n=e.m[1],r=e.m[2],o=e.m[3],a=e.m[4],h=e.m[5],l=e.m[6],u=e.m[7],c=e.m[8],m=e.m[9],p=e.m[10],d=e.m[11],g=e.m[12],f=e.m[13],v=e.m[14],y=e.m[15],b=t.m[0],w=t.m[1],x=t.m[2],M=t.m[3],T=t.m[4],V=t.m[5],C=t.m[6],k=t.m[7],S=t.m[8],O=t.m[9],A=t.m[10],_=t.m[11],P=t.m[12],F=t.m[13],N=t.m[14],L=t.m[15];i.m[0]=s*b+n*T+r*S+o*P,i.m[1]=s*w+n*V+r*O+o*F,i.m[2]=s*x+n*C+r*A+o*N,i.m[3]=s*M+n*k+r*_+o*L,i.m[4]=a*b+h*T+l*S+u*P,i.m[5]=a*w+h*V+l*O+u*F,i.m[6]=a*x+h*C+l*A+u*N,i.m[7]=a*M+h*k+l*_+u*L,i.m[8]=c*b+m*T+p*S+d*P,i.m[9]=c*w+m*V+p*O+d*F,i.m[10]=c*x+m*C+p*A+d*N,i.m[11]=c*M+m*k+p*_+d*L,i.m[12]=g*b+f*T+v*S+y*P,i.m[13]=g*w+f*V+v*O+y*F,i.m[14]=g*x+f*C+v*A+y*N,i.m[15]=g*M+f*k+v*_+y*L},t.prototype.baryCenter=function(t,i,s){this.baryResult.x=0,this.baryResult.y=0,this.baryResult.z=0;for(var n=0;n<t.length;n++)e.geo.copyXYZ(t[n],this._scaled),this.scale(this._scaled,i[n],this._scaled),this.add(this.baryResult,this._scaled,this.baryResult);e.geo.copyXYZ(this.baryResult,s)},t.prototype.between=function(e,t,i,s){s.x=e.x*(1-i)+t.x*i,s.y=e.y*(1-i)+t.y*i,s.z=e.z*(1-i)+t.z*i},t.prototype.betweenUV=function(e,t,i,s){s.u=e.u*(1-i)+t.u*i,s.v=e.v*(1-i)+t.v*i},t.prototype.unproject=function(t,i,s,n,r,o,a){e.geo.copyXYZ(t,this._source),null!=n?(this.multiplyMatMat(n,r,this._matUn),this.multiplyMatMat(this._matUn,o,this._matUn)):this.multiplyMatMat(r,o,this._matUn),this.inverse(this._matUn,this._matUn),this._source.x=this._source.x/i*2-1,this._source.y=-(this._source.y/s*2-1),this.multiplicationMatrixVector(this._matUn,this._source,a);var h=t.x*this._matUn.m[3]+t.y*this._matUn.m[7]+t.z*this._matUn.m[11]+this._matUn.m[15];this.withinEpsilon(h,1)&&this.scale(a,1/h,a)},t.prototype.withinEpsilon=function(e,t){var i=e-t;return-1.401298e-45<=i&&i<=1.401298e-45},t.prototype.axisAngleToMatrix=function(t,i,s){var n=Math.sin(-i),r=Math.cos(-i),o=1-r;e.geo.copyXYZ(t,this._axis),this.normalize(this._axis,this._axis),s.m[0]=this._axis.x*this._axis.x*o+r,s.m[1]=this._axis.x*this._axis.y*o-this._axis.z*n,s.m[2]=this._axis.x*this._axis.z*o+this._axis.y*n,s.m[3]=0,s.m[4]=this._axis.y*this._axis.x*o+this._axis.z*n,s.m[5]=this._axis.y*this._axis.y*o+r,s.m[6]=this._axis.y*this._axis.z*o-this._axis.x*n,s.m[7]=0,s.m[8]=this._axis.z*this._axis.x*o-this._axis.y*n,s.m[9]=this._axis.z*this._axis.y*o+this._axis.x*n,s.m[10]=this._axis.z*this._axis.z*o+r,s.m[11]=0,s.m[12]=0,s.m[13]=0,s.m[14]=0,s.m[15]=1},t.prototype.multiplicationMatrixVector=function(e,t,i){var s=t.x*e.m[0]+t.y*e.m[4]+t.z*e.m[8]+e.m[12],n=t.x*e.m[1]+t.y*e.m[5]+t.z*e.m[9]+e.m[13],r=t.x*e.m[2]+t.y*e.m[6]+t.z*e.m[10]+e.m[14],o=t.x*e.m[3]+t.y*e.m[7]+t.z*e.m[11]+e.m[15];i.x=s/o,i.y=n/o,i.z=r/o},t.prototype.axisAngleToQuaternion=function(e,t,i){var s=Math.sin(t/2);i.w=Math.cos(t/2),i.x=e.x*s,i.y=e.y*s,i.z=e.z*s},t.prototype.matrixToQuaternion=function(e,t){var i,s,n,r,o,a,h,l,u;i=e.m[0],r=e.m[1],h=e.m[2],s=e.m[4],o=e.m[5],l=e.m[6],n=e.m[8],a=e.m[9];var c,m,p,d,g=i+o+(u=e.m[10]);if(g>0)d=.25*(f=2*Math.sqrt(g+1)),c=(l-a)/f,m=(n-h)/f,p=(r-s)/f;else if(i>o&&i>u)d=(l-a)/(f=2*Math.sqrt(1+i-o-u)),c=.25*f,m=(s+r)/f,p=(n+h)/f;else if(o>u)d=(n-h)/(f=2*Math.sqrt(1+o-i-u)),c=(s+r)/f,m=.25*f,p=(a+l)/f;else{var f=2*Math.sqrt(1+u-i-o);d=(r-s)/f,c=(n+h)/f,m=(a+l)/f,p=.25*f}t.x=c,t.y=m,t.z=p,t.w=d},t.prototype.twoVectorsToQuaternion=function(t,i,s,n){s?e.geo.orthonormalizeKeepingFirstDirection(t,i,this._ortBasisV1,this._ortBasisV2):e.geo.orthonormalizeKeepingFirstDirection(i,t,this._ortBasisV2,this._ortBasisV1),e.geo.cross(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3),e.geo.matrixFromLines(this._ortBasisV1,this._ortBasisV2,this._ortBasisV3,this._ortBasisAll),e.geo.matrixToQuaternion(this._ortBasisAll,n)},t.prototype.orthogonalProjectionOnLine=function(e,t){this.normalize(e,this._basisOrtho0),this.getOneOrthonormal(e,this._basisOrtho1),this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2),this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix),this.transpose(this._basisMatrix,this._transposedBasisMatrix),this._diagoMatrix.m[0]=1,this._diagoMatrix.m[15]=1,this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,t),this.multiplyMatMat(t,this._basisMatrix,t)},t.prototype.orthogonalProjectionOnPlane=function(e,t,i){this.orthonormalizeKeepingFirstDirection(e,t,this._basisOrtho0,this._basisOrtho1),this.cross(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2),this.matrixFromLines(this._basisOrtho0,this._basisOrtho1,this._basisOrtho2,this._basisMatrix),this.transpose(this._basisMatrix,this._transposedBasisMatrix),this._diagoMatrix.m[0]=1,this._diagoMatrix.m[5]=1,this._diagoMatrix.m[15]=1,this.multiplyMatMat(this._transposedBasisMatrix,this._diagoMatrix,i),this.multiplyMatMat(i,this._basisMatrix,i)},t.prototype.translationOnMatrix=function(e,t){t.m[12]=e.x,t.m[13]=e.y,t.m[14]=e.z},t.prototype.quaternionToMatrix=function(e,t){var i=e.x*e.x,s=e.y*e.y,n=e.z*e.z,r=e.x*e.y,o=e.z*e.w,a=e.z*e.x,h=e.y*e.w,l=e.y*e.z,u=e.x*e.w;t.m[0]=1-2*(s+n),t.m[1]=2*(r+o),t.m[2]=2*(a-h),t.m[3]=0,t.m[4]=2*(r-o),t.m[5]=1-2*(n+i),t.m[6]=2*(l+u),t.m[7]=0,t.m[8]=2*(a+h),t.m[9]=2*(l-u),t.m[10]=1-2*(s+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1},t.prototype.quaternionMultiplication=function(e,t,i){var s=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,n=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,r=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,o=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w;i.x=s,i.y=n,i.z=r,i.w=o},t.prototype.anOrthogonalMatrixMovingABtoCD=function(e,t,i,s,n,r){void 0===r&&(r=!1),r?(this.copA.copyFrom(e),this.copB.copyFrom(t),this.copC.copyFrom(i),this.copD.copyFrom(s)):(this.orthonormalizeKeepingFirstDirection(e,t,this.copA,this.copB),this.orthonormalizeKeepingFirstDirection(i,s,this.copC,this.copD)),this.cross(this.copA,this.copB,this.oor1),this.matrixFromLines(this.copA,this.copB,this.oor1,this.matt1),this.cross(this.copC,this.copD,this.oor2),this.matrixFromLines(this.copC,this.copD,this.oor2,this.matt2),this.transpose(this.matt1,this.matt1),this.multiplyMatMat(this.matt1,this.matt2,n)},t.prototype.aQuaternionMovingABtoCD=function(e,t,i,s,n,r){void 0===r&&(r=!1),this.anOrthogonalMatrixMovingABtoCD(e,t,i,s,this.matBefore,r),this.matrixToQuaternion(this.matBefore,n)},t.prototype.slerp=function(e,t,i,s){var n,r,o=i,a=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,h=!1;if(a<0&&(h=!0,a=-a),a>.999999)r=1-o,n=h?-o:o;else{var l=Math.acos(a),u=1/Math.sin(l);r=Math.sin((1-o)*l)*u,n=h?-Math.sin(o*l)*u:Math.sin(o*l)*u}s.x=r*e.x+n*t.x,s.y=r*e.y+n*t.y,s.z=r*e.z+n*t.z,s.w=r*e.w+n*t.w},t.prototype.matrixFromLines=function(e,t,i,s){s.m[0]=e.x,s.m[1]=e.y,s.m[2]=e.z,s.m[3]=0,s.m[4]=t.x,s.m[5]=t.y,s.m[6]=t.z,s.m[7]=0,s.m[8]=i.x,s.m[9]=i.y,s.m[10]=i.z,s.m[11]=0,s.m[12]=0,s.m[13]=0,s.m[14]=0,s.m[15]=1},t.prototype.angleBetweenTwoVectorsBetween0andPi=function(t,i){if(e.geo.xyzAlmostZero(t)||e.geo.xyzAlmostZero(i))throw"be aware: you compute angle between two vectors, one of them being almost zero";this.normalize(t,this.v1nor),this.normalize(i,this.v2nor);var s=this.dot(this.v1nor,this.v2nor);return s>1?0:s<-1?Math.PI:Math.acos(s)},t.prototype.almostParallel=function(e,t,i,s){void 0===i&&(i=!0),void 0===s&&(s=.001);var n=this.angleBetweenTwoVectorsBetween0andPi(e,t);return n<s||!!(i&&Math.PI-n<s)},t.prototype.angleBetweenTwoVectorsBetweenMinusPiAndPi=function(t,i,s){var n=this.angleBetweenTwoVectorsBetween0andPi(t,i);return e.geo.cross(t,i,this._aCros),(e.geo.dot(s,this._aCros)<0?-1:1)*n},t.prototype.slerpTwoOrthogonalVectors=function(t,i,s,n,r,o,a){this.cross(t,i,this._c0),this.cross(s,n,this._c1),this.matrixFromLines(t,i,this._c0,this._mat0),this.matrixFromLines(s,n,this._c1,this._mat1),this.matrixToQuaternion(this._mat0,this._quat0),this.matrixToQuaternion(this._mat1,this._quat1),this.slerp(this._quat0,this._quat1,r,this._quatAlpha),this.quaternionToMatrix(this._quatAlpha,this._matAlpha),e.geo.copyXyzFromFloat(this._matAlpha.m[0],this._matAlpha.m[1],this._matAlpha.m[2],o),e.geo.copyXyzFromFloat(this._matAlpha.m[4],this._matAlpha.m[5],this._matAlpha.m[7],a)},t.prototype.interpolateTwoVectors=function(e,t,i,s){s.x=e.x*(1-i)+t.x*i,s.y=e.y*(1-i)+t.y*i,s.z=e.z*(1-i)+t.z*i},t.prototype.scale=function(e,t,i){i.x=e.x*t,i.y=e.y*t,i.z=e.z*t},t.prototype.add=function(e,t,i){i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z},t.prototype.substract=function(e,t,i){i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z},t.prototype.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.prototype.norme=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)},t.prototype.squareNorme=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},t.prototype.cross=function(t,i,s){this._crossResult.x=t.y*i.z-t.z*i.y,this._crossResult.y=t.z*i.x-t.x*i.z,this._crossResult.z=t.x*i.y-t.y*i.x,e.geo.copyXYZ(this._crossResult,s)},t.prototype.orthonormalizeKeepingFirstDirection=function(t,i,s,n){if(this.normalize(t,this._result1),e.geo.copyXYZ(t,this.v1forSubstraction),this.scale(this.v1forSubstraction,this.dot(t,i),this.v1forSubstraction),this.substract(i,this.v1forSubstraction,this._result2),this.squareNorme(this._result2)<e.geo.epsilon*e.geo.epsilon)return e.geo.copyXyzFromFloat(Math.random(),Math.random(),Math.random(),this.randV2),e.logger.c("beware: you try to orthonormalize two co-linear vectors"),this.orthonormalizeKeepingFirstDirection(t,this.randV2,s,n);this.normalize(this._result2,this._result2),e.geo.copyXYZ(this._result1,s),e.geo.copyXYZ(this._result2,n)},t.prototype.getOneOrthonormal=function(t,i){Math.abs(t.x)+Math.abs(t.y)>1e-4?i.copyFromFloats(-t.y,t.x,0):i.copyFromFloats(0,-t.z,t.y),e.geo.normalize(i,i)},t.prototype.normalize=function(t,i){var s=this.norme(t);if(s<e.geo.epsilon)throw"one can not normalize a the almost zero vector:"+t;this.scale(t,1/s,i)},t.prototype.intersectionBetweenRayAndSphereFromRef=function(t,i,s,n,r,o){e.geo.copyXYZ(t,this.spheCentToRayOri),this.substract(this.spheCentToRayOri,n,this.spheCentToRayOri);var a=this.squareNorme(i),h=2*this.dot(i,this.spheCentToRayOri),l=h*h-4*a*(this.squareNorme(this.spheCentToRayOri)-s*s);if(l<0)return!1;var u=(-h+Math.sqrt(l))/2/a,c=(-h-Math.sqrt(l))/2/a;return e.geo.copyXYZ(i,this._resultInters),this.scale(this._resultInters,u,this._resultInters),this.add(this._resultInters,t,this._resultInters),e.geo.copyXYZ(this._resultInters,r),e.geo.copyXYZ(i,this._resultInters),this.scale(this._resultInters,c,this._resultInters),this.add(this._resultInters,t,this._resultInters),e.geo.copyXYZ(this._resultInters,o),!0},t.prototype.distance=function(e,t){return this.copyXYZ(e,this.difference),this.substract(this.difference,t,this.difference),this.norme(this.difference)},t.prototype.squaredDistance=function(e,t){return this.copyXYZ(e,this.difference),this.substract(this.difference,t,this.difference),this.squareNorme(this.difference)},t.prototype.closerOf=function(e,t,i,s){var n=this.distance(e,i),r=this.distance(t,i);return n<r?this.copyXYZ(e,s):this.copyXYZ(t,s),n<r?n:r},t.prototype.LookAtLH=function(t,i,s,n){this.substract(i,t,this._zAxis),this.normalize(this._zAxis,this._zAxis),this.cross(s,this._zAxis,this._xAxis),e.geo.xyzAlmostZero(this._xAxis)?this._xAxis.x=1:this._xAxis.normalize(),this.cross(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var r=-this.dot(this._xAxis,t),o=-this.dot(this._yAxis,t),a=-this.dot(this._zAxis,t);this.numbersToMM(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,r,o,a,1,n)},t.prototype.OrthoOffCenterLH=function(e,t,i,s,n,r,o){o.m[0]=2/(t-e),o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2/(s-i),o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-1/(n-r),o.m[8]=o.m[9]=o.m[11]=0,o.m[12]=(e+t)/(e-t),o.m[13]=(s+i)/(i-s),o.m[14]=n/(n-r),o.m[15]=1},t.prototype.PerspectiveFovLH=function(e,t,i,s,n){var r=1/Math.tan(.5*e);n.m[0]=r/t,n.m[1]=n.m[2]=n.m[3]=0,n.m[5]=r,n.m[4]=n.m[6]=n.m[7]=0,n.m[8]=n.m[9]=0,n.m[10]=-s/(i-s),n.m[11]=1,n.m[12]=n.m[13]=n.m[15]=0,n.m[14]=i*s/(i-s)},t.prototype.numbersToMM=function(e,t,i,s,n,r,o,a,h,l,u,c,m,p,d,g,f){f.m[0]=e,f.m[1]=t,f.m[2]=i,f.m[3]=s,f.m[4]=n,f.m[5]=r,f.m[6]=o,f.m[7]=a,f.m[8]=h,f.m[9]=l,f.m[10]=u,f.m[11]=c,f.m[12]=m,f.m[13]=p,f.m[14]=d,f.m[15]=g},t.prototype.newHermite=function(t,i,s,n,r){var o=r*r,a=r*o,h=2*a-3*o+1,l=-2*a+3*o,u=a-2*o+r,c=a-o,m=t.x*h+s.x*l+i.x*u+n.x*c,p=t.y*h+s.y*l+i.y*u+n.y*c,d=t.z*h+s.z*l+i.z*u+n.z*c;return new e.XYZ(m,p,d)},t.prototype.hermiteSpline=function(t,i,s,n,r,o){e.tab.clearArray(o);for(var a=1/r,h=0;h<r;h++)o.push(this.newHermite(t,i,s,n,h*a))},t.prototype.quadraticBezier=function(t,i,s,n,r){e.tab.clearArray(r),n=n>2?n:3;for(var o=function(e,t,i,s){return(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*s},a=0;a<n;a++)r.push(new e.XYZ(o(a/n,t.x,i.x,s.x),o(a/n,t.y,i.y,s.y),o(a/n,t.z,i.z,s.z)))},t.prototype.cubicBezier=function(t,i,s,n,r,o){e.tab.clearArray(o),r=r>3?r:4;for(var a=function(e,t,i,s,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*s+e*e*e*n},h=0;h<r;h++)o.push(new e.XYZ(a(h/r,t.x,i.x,s.x,n.x),a(h/r,t.y,i.y,s.y,n.y),a(h/r,t.z,i.z,s.z,n.z)))},t.prototype.affineTransformGenerator=function(t,i,s,n){var r=e.XYZ.newFrom(i).substract(t),o=e.XYZ.newFrom(n).substract(s);if(0==r.x&&0!=o.x)throw"impossible affine transform from a rectangle to a pavé";if(0==r.y&&0!=o.y)throw"impossible affine transform from a rectangle to a pavé";if(0==r.z&&0!=o.z)throw"impossible affine transform from a rectangle to a pavé";var a=0;if(0==r.x&&a++,0==r.y&&a++,0==r.z&&a++,a>=2)throw"intrance pavé is too degenerated";var h=new e.XYZ(0==r.x?1:1/r.x,0==r.y?1:1/r.y,0==r.z?1:1/r.z);return function(e,i){i.copyFrom(e).substract(t).multiply(h).multiply(o).add(s)}},t}();e.Geo=t;!function(t){var i=function(){function t(t,i,s){this.nbDistinctPoint=1e3,this.maxDistToBeClose=null,this.deformationFunction=function(e){return e},this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.nbDistinctPoint=s,this.recepteurList=t,null==i||t==i?(this.sourceList=t,this.sourceEqualRecepter=!0):(this.sourceList=i,this.sourceEqualRecepter=!1)}return t.prototype.go=function(){this.buildScaler();for(var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z)),i={},s=0;s<this.recepteurList.length;s++){var n=this.deformationFunction(this.recepteurList[s]),r=(a=Math.round((n.x-this.mins.x)/t.x*this.nbDistinctPoint))+","+(h=Math.round((n.y-this.mins.y)/t.y*this.nbDistinctPoint))+","+(l=Math.round((n.z-this.mins.z)/t.z*this.nbDistinctPoint));null==i[r]?i[r]=s:this.sourceEqualRecepter||e.logger.c("strange: the recepterList has several XYZ very close. This is, in general, only possible, when recepter equal source")}for(var o={},s=0;s<this.sourceList.length;s++){var n=this.deformationFunction(this.sourceList[s]),a=Math.round((n.x-this.mins.x)/t.x*this.nbDistinctPoint),h=Math.round((n.y-this.mins.y)/t.y*this.nbDistinctPoint),l=Math.round((n.z-this.mins.z)/t.z*this.nbDistinctPoint),u=i[a+","+h+","+l];null!=u&&(this.sourceEqualRecepter?u!=s&&(o[s]=u):o[s]=u)}return o},t.prototype.buildScaler=function(){var t=this;this.recepteurList.forEach(function(e){var i=t.deformationFunction(e);i.x<t.mins.x&&(t.mins.x=i.x),i.y<t.mins.y&&(t.mins.y=i.y),i.z<t.mins.z&&(t.mins.z=i.z),i.x>t.maxs.x&&(t.maxs.x=i.x),i.y>t.maxs.y&&(t.maxs.y=i.y),i.z>t.maxs.z&&(t.maxs.z=i.z)}),this.sourceEqualRecepter||this.sourceList.forEach(function(e){var i=t.deformationFunction(e);i.x<t.mins.x&&(t.mins.x=i.x),i.y<t.mins.y&&(t.mins.y=i.y),i.z<t.mins.z&&(t.mins.z=i.z),i.x>t.maxs.x&&(t.maxs.x=i.x),i.y>t.maxs.y&&(t.maxs.y=i.y),i.z>t.maxs.z&&(t.maxs.z=i.z)}),null!=this.maxDistToBeClose&&(this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose)},t}();t.CloseXYZfinder=i;var s=function(){function t(e){this.options=new r,this.hermite=new Array,this.points=e}return t.prototype.checkArgs=function(){if(null==this.points||this.points.length<2)throw"too few points"},t.prototype.go=function(){var t=this,i=new Array;if(2==this.points.length){i=[];for(m=0;m<this.options.nbSubdivisions+1;m++){var s=new e.XYZ(0,0,0);e.geo.between(this.points[0],this.points[1],m/this.options.nbSubdivisions,s),i.push(s)}this.options.loopLine&&i.push(e.XYZ.newFrom(this.points[0]))}else if(this.options.interpolationStyle==n.none)i=[],this.points.forEach(function(t){return i.push(e.XYZ.newFrom(t))}),this.options.loopLine&&i.push(e.XYZ.newFrom(this.points[0]));else if(this.options.interpolationStyle==n.hermite){var r=e.XYZ.newZero(),o=e.XYZ.newZero(),a=function(s,n,a,h){e.geo.substract(n,s,r),e.geo.substract(h,a,o),r.scale(t.options.ratioTan),o.scale(t.options.ratioTan),e.geo.hermiteSpline(n,r,a,o,t.options.nbSubdivisions,t.hermite),t.hermite.forEach(function(e){i.push(e)})},h=this.points.length-1;this.options.loopLine?a(this.points[h],this.points[0],this.points[1],this.points[2]):a(this.points[0],this.points[0],this.points[1],this.points[2]);for(m=1;m<this.points.length-2;m++)a(this.points[m-1],this.points[m],this.points[m+1],this.points[m+2]);this.options.loopLine?(a(this.points[h-2],this.points[h-1],this.points[h],this.points[0]),a(this.points[h-1],this.points[h],this.points[0],this.points[1]),i.push(this.points[0])):(a(this.points[h-2],this.points[h-1],this.points[h],this.points[h]),i.push(this.points[h]))}else{if(this.options.interpolationStyle!=n.octavioStyle)throw"line interporler style unknown";if(2==this.points.length)return[e.XYZ.newFrom(this.points[0]),e.XYZ.newFrom(this.points[1])];var h=this.points.length-1,l=e.XYZ.newZero(),u=e.XYZ.newZero(),a=function(s,n,r){e.geo.between(s,n,.5,l),e.geo.between(n,r,.5,u),e.geo.quadraticBezier(l,n,u,t.options.nbSubdivisions,t.hermite),t.hermite.forEach(function(e){i.push(e)})};if(this.options.loopLine)a(this.points[h],this.points[0],this.points[1]);else{var c=e.XYZ.newFrom(this.points[0]);i.push(c)}for(var m=1;m<this.points.length-1;m++)a(this.points[m-1],this.points[m],this.points[m+1]);if(this.options.loopLine){a(this.points[h-1],this.points[h],this.points[0]);var p=e.XYZ.newZero();e.geo.between(this.points[h],this.points[0],.5,p),i.push(p)}else{var d=e.XYZ.newFrom(this.points[h]);i.push(d)}}return i},t}();t.LineInterpoler=s;var n;!function(e){e[e.hermite=0]="hermite",e[e.octavioStyle=1]="octavioStyle",e[e.none=2]="none"}(n=t.InterpolationStyle||(t.InterpolationStyle={}));var r=function(){function e(){this.loopLine=!1,this.interpolationStyle=n.octavioStyle,this.nbSubdivisions=10,this.ratioTan=.5}return e}();t.InterpolationOption=r}(e.geometry||(e.geometry={}))}(mathis||(mathis={}));var mathis;!function(e){!function(){function e(e,t){this.a=e<t?e:t,this.b=e<t?t:e}}();!function(t){function i(t,i){for(var n=[],r=[],o=t,a=new e.HashMap,h=0,l=t;h<l.length;h++){m=l[h];n.push(m),a.putValue(m,!0)}for(;o.length>0;){r=s(o),o=[];for(var u=0,c=r;u<c.length;u++){var m=c[u];a.getValue(m)||((null==i||i.getValue(m))&&(o.push(m),n.push(m)),a.putValue(m,!0))}}return n}function s(t,i){null==i&&(i=new e.HashMap);for(var s=[],n=0,r=t;n<r.length;n++){var o=r[n];i.putValue(o,!0)}for(var a=0,h=t;a<h.length;a++)for(var l=0,u=(o=h[a]).links;l<u.length;l++){var c=u[l];i.getValue(c.to)||s.push(c.to),i.putValue(c.to,!0)}return s}function n(t,i,n){void 0===n&&(n=!1),null==i&&(i=new e.HashMap);for(var r=s(t,i),o=new e.HashMap,a=0,h=r;a<h.length;a++){var l=h[a];o.putValue(l,!0)}for(var u=0,c=s(r.concat(t));u<c.length;u++)if((l=c[u]).links.length<=4){for(var m=0,p=0,d=l.links;p<d.length;p++){var g=d[p];null!=o.getValue(g.to)&&m++}n&&2==m?(r.push(l),i.putValue(l,!0)):m>=2&&(r.push(l),i.putValue(l,!0))}return r}function r(t){var i=new e.HashMap;if(null==t||0==t.length)throw"problème d argument";var n=[];n.push(t);for(var r=s(t,i);r.length>0;)n.push(r),r=s(r,i);return n}function o(e){if(null==e||0==e.length)throw"problème d argument";var t=[];t.push(e);for(var i=e,s=n(i);s.length>0;)t.push(s),s=n(i=i.concat(s));return t}t.getGroup=i;var a=function(){function t(t){this.OUT_distances_dico=new e.HashMap,this.centralCells=t}return t.prototype.OUT_distance=function(e){return this.OUT_distances_dico.getValue(e)},t.prototype.OUT_allGeodesics=function(t,i){void 0===i&&(i=!1);for(var n=[],r=[t],o=new e.HashMap,a=this.OUT_distances_dico.getValue(t);r.length>0;){n.push(r),a--;for(var h=[],l=0,u=r=s(r,o);l<u.length;l++){var c=u[l];if(this.OUT_distances_dico.getValue(c)==a&&(h.push(c),i))break}r=h}return n},t.prototype.go=function(){var t=new e.HashMap;if(null==this.centralCells||0==this.centralCells.length)throw"problème d argument";this.OUT_stratesAround=[],this.OUT_stratesAround.push(this.centralCells);for(var i=s(this.centralCells,t);i.length>0;)this.OUT_stratesAround.push(i),i=s(i,t);for(var n=0;n<this.OUT_stratesAround.length;n++)for(var r=0,o=this.OUT_stratesAround[n];r<o.length;r++){var a=o[r];this.OUT_distances_dico.putValue(a,n)}},t}();t.DistancesFromAGroup=a;var h=function(){function e(e){this.vertices=e,this.nbTimeOfNonEvolutionToStop=2,this.lookNonEvolutionWithDistanceVersusWithGroups=!0,this.consecutiveExtremetDistances=[],this.OUT_nbIteration=0,this.OUT_twoChosenExtremeVertices=[]}return e.prototype.go=function(){for(var e,t=[this.vertices[0]],i=0,s=[];this.evolution();){this.OUT_nbIteration++,(e=new a(t)).go(),i=e.OUT_stratesAround.length;var n=e.OUT_stratesAround[i-1][0];t=[n],this.consecutiveExtremetDistances.push(i),s.push(n)}return this.OUT_twoChosenExtremeVertices=[s[this.OUT_nbIteration-1],s[this.OUT_nbIteration-2]],this.OUT_geodesicsBetweenChosenExtremeVertices=e.OUT_allGeodesics(s[this.OUT_nbIteration-1]),this.OUT_oneGeodesicBetweenChosenExtremeVertices=e.OUT_allGeodesics(s[this.OUT_nbIteration-1],!0),i-1},e.prototype.evolution=function(){if(this.lookNonEvolutionWithDistanceVersusWithGroups){var e=this.consecutiveExtremetDistances.length;if(e<this.nbTimeOfNonEvolutionToStop)return!0;for(var t=this.consecutiveExtremetDistances[e-1],i=1;i<this.nbTimeOfNonEvolutionToStop;i++)if(this.consecutiveExtremetDistances[e-1-i]!=t)return!0;return!1}throw"TODO"},e}();t.HeuristicDiameter=h;var l=function(){function t(t){this.OUT_allExtremeVertex=[],this.allCounters=new e.HashMap,this.allToTransmit=new e.HashMap,this.OUT_diameter=null,this.allVertices=t}return t.prototype.OUT_distance=function(e,t){return this.allCounters.getValue(e).getValue(t)},t.prototype.OUT_allGeodesics=function(t,i,n){void 0===n&&(n=!1);for(var r=[],o=[t],a=new e.HashMap,h=this.allCounters.getValue(t).getValue(i);o.length>0;){r.push(o),h--;for(var l=[],u=0,c=o=s(o,a);u<c.length;u++){var m=c[u];if(this.allCounters.getValue(m).getValue(i)==h&&(l.push(m),n))break}o=l}return r},t.prototype.go=function(){for(var t=0,i=this.allVertices;t<i.length;t++){var s=i[t],n=new e.HashMap(!0);n.putValue(s,0),this.allCounters.putValue(s,n),(u=new e.HashMap(!0)).putValue(s,0),this.allToTransmit.putValue(s,u)}for(var r=!0;r;){r=!1,this.allFreshlyReceived=new e.HashMap;for(var o=0,a=this.allVertices;o<a.length;o++){s=a[o];this.allFreshlyReceived.putValue(s,new e.HashMap(!0))}for(var h=0,l=this.allVertices;h<l.length;h++)for(var s=l[h],u=this.allToTransmit.getValue(s),c=0,m=s.links;c<m.length;c++)for(var p=m[c],d=this.allCounters.getValue(p.to),g=0,f=u.allKeys();g<f.length;g++){var v=f[g];null==d.getValue(v)&&(r=!0,d.putValue(v,u.getValue(v)+1),this.allFreshlyReceived.getValue(p.to).putValue(v,u.getValue(v)+1))}this.allToTransmit=this.allFreshlyReceived,this.OUT_diameter=0;for(var y=0,b=this.allVertices;y<b.length;y++)for(var s=b[y],w=0,x=this.allCounters.getValue(s).allEntries();w<x.length;w++){var M=x[w];M.value>this.OUT_diameter&&(this.OUT_diameter=M.value,this.OUT_aMaxCouple=[s,M.key],this.OUT_allExtremeVertex=[s]),M.value==this.OUT_diameter&&this.OUT_allExtremeVertex.push(s)}}},t}();t.DistancesBetweenAllVertices=l,t.getEdge=s,t.getEdgeConsideringAlsoDiagonalVoisin=n,t.ringify=r,t.ringifyConsideringAlsoDiagonalVoisin=o}(e.graph||(e.graph={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(){this.IN_graphFamily=[],this.seedsList=null,this.seedComputedFromBarycentersVersusFromAllPossibleCells=!0,this.barycenterDecay=new e.XYZ(2.34e-8,6.77e-10,9.87e-10),this.proximityCoefToGrate=[.7],this.proportionOfSeeds=[.1],this.asymmetriesForSeeds=null}return t.prototype.checkArgs=function(){if(null==this.IN_graphFamily||this.IN_graphFamily.length<2)throw"SUB_grater works from 2 graphs"},t.prototype.suppressTooCloseVertex=function(e){for(var t=[],i=0;i<e.length;i++){var s=this.proximityCoefToGrate[i%this.proximityCoefToGrate.length];t[i]=[];for(var n=0,r=e[i];n<r.length;n++){for(var o=r[n],a=!0,h=0;h<e.length&&(i==h||(a=!this.proximityMeasurer.isCloseToMe(o,e[h],s)));h++);a&&t[i].push(o)}}return t},t.prototype.findSeeds=function(){var t=[];if(this.seedComputedFromBarycentersVersusFromAllPossibleCells){for(s=0;s<this.IN_graphFamily.length;s++)t[s]=[];for(var i=[],s=0;s<this.IN_graphFamily.length;s++){i[s]=new e.XYZ(0,0,0);for(var n=0,r=this.IN_graphFamily[s];n<r.length;n++){d=r[n];i[s].add(d.position)}i[s].scale(1/this.IN_graphFamily[s].length),i[s].add(this.barycenterDecay)}for(var o=function(e,t){return t.distance-e.distance},a=0;a<this.IN_graphFamily.length;a++){for(var h=new e.XYZ(0,0,0),l=0;l<this.IN_graphFamily.length;l++)l!=a&&h.add(i[l]);h.scale(1/(this.IN_graphFamily.length-1));for(var u=[],c=new e.XYZ(0,0,0),m=0,p=this.IN_graphFamily[a];m<p.length;m++){var d=p[m];c.copyFrom(d.position).substract(h);var g=e.geo.distance(d.position,h);if(null!=this.asymmetriesForSeeds&&null!=this.asymmetriesForSeeds[a%this.asymmetriesForSeeds.length]){var f=this.asymmetriesForSeeds[a%this.asymmetriesForSeeds.length],v=e.geo.angleBetweenTwoVectorsBetween0andPi(c,f.direction),y=Math.PI;if(null!=f.modulo){if(y=f.modulo,isNaN(y)||y<0||y>Math.PI)throw"modulo must be a number between 0 and PI, but is:"+y;v=e.modulo(v,y)}var b=1-v/y;g=g*(1-f.influence)+b*f.influence}u.push({vertex:d,distance:g})}u.sort(o),t[a]=[];var w=void 0;w=this.proportionOfSeeds[a%this.proportionOfSeeds.length]>0?u[0].distance*(1-this.proportionOfSeeds[a%this.proportionOfSeeds.length]):.99*u[0].distance;for(var x=Number.MAX_VALUE,s=0;x>=w&&s<u.length-1;)t[a].push(u[s].vertex),x=u[++s].distance}}else t=this.suppressTooCloseVertex(this.IN_graphFamily);t=this.suppressTooCloseVertex(t);for(s=0;s<this.IN_graphFamily.length;s++)if(0==t[s].length)throw"an empty seeds, possible cause: 1/  two graphes are identical 2/ one of your graph is nearly includes into an other and you do not use the barycenter technique";return t},t.prototype.go=function(){this.checkArgs(),null==this.proximityMeasurer&&(this.proximityMeasurer=new s),null==this.seedsList&&(this.seedsList=this.findSeeds(),this.OUT_allSeeds=this.seedsList);for(var t=!0,i=[],n=0;n<this.IN_graphFamily.length;n++)i[n]=[].concat(this.seedsList[n]);for(var r=new e.HashMap;t;){t=!1;for(n=0;n<this.IN_graphFamily.length;n++)for(var o=this.proximityCoefToGrate[n%this.proximityCoefToGrate.length],a=0,h=e.graph.getEdge(i[n],r);a<h.length;a++){for(var l=h[a],u=!1,c=0;c<this.IN_graphFamily.length;c++)if(n!=c&&this.proximityMeasurer.isCloseToMe(l,i[c],o)){u=!0;break}u||(i[n].push(l),t=!0)}}return i},t}();t.GraphGrater=i;var s=function(){function t(){this.vertexToLinkLength=new e.HashMap}return t.prototype.meanLinksDist=function(t){var i=this.vertexToLinkLength.getValue(t);if(null!=i)return i;for(var s=0,n=0,r=t.links;n<r.length;n++){var o=r[n];s+=e.geo.distance(t.position,o.to.position)}return s/=t.links.length,this.vertexToLinkLength.putValue(t,s),s},t.prototype.isCloseToMe=function(e,t,i){for(var s=0,n=t;s<n.length;s++){var r=n[s];if(this.areClose(e,r,i))return!0}return!1},t.prototype.areClose=function(t,i,s){return e.geo.distance(t.position,i.position)<(this.meanLinksDist(t)+this.meanLinksDist(i))/2*s},t.prototype.areFar=function(t,i,s){return e.geo.distance(t.position,i.position)>(this.meanLinksDist(t)+this.meanLinksDist(i))/2*s},t}();t.ProximityMeasurer=s;var n=function(){function t(e,t){this.verticesToKeepMustBeInMamesh=!0,this.constructCutSegment=!0,this.takeCareOfPolygons=!0,this.addBorderPolygonInsteadOfSuppress=!1,this.OUT_BorderPolygon=[],this.OUT_BorderVerticesInside=[],this.OUTBorderVerticesOutside=[],this.mamesh=e,this.verticesToKeep=t}return t.prototype.go=function(){var t=this,i=new e.Mamesh;this.verticesToKeep.forEach(function(e){if(t.mamesh.hasVertex(e))i.addVertex(e);else if(t.verticesToKeepMustBeInMamesh)throw'a vertex in the list to keep is not in the original mesh. If you want to allow this, please turn the boolean "verticesToKeepMustBeInMamesh" to false'});for(f=0;f<this.mamesh.smallestSquares.length;f+=4){s=0;i.hasVertex(this.mamesh.smallestSquares[f])&&s++,i.hasVertex(this.mamesh.smallestSquares[f+1])&&s++,i.hasVertex(this.mamesh.smallestSquares[f+2])&&s++,i.hasVertex(this.mamesh.smallestSquares[f+3])&&s++,s>0&&s<4?this.OUT_BorderPolygon.push([this.mamesh.smallestSquares[f],this.mamesh.smallestSquares[f+1],this.mamesh.smallestSquares[f+2],this.mamesh.smallestSquares[f+3]]):4==s&&i.smallestSquares.push(this.mamesh.smallestSquares[f],this.mamesh.smallestSquares[f+1],this.mamesh.smallestSquares[f+2],this.mamesh.smallestSquares[f+3])}for(f=0;f<this.mamesh.smallestTriangles.length;f+=3){var s=0;i.hasVertex(this.mamesh.smallestTriangles[f])&&s++,i.hasVertex(this.mamesh.smallestTriangles[f+1])&&s++,i.hasVertex(this.mamesh.smallestTriangles[f+2])&&s++,s>0&&s<3?this.OUT_BorderPolygon.push([this.mamesh.smallestTriangles[f],this.mamesh.smallestTriangles[f+1],this.mamesh.smallestTriangles[f+2]]):3==s&&i.smallestTriangles.push(this.mamesh.smallestTriangles[f],this.mamesh.smallestTriangles[f+1],this.mamesh.smallestTriangles[f+2])}for(var n=0,r=this.OUT_BorderPolygon;n<r.length;n++)for(var o=0,a=c=r[n];o<a.length;o++){var h=a[o];i.hasVertex(h)?-1==this.OUT_BorderVerticesInside.indexOf(h)&&this.OUT_BorderVerticesInside.push(h):-1==this.OUTBorderVerticesOutside.indexOf(h)&&this.OUTBorderVerticesOutside.push(h)}if(this.takeCareOfPolygons)if(this.addBorderPolygonInsteadOfSuppress){for(var l=0,u=this.OUT_BorderPolygon;l<u.length;l++){var c=u[l];3==c.length?i.smallestTriangles.push(c[0],c[1],c[2]):4==c.length&&i.smallestSquares.push(c[0],c[1],c[2],c[3])}for(var m=0,p=this.OUTBorderVerticesOutside;m<p.length;m++){v=p[m];i.addVertex(v)}}else{for(var d=[],g=[],f=0;f<this.OUT_BorderVerticesInside.length;f++){for(var v=this.OUT_BorderVerticesInside[f],y=!1,b=0,w=i.smallestSquares;b<w.length;b++)if((h=w[b]).hashNumber==v.hashNumber){y=!0;break}if(!y)for(var x=0,M=i.smallestTriangles;x<M.length;x++)if((h=M[x]).hashNumber==v.hashNumber){y=!0;break}y||(g.push(i.vertices.indexOf(v)),d.push(f))}this.OUT_BorderVerticesInside=e.tab.arrayMinusSomeIndices(this.OUT_BorderVerticesInside,d),i.vertices=e.tab.arrayMinusSomeIndices(i.vertices,g)}if(this.constructCutSegment)for(var T in this.mamesh.cutSegmentsDico){var V=this.mamesh.cutSegmentsDico[T];i.hasVertex(V.a)&&(i.hasVertex(V.b)&&i.hasVertex(V.middle)&&(i.cutSegmentsDico[T]=V))}return i},t}();t.SubMameshExtractor=n;var r=function(){function i(e,t){this.markBorder=!0,this.suppressFromBorderVersusCorner=!0,this.mamesh=e,this.nb=t}return i.prototype.go=function(){var i=[];if(this.suppressFromBorderVersusCorner)for(var s=0,n=this.mamesh.vertices;s<n.length;s++)(a=n[s]).hasMark(e.Vertex.Markers.border)&&i.push(a);else for(var r=0,o=this.mamesh.vertices;r<o.length;r++){var a=o[r];a.hasMark(e.Vertex.Markers.corner)&&i.push(a)}var h=e.graph.ringify(i),l=new e.HashMap;if(this.nb<0&&(this.nb=h.length+this.nb-1),this.nb>=h.length-1)throw"you want to suppress too much strates";for(var u=0;u<this.nb;u++)for(var c=0,m=h[u];c<m.length;c++){f=m[c];l.putValue(f,!0)}for(var p=[],d=0,g=this.mamesh.vertices;d<g.length;d++){var f=g[d];null==l.getValue(f)&&p.push(f)}if(this.markBorder)for(var v=0,y=h[this.nb];v<y.length;v++)(f=y[v]).markers.push(e.Vertex.Markers.border);return new t.SubMameshExtractor(this.mamesh,p).go()},i}();t.ExtractCentralPart=r;!function(){function t(e,t){this.receiver=e,this.source=t}t.prototype.checkArgs=function(){if(this.receiver.length%4!=0)throw"receiver is not a list representing squares";if(this.source.length%4!=0)throw"source is not a list representing squares"},t.prototype.go=function(){this.checkArgs();for(var t=new e.HashMap(!0),i=this.squareToBaryCenter(this.source),s=this.squareToBaryCenter(this.receiver),n=0;n<i.length;n++){for(var r=Number.MAX_VALUE,o=-1,a=0;a<s.length;a++){var h=e.geo.distance(i[n],s[a]);h<r&&(r=h,o=a)}for(var l=[this.receiver[4*o],this.receiver[4*o+1],this.receiver[4*o+2],this.receiver[4*o+3]],u=[this.source[4*n],this.source[4*n+1],this.source[4*n+2],this.source[4*n+3]],c=this.getBestPermutationOfReceiver(l,u),m=0;m<4;m++)t.putValue(u[m],c[m])}return t},t.prototype.getBestPermutationOfReceiver=function(t,i){for(var s=Number.MAX_VALUE,n=-1,r=0;r<4;r++){for(var o=[t[r],t[(r+1)%4],t[(r+2)%4],t[(r+3)%4]],a=0,h=0;h<4;h++)a+=e.geo.distance(i[h].position,o[h].position);a<s&&(s=a,n=r)}var l=n;return[t[l],t[(l+1)%4],t[(l+2)%4],t[(l+3)%4]]},t.prototype.squareToBaryCenter=function(t){for(var i=[],s=0;s<t.length;s+=4){var n=[t[s].position,t[s+1].position,t[s+2].position,t[s+3].position],r=new e.XYZ(0,0,0);e.geo.baryCenter(n,[.25,.25,.25,.25],r),i.push(r)}return i}}();var o=function(){function t(e,t){this.toleranceToBeOneOfTheClosest=.5,this.proximityCoef=.7,this.acceptOnlyDisjointReceiverAndSource=!0,this.receiver=e,this.source=t}return t.prototype.checkArgs=function(){if(this.acceptOnlyDisjointReceiverAndSource){for(var t=new e.HashMap,i=0,s=this.source;i<s.length;i++){o=s[i];t.putValue(o,!0)}for(var n=0,r=this.receiver;n<r.length;n++){var o=r[n];if(null!=t.getValue(o))throw"source and receiver must be disjoint"}}},t.prototype.go=function(){this.checkArgs(),null==this.proximityMeasurer&&(this.proximityMeasurer=new s),this.checkArgs();for(var t=new e.HashMap(!0),i=0,n=this.source;i<n.length;i++){for(var r=n[i],o=Number.POSITIVE_INFINITY,a=new e.HashMap(!0),h=null,l=0,u=this.receiver;l<u.length;l++){var c=u[l],m=e.geo.distance(r.position,c.position);this.proximityMeasurer.areClose(r,c,this.proximityCoef)&&(a.putValue(c,m),m<o&&(o=m,h=c))}if(null!=h){var p=[];p.push(h);for(var d=0,g=a.allKeys();d<g.length;d++)(c=g[d])!=h&&a.getValue(c)<=o*(1+this.toleranceToBeOneOfTheClosest)&&p.push(c);t.putValue(r,p)}}return t},t}();t.FindSickingMapFromVertices=o;var a=function(){function s(){this.IN_mameshes=[],this.SUB_grater=new i,this.justGrateDoNotStick=!1,this.addMissingPolygons=!0,this.proximityCoefToStick=[2],this.toleranceToBeOneOfTheClosest=.5,this.OUTBorderVerticesToStick=[],this.OUTGratedMameshes=[],this.takeCareOfPolygons=!0,this.suppressLinksAngularlyTooClose=!0,this.SUB_linkCleanerByAngle=new e.linkModule.LinksSorterAndCleanerByAngles(null,null),this.SUB_PolygonCreatorFromLinks=new e.surfaceConnection.SurfaceConnectionProcess(null,1,!1,!0),this.OUT_stickingMap=new e.HashMap(!0),this.SUB_linkCleanerByAngle.suppressLinksAngularParam=2*Math.PI*.1}return s.prototype.checkArgs=function(){},s.prototype.goChanging=function(){this.checkArgs();for(var i=0,s=this.IN_mameshes;i<s.length;i++)for(var n=0,r=s[i].vertices;n<r.length;n++)for(var a=0,h=(_=r[n]).links;a<h.length;a++)h[a].opposites=null;var l=[];this.IN_mameshes.forEach(function(e){return l.push(e.vertices)}),this.SUB_grater.IN_graphFamily=l;for(var u=this.SUB_grater.go(),m=0;m<this.IN_mameshes.length;m++){var p=new t.SubMameshExtractor(this.IN_mameshes[m],u[m]);p.takeCareOfPolygons=this.takeCareOfPolygons,p.addBorderPolygonInsteadOfSuppress=!1,this.OUTGratedMameshes[m]=p.go(),this.OUTBorderVerticesToStick[m]=[];for(var d=0,g=p.OUT_BorderVerticesInside;d<g.length;d++)for(var f=g[d],v=0,y=f.links;v<y.length;v++){var b=y[v];if(this.IN_mameshes[m].hasVertex(b.to)&&!this.OUTGratedMameshes[m].hasVertex(b.to)){this.OUTBorderVerticesToStick[m].push(f);break}}this.OUTGratedMameshes[m].isolateMameshVerticesFromExteriorVertices();for(var w=0,x=this.OUTGratedMameshes[m].vertices;w<x.length;w++){var M=x[w];M.hasMark(e.Vertex.Markers.border)&&-1==this.OUTBorderVerticesToStick[m].indexOf(M)&&this.OUTBorderVerticesToStick[m].push(M)}}for(var T=this.OUTGratedMameshes[0],V=1;V<this.IN_mameshes.length;V++){var C=new o(T.vertices,this.OUTBorderVerticesToStick[V]);C.toleranceToBeOneOfTheClosest=this.toleranceToBeOneOfTheClosest,C.proximityCoef=this.proximityCoefToStick[V%this.proximityCoefToStick.length];var k=C.go();this.OUT_stickingMap.extend(k);var S=new c(T,this.OUTGratedMameshes[V],k);S.zIndex1=V,S.cleanOppositeLinksAtBegin=!1,S.createNewLinks=!this.justGrateDoNotStick,S.goChanging()}T.isolateMameshVerticesFromExteriorVertices();for(var O=0,A=T.vertices;O<A.length;O++){var _=A[O];if(0==_.links.length)throw" grating process produce a vertex with no links"}return this.suppressLinksAngularlyTooClose&&(this.SUB_linkCleanerByAngle.mamesh=T,this.SUB_linkCleanerByAngle.goChanging()),this.addMissingPolygons&&!this.justGrateDoNotStick&&(this.SUB_PolygonCreatorFromLinks.mamesh=T,this.SUB_PolygonCreatorFromLinks.go()),T},s}();t.ConcurrentMameshesGraterAndSticker=a;var h=function(){function t(){}return Object.defineProperty(t.prototype,"position",{get:function(){return new e.XYZ(0,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hashString",{get:function(){return"toto"},enumerable:!0,configurable:!0}),t}();t.Particle=h;var l=function(){function t(t,i){this.nbDistinctPoint=1e3,this.maxDistToBeClose=null,this.throwExceptionIfReceiverHaveCloseVertices=!1,this.receiverAndSourceMustBeDisjoint=!1,this.deformationFunction=function(e){return e},this.mins=new e.XYZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maxs=new e.XYZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.receivers=t,this.sources=i}return t.prototype.go=function(){this.buildScaler();for(var t=new e.XYZ(Math.max(1,this.maxs.x-this.mins.x),Math.max(1,this.maxs.y-this.mins.y),Math.max(1,this.maxs.z-this.mins.z)),i=new e.StringMap,s=0,n=this.receivers;s<n.length;s++){var r=n[s],o=this.deformationFunction(r.position),a=(m=Math.round((o.x-this.mins.x)/t.x*this.nbDistinctPoint))+","+(p=Math.round((o.y-this.mins.y)/t.y*this.nbDistinctPoint))+","+(d=Math.round((o.z-this.mins.z)/t.z*this.nbDistinctPoint));if(null==i.getValue(a))i.putValue(a,r);else if(this.throwExceptionIfReceiverHaveCloseVertices)throw"the receiver list has several XYZ very close, and you have forbidden that"}for(var h=new e.HashMap(!0),l=0,u=this.sources;l<u.length;l++){var c=u[l],o=this.deformationFunction(c.position),m=Math.round((o.x-this.mins.x)/t.x*this.nbDistinctPoint),p=Math.round((o.y-this.mins.y)/t.y*this.nbDistinctPoint),d=Math.round((o.z-this.mins.z)/t.z*this.nbDistinctPoint),g=i.getValue(m+","+p+","+d);if(null!=g)if(g!=c){var f=h.getValue(g);null==f?h.putValue(c,[g]):e.geo.distance(g.position,c.position)<e.geo.distance(g.position,f[0].position)?h.putValue(c,[g].concat(f)):f.push(g)}else if(this.receiverAndSourceMustBeDisjoint)throw"receiver-list and source-list are not disjoint, and you have forbidden that"}return h},t.prototype.buildScaler=function(){var t=this;this.receivers.forEach(function(e){var i=t.deformationFunction(e.position);i.x<t.mins.x&&(t.mins.x=i.x),i.y<t.mins.y&&(t.mins.y=i.y),i.z<t.mins.z&&(t.mins.z=i.z),i.x>t.maxs.x&&(t.maxs.x=i.x),i.y>t.maxs.y&&(t.maxs.y=i.y),i.z>t.maxs.z&&(t.maxs.z=i.z)}),this.sources.forEach(function(e){var i=t.deformationFunction(e.position);i.x<t.mins.x&&(t.mins.x=i.x),i.y<t.mins.y&&(t.mins.y=i.y),i.z<t.mins.z&&(t.mins.z=i.z),i.x>t.maxs.x&&(t.maxs.x=i.x),i.y>t.maxs.y&&(t.maxs.y=i.y),i.z>t.maxs.z&&(t.maxs.z=i.z)}),null!=this.maxDistToBeClose&&(this.nbDistinctPoint=e.geo.distance(this.maxs,this.mins)/this.maxDistToBeClose)},t}();t.FindCloseVerticesFast=l;var u=function(){function t(t,i,s){this.sourceEqualRecepter=!1,this.cleanDoubleSquareAndTriangles=!0,this.cleanLinksCrossingSegmentMiddle=!0,this.suppressSomeTriangleAndSquareSuperposition=!1,this.mergeLink=!0,this.mergeTrianglesAndSquares=!0,this.mergeSegmentsMiddle=!0,this.destroySource=!0,this.receiverMamesh=t,null==i||t==i?(this.sourceMamesh=t,this.sourceEqualRecepter=!0):(this.sourceMamesh=i,this.sourceEqualRecepter=!1),null==s&&(s=new l(this.receiverMamesh.vertices,this.sourceMamesh.vertices).go()),this.merginMap=new e.HashMap(!0);for(var n=0,r=s.allEntries();n<r.length;n++){var o=r[n];this.merginMap.putValue(o.key,o.value[0])}}return t.prototype.checkArgs=function(){var e=this;if(!this.merginMap.memorizeKeys)throw"the merging map must memorize the keys";this.merginMap.allValues().forEach(function(t){if(null!=e.merginMap.getValue(t))throw"a vertex cannot be the destination and the source of a merging"})},t.prototype.goChanging=function(){this.checkArgs(),this.mergeLink?this.mergeVerticesAndLinks():this.mergeOnlyVertices(),this.mergeTrianglesAndSquares&&this.letsMergeTrianglesAndSquares(),this.mergeSegmentsMiddle&&this.mergeCutSegment(),this.receiverMamesh.lines=null,this.destroySource&&!this.sourceEqualRecepter&&(this.sourceMamesh.vertices=null)},t.prototype.mergeOnlyVertices=function(){var t=this;this.sourceEqualRecepter||(this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices)),this.receiverMamesh.clearLinksAndLines(),this.merginMap.allKeys().forEach(function(i){e.tab.removeFromArray(t.receiverMamesh.vertices,i)})},t.prototype.mergeVerticesAndLinks=function(){var t=this;this.sourceEqualRecepter||(this.receiverMamesh.vertices=this.receiverMamesh.vertices.concat(this.sourceMamesh.vertices)),this.receiverMamesh.clearOppositeInLinks(),this.merginMap.allKeys().forEach(function(e){var i=t.merginMap.getValue(e),s=[];e.links.forEach(function(i){null==t.merginMap.getValue(i.to)&&t.merginMap.getValue(e)!=i.to&&s.push(i)}),i.links=i.links.concat(s),0==i.param.x&&(e.param.x=0),0==e.param.y&&(i.param.y=0)});var i=[];this.receiverMamesh.vertices.forEach(function(e){-1==t.merginMap.allKeys().indexOf(e)&&i.push(e)}),this.receiverMamesh.vertices=i,this.receiverMamesh.vertices.forEach(function(i){var s=null;i.links.forEach(function(e){null!=t.merginMap.getValue(e.to)&&(t.merginMap.getValue(e.to)!=i?e.to=t.merginMap.getValue(e.to):(null==s&&(s=[]),s.push(e)))}),null!=s&&s.forEach(function(t){e.tab.removeFromArray(i.links,t)})})},t.prototype.mergeCutSegment=function(){var t=this;if(!this.sourceEqualRecepter)for(var i in this.sourceMamesh.cutSegmentsDico)this.receiverMamesh.cutSegmentsDico[i]=this.sourceMamesh.cutSegmentsDico[i];for(var i in this.receiverMamesh.cutSegmentsDico){var s=this.receiverMamesh.cutSegmentsDico[i];if(s.a.hashNumber!=s.middle.hashNumber&&s.b.hashNumber!=s.middle.hashNumber&&s.a.hashNumber!=s.b.hashNumber){var n=!1;null!=this.merginMap.getValue(s.a)&&(s.a=this.merginMap.getValue(s.a),n=!0),null!=this.merginMap.getValue(s.b)&&(s.b=this.merginMap.getValue(s.b),n=!0),null!=this.merginMap.getValue(s.middle)&&(s.middle=this.merginMap.getValue(s.middle),n=!0),n&&(delete this.receiverMamesh.cutSegmentsDico[i],this.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(s.a.hashNumber,s.b.hashNumber)]=s)}else delete this.receiverMamesh.cutSegmentsDico[i]}this.cleanLinksCrossingSegmentMiddle&&this.receiverMamesh.vertices.forEach(function(i){for(var s=[],n=0;n<i.links.length;n++){var r=i.links[n];null!=t.receiverMamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,r.to.hashNumber)]&&s.push(n)}i.links=e.tab.arrayMinusBlocksIndices(i.links,s,1)})},t.prototype.letsMergeTrianglesAndSquares=function(){this.sourceEqualRecepter||(this.receiverMamesh.smallestSquares=this.receiverMamesh.smallestSquares.concat(this.sourceMamesh.smallestSquares),this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(this.sourceMamesh.smallestTriangles));for(i=0;i<this.receiverMamesh.smallestTriangles.length;i++){s=this.receiverMamesh.smallestTriangles[i];null!=this.merginMap.getValue(s)&&(this.receiverMamesh.smallestTriangles[i]=this.merginMap.getValue(s))}for(var t=[],i=0;i<this.receiverMamesh.smallestTriangles.length;i+=3)this.receiverMamesh.smallestTriangles[i]!=this.receiverMamesh.smallestTriangles[i+1]&&this.receiverMamesh.smallestTriangles[i+1]!=this.receiverMamesh.smallestTriangles[i+2]&&this.receiverMamesh.smallestTriangles[i+2]!=this.receiverMamesh.smallestTriangles[i]||t.push(i);this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,t,3),this.receiverMamesh.smallestTriangles=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestTriangles,3).go();for(i=0;i<this.receiverMamesh.smallestSquares.length;i++){var s=this.receiverMamesh.smallestSquares[i];null!=this.merginMap.getValue(s)&&(this.receiverMamesh.smallestSquares[i]=this.merginMap.getValue(s))}for(var n=[],i=0;i<this.receiverMamesh.smallestSquares.length;i+=4){var r=this.changeOneSquare([this.receiverMamesh.smallestSquares[i],this.receiverMamesh.smallestSquares[i+1],this.receiverMamesh.smallestSquares[i+2],this.receiverMamesh.smallestSquares[i+3]]);null==r?n.push(i):3==r.length&&(this.receiverMamesh.smallestTriangles.push(r[0],r[1],r[2]),n.push(i))}if(this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,n,4),this.cleanDoubleSquareAndTriangles&&(this.receiverMamesh.smallestSquares=new e.tab.ArrayMinusBlocksElements(this.receiverMamesh.smallestSquares,4).go()),this.suppressSomeTriangleAndSquareSuperposition){for(var o=new e.StringMap,i=0;i<this.receiverMamesh.smallestSquares.length;i+=4)o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i].hashNumber,this.receiverMamesh.smallestSquares[i+1].hashNumber,this.receiverMamesh.smallestSquares[i+2].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i+2].hashNumber,this.receiverMamesh.smallestSquares[i+3].hashNumber,this.receiverMamesh.smallestSquares[i].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i].hashNumber,this.receiverMamesh.smallestSquares[i+1].hashNumber,this.receiverMamesh.smallestSquares[i+3].hashNumber]),!0),o.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i+1].hashNumber,this.receiverMamesh.smallestSquares[i+2].hashNumber,this.receiverMamesh.smallestSquares[i+3].hashNumber]),!0);for(var a=[],i=0;i<this.receiverMamesh.smallestTriangles.length;i+=3){var h=e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestTriangles[i].hashNumber,this.receiverMamesh.smallestTriangles[i+1].hashNumber,this.receiverMamesh.smallestTriangles[i+2].hashNumber]);o.getValue(h)&&a.push(i,i+1,i+2)}this.receiverMamesh.smallestTriangles=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestTriangles,a,3);for(var l=new e.StringMap,i=0;i<this.receiverMamesh.smallestSquares.length;i+=4)l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i].hashNumber,this.receiverMamesh.smallestSquares[i+2].hashNumber]),!0),l.putValue(e.tab.indicesUpPermutationToString([this.receiverMamesh.smallestSquares[i+1].hashNumber,this.receiverMamesh.smallestSquares[i+3].hashNumber]),!0);for(var u=[],c=[],i=0;i<this.receiverMamesh.smallestSquares.length;i+=4)for(var m=0;m<4;m++){var p=[this.receiverMamesh.smallestSquares[i+m].hashNumber,this.receiverMamesh.smallestSquares[i+(m+1)%4].hashNumber],d=[this.receiverMamesh.smallestSquares[i+(m+1)%4].hashNumber,this.receiverMamesh.smallestSquares[i+(m+2)%4].hashNumber];l.getValue(e.tab.indicesUpPermutationToString(p))&&l.getValue(e.tab.indicesUpPermutationToString(d))&&(u.push(i,i+1,i+2,i+3),c.push(this.receiverMamesh.smallestSquares[i+(m+2)%4],this.receiverMamesh.smallestSquares[i+(m+3)%4],this.receiverMamesh.smallestSquares[i+m%4]))}c.length>0&&(this.receiverMamesh.smallestSquares=e.tab.arrayMinusBlocksIndices(this.receiverMamesh.smallestSquares,u,4),this.receiverMamesh.smallestTriangles=this.receiverMamesh.smallestTriangles.concat(c))}},t.prototype.changeOneSquare=function(e){if(e[0]==e[2]||e[1]==e[3])return null;for(var t=null,i=0,s=0;s<4;s++)e[s]==e[(s+1)%4]&&(i++,t=s);return 0==i?e:i>1?null:0==t?[e[1],e[2],e[3]]:1==t?[e[2],e[3],e[0]]:2==t?[e[3],e[0],e[1]]:3==t?[e[0],e[1],e[2]]:void 0},t}();t.Merger=u;var c=function(){function e(e,t,i){this.createNewLinks=!0,this.cleanOppositeLinksAtBegin=!0,this.twoMameshes=!0,this.zIndex1=Math.random(),e!=t&&null!=t||(this.twoMameshes=!1),this.mamesh0=e,this.twoMameshes?this.mamesh1=t:this.mamesh1=null,this.stickingMap=i}return e.prototype.checkArgs=function(){if(!this.stickingMap.memorizeKeys)throw"the sticking map must memorize the keys";for(var e=0,t=this.stickingMap.allValues();e<t.length;e++)for(var i=0,s=t[e];i<s.length;i++){var n=s[i];if(null!=this.stickingMap.getValue(n))throw"a vertex cannot be the destination and the source of a sticking"}},e.prototype.goChanging=function(){if(0!=this.stickingMap.allKeys().length){if(this.checkArgs(),this.cleanOppositeLinksAtBegin&&(this.mamesh0.clearOppositeInLinks(),this.twoMameshes&&this.mamesh1.clearOppositeInLinks()),this.twoMameshes){for(var e=0,t=this.mamesh1.vertices;e<t.length;e++){var i=t[e];i.param.z=this.zIndex1,this.mamesh0.addVertex(i)}this.mamesh0.smallestSquares=this.mamesh0.smallestSquares.concat(this.mamesh1.smallestSquares),this.mamesh0.smallestTriangles=this.mamesh0.smallestTriangles.concat(this.mamesh1.smallestTriangles)}if(this.mamesh0.cutSegmentsDico={},this.mamesh0.vertexToPositioning=null,this.mamesh0.lines=null,this.createNewLinks)for(var s=0,n=this.stickingMap.allKeys();s<n.length;s++)for(var r=n[s],o=0,a=this.stickingMap.getValue(r);o<a.length;o++){var h=a[o];r.setOneLink(h),h.setOneLink(r)}}},e}();t.Sticker=c}(e.grateAndGlue||(e.grateAndGlue={}))}(mathis||(mathis={}));var mathis;!function(e){function t(t,i){for(var s=[],n=e.roundWithGivenPrecision(100/t,2)+"%",r=0;r<t;r++){var o=document.createElement("canvas");o.id="renderCanvas"+r,o.style.width=n,o.style.height="100%",o.style.backgroundColor="red",i.appendChild(o),s.push(o)}return s}function i(t,i,s){var n=[];i.style.position="relative";for(var r=e.roundWithGivenPrecision(100/t,4),o=0;o<t;o++){var a=document.createElement("div");a.id="divContainer"+o,a.style.display="inline-block",a.style.position="absolute",a.style.top="0",a.style.left=o*r+"%",a.style.width=r+"%",a.style.height="100%",null!=s&&o>0&&(a.style.borderLeft=s),i.appendChild(a),n.push(a)}return n}function s(t,i,s){var n=[],r=[];i.style.position="relative";for(var o=e.roundWithGivenPrecision(100/t,4),a=0;a<t;a++){var h=document.createElement("div");h.id="divContainer"+a,h.style.display="inline-block",h.style.position="absolute",h.style.top="0",h.style.left=a*o+"%",h.style.width=o+"%",h.style.height="100%",null!=s&&a>0&&(h.style.borderLeft=s),i.appendChild(h),r.push(h);var l=document.createElement("canvas");l.id="renderCanvas"+a,l.style.width="100%",l.style.height="100%",h.appendChild(l),n.push(l)}return{divs:r,canvass:n}}function n(e,t,i,s){void 0===i&&(i=!0);var n=document.createElement("div");return n.style.display="inline-block",n.style.position="absolute",i?n.style.bottom="0":n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height=e,n.style.zIndex=parseInt(t.style.zIndex)+10+"",null!=s&&(n.style.borderTop=s),t.appendChild(n),n}e.nCanvasInOneLine=t,e.nDivInOneLine=i,e.nDivContainningCanvasInOneLine=s,e.legend=n}(mathis||(mathis={}));var mathis;!function(e){function t(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var s=parseInt(i);isNaN(s)||t.push(s)}return t}function i(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&isNaN(parseInt(i))&&t.push(i);return t}function s(e,t){return e*=Math.pow(10,t),e=Math.round(e),e/=Math.pow(10,t)}function n(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(i){"constructor"!==i&&(e.prototype[i]=t.prototype[i])})})}function r(e,t){var i;document.getElementById&&(i=document.getElementById(e))&&i.style&&(i.style.cursor=t)}function o(e,t,i){if(void 0===i&&(i=!1),t<0)throw"second arg must be positif";var s=0;return s=e>=0?e%t:t- -e%t,i&&s>t/2&&(s-=t),Math.abs(s-t)<10*Number.MIN_VALUE&&(s=0),s}function a(e){for(var t,i,s=e.length;s>0;)i=Math.floor(Math.random()*s),t=e[--s],e[s]=e[i],e[i]=t;return e}e.allIntegerValueOfEnume=t,e.allStringValueOfEnume=i;var h=function(){function e(){this.showTrace=!1,this.alreadyWroteWarning=[]}return e.prototype.c=function(e,t){if(void 0===t&&(t=1),null!=this.alreadyWroteWarning[e]?this.alreadyWroteWarning[e]++:this.alreadyWroteWarning[e]=1,this.alreadyWroteWarning[e]<=t)if(this.showTrace){var i=new Error;console.log("WARNING",e,"...........................................",i)}else console.log("WARNING",e)},e}();e.Logger=h,e.roundWithGivenPrecision=s,e.applyMixins=n,e.setCursorByID=r;var l=function(){function e(){this.millisDuration=0,this.nbTested=0,this.nbOK=0,this.millisDep=performance.now()}return e.prototype.computeTime=function(){this.millisDuration=performance.now()-this.millisDep},e.prototype.add=function(e){e.computeTime(),this.nbTested+=e.nbTested,this.nbOK+=e.nbOK,this.millisDuration+=e.millisDuration},e.prototype.assertTrue=function(e){if(this.nbTested++,e)this.nbOK++;else{var t=new Error;console.log(t.stack)}},e.prototype.toString=function(){return"nbTest:"+this.nbTested+", nbOK:"+this.nbOK+", millisDuration:"+this.millisDuration.toFixed(2)},e}();e.Bilan=l,e.modulo=o,e.shuffle=a;var u=function(){function e(e,t){this.key=e,this.value=t}return e}();e.Entry=u;var c=function(){function e(e){void 0===e&&(e=!1),this.values={},this.keys={},this.memorizeKeys=e}return e.prototype.putValue=function(e,t,i){if(void 0===i&&(i=!0),null==e){if(i)throw"key must be non null";return null}this.values[e.hashString]=t,this.memorizeKeys&&(this.keys[e.hashString]=e)},e.prototype.removeKey=function(e){delete this.values[e.hashString],this.memorizeKeys&&delete this.keys[e.hashString]},e.prototype.getValue=function(e,t){if(void 0===t&&(t=!0),null==e){if(t)throw"key must be non null";return null}return this.values[e.hashString]},e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e},e.prototype.allKeys=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=new Array;for(var t in this.keys)e.push(this.keys[t]);return e},e.prototype.allEntries=function(){if(!this.memorizeKeys)throw"this hashMap has not memorized keys. Please, put args=true in the constructor";var e=[];for(var t in this.keys)e.push(new u(this.keys[t],this.values[t]));return e},e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]},e.prototype.extend=function(e){if(!e.memorizeKeys)throw"cannot extend this  with a HashMap which do not memorize keys";for(var t=0,i=e.allEntries();t<i.length;t++){var s=i[t];this.putValue(s.key,s.value)}},e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e},e}();e.HashMap=c;var m=function(){function e(){this.values={}}return e.prototype.putValue=function(e,t,i){if(void 0===i&&(i=!0),null==e){if(i)throw"key must be non null";return null}this.values[e]=t},e.prototype.removeKey=function(e){delete this.values[e]},e.prototype.getValue=function(e,t){if(void 0===t&&(t=!0),null==e){if(t)throw"key must be non null";return null}return this.values[e]},e.prototype.allValues=function(){var e=new Array;for(var t in this.values)e.push(this.values[t]);return e},e.prototype.allKeys=function(){return Object.keys(this.values)},e.prototype.aRandomValue=function(){var e=Object.keys(this.values);return this.values[e[Math.floor(e.length*Math.random())]]},e.prototype.size=function(){var e=0;for(var t in this.values)e++;return e},e.prototype.__serialize=function(){return this.values},e.prototype.__load=function(e){this.values=e},e}();e.StringMap=m}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t,i){function s(t,o,a,h){var l=o[o.length-1],u=o[o.length-2];n.putValue(new e.Segment(u,l),!0);var c=l.getOpposites(u);if(null==c)t&&e.logger.c("strange : probably, the function makeLineCatalogue2 have as args a non complete graph (call getGroup before)"),r.push(new e.Line(o,!1));else{if(0==c.length)throw"convention: is no opposite, the array opposite must be null, and not empty";if(1==a.getValue(new e.Segment(u,l)))r.push(new e.Line(o,!1));else{a.putValue(new e.Segment(u,l),!0);var m=c.length;i||(m=1);for(var p=0;p<m;p++){var d=c[p];if(d==o[0])r.push(new e.Line(o,!0)),n.putValue(new e.Segment(l,o[0]),!0);else if(p<m-1){for(var g=new e.HashMap,f=0;f<o.length-1;f++)g.putValue(new e.Segment(o[f],o[f+1]),!0);s(t,o.concat([d]),g,!0)}else o.push(d),s(t,o,a,h)}}}}var n=new e.HashMap,r=[];if(t.forEach(function(t){t.links.forEach(function(r){null==r.opposites&&(i||null==n.getValue(new e.Segment(t,r.to)))&&s(!1,[t,r.to],new e.HashMap,!1)})}),i){for(var o=new e.HashMap,a=[],h=0,l=r;h<l.length;h++){var u=l[h];null==o.getValue(u)&&a.push(u),o.putValue(u,!0)}r=a}return t.forEach(function(t){t.links.forEach(function(i){null==n.getValue(new e.Segment(t,i.to))&&s(!0,[t,i.to],new e.HashMap,!1)})}),r}var s=function(){function t(e){this.startingVertices=null,this.startingSegments=null,this.restrictLinesToTheseVertices=null,this.lookAtBifurcation=!0,this.mamesh=e}return t.prototype.go=function(){if(null==this.mamesh)throw" a null mamesh";if(null==this.mamesh.vertices||0==this.mamesh.vertices.length)throw"no vertices in this mamesh";this.mamesh.linesWasMade&&e.logger.c("lines already exist for this mamesh");var t=i(this.mamesh.vertices,this.lookAtBifurcation),s=[];if(null!=this.startingVertices){for(var r=new e.HashMap,o=0,a=this.startingVertices;o<a.length;o++){var h=a[o];r.putValue(h,!0)}for(var l=0,u=t;l<u.length;l++)for(var c=0,m=(M=u[l]).vertices;c<m.length;c++){var p=m[c];if(null!=r.getValue(p)){s.push(M);break}}}if(null!=this.startingSegments){for(var d=new e.StringMap,g=0,f=this.startingSegments;g<f.length;g++){var v=f[g],y=v[0],b=v[1];d.putValue(e.Hash.segment(y,b),!0)}for(var w=0,x=t;w<x.length;w++){var M=x[w],T=0;M.isLoop&&(T=1);for(var V=0;V<M.vertices.length+T;V++)if(1==d.getValue(e.Hash.segment(M.vertices[V],M.vertices[(V+1)%M.vertices.length]))){s.push(M);break}}}return null==this.startingVertices&&null==this.startingSegments&&(s=t),null!=this.restrictLinesToTheseVertices&&(s=new n(s,this.restrictLinesToTheseVertices).go()),s},t}();t.LineComputer=s;var n=function(){function t(e,t){this.lines=e,this.vertices=t}return t.prototype.go=function(){var t=this;this.allPresentVertices=new e.HashMap;for(var i=0,s=this.vertices;i<s.length;i++){var n=s[i];this.allPresentVertices.putValue(n,!0)}var r=[];return this.lines.forEach(function(i){if(!i.isLoop)for(var s=0,n=t.cutOneLine(i.vertices);s<n.length;s++){var o=n[s];r.push(new e.Line(o,!1))}}),this.lines.forEach(function(i){if(i.isLoop){for(var s=i.vertices,n=-1,o=0;o<s.length;o++)if(null==t.allPresentVertices.getValue(s[o])){n=o;break}if(-1==n)r.push(i);else{for(var a=[],h=0;h<s.length;h++)a.push(s[(h+n)%s.length]);for(var l=0,u=t.cutOneLine(a);l<u.length;l++){var c=u[l];r.push(new e.Line(c,!1))}}}}),r},t.prototype.cutOneLine=function(e){var t=[];t[0]=[];for(var i=-1,s=!0,n=0;n<e.length;n++)1==this.allPresentVertices.getValue(e[n])?s?(t[++i]=[],t[i].push(e[n]),s=!1):t[i].push(e[n]):s=!0;var r=[];return t.forEach(function(e){e.length>=2&&r.push(e)}),r},t}();t.LinesCuter=n,t.makeLineCatalogue2=i;var r=function(e){function t(){return e.call(this,!0)||this}return __extends(t,e),t}(e.HashMap),o=function(){function t(e){this.packSymmetricLines=!0,this.forSymmetriesUsePositionVersusParam=!0,this.useConsecutiveIntegerForPackNumber=!0,this.symmetries=null,this.OUT_nbFoundSymmetricLines=0,this.OUT_lineIndexToColorIndex=[],this.mamesh=e}return t.prototype.go=function(){if(!this.mamesh.linesWasMade)throw"no line for this IN_mamesh";for(var t=[],i=0,s=new e.HashMap,n=0,o=this.mamesh.lines;n<o.length;n++){for(var a=[],h=[],l=0,u=(V=o[n]).allSegments();l<u.length;l++){d=u[l];null!=s.getValue(d)?a.push(d):h.push(d)}if(0==a.length){var c=new r;c.index=i++;for(var m=0,p=V.allSegments();m<p.length;m++){var d=p[m];c.putValue(d,!0),s.putValue(d,c)}}else{for(var g=s.getValue(a[0]),f=1;f<a.length;f++)this.segmentAndHisPackJoinNewPack(a[f],g,s);for(var v=0,y=h;v<y.length;v++){var b=y[v];g.putValue(b,!0),s.putValue(b,g)}}}if(null!=this.symmetries){e.XYZ.nbDecimalForHash=1;for(var w=new e.StringMap,f=0;f<this.mamesh.lines.length;f++){var x=(V=this.mamesh.lines[f]).hashStringUpToSymmetries(this.symmetries,this.forSymmetriesUsePositionVersusParam),M=w.getValue(x);if(null==M)w.putValue(x,s.getValue(new e.Segment(V.vertices[0],V.vertices[1])));else{this.OUT_nbFoundSymmetricLines++;var T=s.getValue(new e.Segment(V.vertices[0],V.vertices[1]));T.size()==M.size()&&(T.index=M.index)}}e.XYZ.nbDecimalForHash=5}for(f=0;f<this.mamesh.lines.length;f++){var V=this.mamesh.lines[f];t[f]=s.getValue(new e.Segment(V.vertices[0],V.vertices[1])).index}if(this.useConsecutiveIntegerForPackNumber&&this.packSymmetricLines){for(var C=[],k=t[e.tab.maxIndexOfNumericList(t)],S=0,O=0;O<=k;O++){for(var A=!1,_=0;_<t.length;_++)t[_]==O&&(C[_]=O-S,A=!0);A||S++}t=C}for(var P=new e.HashMap,f=0;f<this.mamesh.lines.length;f++)P.putValue(this.mamesh.lines[f],t[f]),this.OUT_lineIndexToColorIndex[f]=t[f];return P},t.prototype.segmentAndHisPackJoinNewPack=function(e,t,i){for(var s=0,n=i.getValue(e).allKeys();s<n.length;s++){var r=n[s];t.putValue(r,!0),i.putValue(r,t)}i.putValue(e,t)},t}();t.CreateAColorIndexRespectingBifurcationsAndSymmetries=o}(e.lineModule||(e.lineModule={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(e){this.mamesh=e}return t.prototype.goChanging=function(){this.mamesh.clearLinksAndLines();for(var t=new e.StringMap,i=0,s=this.mamesh.polygons;i<s.length;i++)for(var n=s[i],r=0;r<n.length;r++){var o=e.Segment.segmentId(n[r].hashNumber,n[(r+1)%n.length].hashNumber);null==t.getValue(o)&&(t.putValue(o,!0),n[r].setOneLink(n[(r+1)%n.length]),n[(r+1)%n.length].setOneLink(n[r]))}},t}();t.SimpleLinkFromPolygonCreator=i;var s=function(){function t(e,t){this.normals=t,this.suppressLinksAngularlyTooCloseVersusNot=!0,this.suppressLinksAngularParam=2*Math.PI*.1,this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite=!0,this.mamesh=e}return t.prototype.goChanging=function(){var t=this;if(null==this.mamesh)throw"mamesh is null";if(null==this.normals)this.vertexToPositioning=new e.mameshAroundComputations.PositioningComputerForMameshVertices(this.mamesh).go();else if(this.normals instanceof e.HashMap)this.vertexToPositioning=this.normals;else if(this.normals instanceof e.XYZ){this.vertexToPositioning=new e.HashMap;var i=new e.Positioning;i.upVector=this.normals;for(var s=0,n=this.mamesh.vertices;s<n.length;s++){var r=n[s];this.vertexToPositioning.putValue(r,i)}}this.mamesh.vertices.forEach(function(i){for(var s=[],n=0;n<i.links.length;n++)if(s[n]=new e.XYZ(0,0,0).copyFrom(i.links[n].to.position).substract(i.position),s[n].length()<e.geo.epsilon)throw"a IN_mamesh with two voisins at the same position";var r=[];r.push({angle:0,i:0});for(var o=t.vertexToPositioning.getValue(i).upVector,n=1;n<i.links.length;n++)r.push({angle:e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(s[0],s[n],o),i:n});r.sort(function(e,t){return e.angle-t.angle});for(var a=[],h=0;h<r.length;h++)a.push(i.links[r[h].i]);i.links=a}),this.suppressLinksAngularlyTooCloseVersusNot&&this.letsSuppressLinks()},t.prototype.letsSuppressLinks=function(){for(var t=0,i=this.mamesh.vertices;t<i.length;t++)for(var s=i[t],n=0,r=!0;r&&s.links.length>=2;){r=!1;for(var o=n;o<n+s.links.length;o++){var a=o%s.links.length,h=(o+1)%s.links.length,l=e.XYZ.newFrom(s.links[a].to.position).substract(s.position),u=e.XYZ.newFrom(s.links[h].to.position).substract(s.position);if(e.geo.angleBetweenTwoVectorsBetween0andPi(l,u)<this.suppressLinksAngularParam){var c=e.geo.distance(s.position,s.links[a].to.position),m=e.geo.distance(s.position,s.links[h].to.position),p=void 0;if(this.keepShorterLinksVersusGiveSomePriorityToLinksWithOpposite)p=c<m?s.links[h]:s.links[a];else{var d=c/(c+m);p=d<.6&&d>.4?null==s.links[h].opposites&&null!=s.links[a].opposites?s.links[h]:s.links[a]:c<m?s.links[h]:s.links[a]}e.Vertex.separateTwoVoisins(s,p.to),r=!0,n=h+1;break}}}},t}();t.LinksSorterAndCleanerByAngles=s;var n=function(){function t(e){this.maxAngleToAssociateLinks=.3*Math.PI,this.clearAllExistingOppositeBefore=!1,this.canCreateBifurcations=!0,this.doNotBranchOnBorder=!1,this.OUT_nbBranching=0,this.vertices=e}return t.prototype.associateOppositeLinks=function(){var t=this;this.vertices.forEach(function(i){for(var s=0,n=0,r=i.links;n<r.length;n++)null==r[n].opposites&&s++;for(var o=[],a=0;a<i.links.length;a++)if(o[a]=new e.XYZ(0,0,0).copyFrom(i.links[a].to.position).substract(i.position),o[a].lengthSquared()<e.geo.epsilonSquare)throw"the IN_mamesh has two voisins at the same position";for(var h=[],l=[],a=0;a<i.links.length;a++){l[a]=Number.POSITIVE_INFINITY;for(var u=a+1;u<i.links.length;u++){var c=Math.abs(e.modulo(e.geo.angleBetweenTwoVectorsBetween0andPi(o[a],o[u])-Math.PI,2*Math.PI,!0));c<t.maxAngleToAssociateLinks&&null==i.links[a].opposites&&null==i.links[u].opposites&&(c<l[a]&&(l[a]=c),h.push({angle:c,i:a,j:u}))}}if(h.sort(function(e,t){return t.angle-e.angle}),!t.canCreateBifurcations||t.doNotBranchOnBorder&&i.hasMark(e.Vertex.Markers.border))for(;h.length>0;){var m=h.pop(),p=i.links[m.i],d=i.links[m.j];p.opposites=[d],d.opposites=[p],h=e.tab.arrayMinusElements(h,function(e){return e.i==m.i||e.j==m.i||e.i==m.j||e.j==m.j})}else for(;h.length>0;){var m=h.pop(),g=h[h.length-1],p=void 0,d=void 0,f=void 0;3==s&&null!=g?m.i==g.i?(p=i.links[m.i],d=i.links[m.j],f=i.links[g.j]):m.i==g.j?(p=i.links[m.i],d=i.links[m.j],f=i.links[g.i]):m.j==g.i?(p=i.links[m.j],d=i.links[m.i],f=i.links[g.j]):m.j==g.j?(p=i.links[m.j],d=i.links[m.i],f=i.links[g.i]):(p=i.links[m.i],d=i.links[m.j]):(p=i.links[m.i],d=i.links[m.j]),null==f?(p.opposites=[d],d.opposites=[p],h=e.tab.arrayMinusElements(h,function(e){return e.i==m.i||e.j==m.i||e.i==m.j||e.j==m.j}),s-=2):(t.OUT_nbBranching++,h.pop(),p.opposites=[d,f],d.opposites=[p],f.opposites=[p],s-=1,h=e.tab.arrayMinusElements(h,function(e){return e.i==m.i||e.j==m.i||e.i==m.j||e.j==m.j||e.i==g.i||e.j==g.i||e.i==g.j||e.j==g.j}))}})},t.prototype.goChanging=function(){this.clearAllExistingOppositeBefore&&this.vertices.forEach(function(e){e.links.forEach(function(e){e.opposites=null})}),null!=this.maxAngleToAssociateLinks&&this.associateOppositeLinks()},t}();t.OppositeLinkAssocierByAngles=n;var r=function(){function t(t){this.interiorTJonction=new e.HashMap,this.borderTJonction=new e.HashMap,this.forcedOpposite=new e.HashMap,this.polygonesAroundEachVertex=new e.HashMap,this.polygones=[],this.markIsolateVertexAsCorner=!0,this.markBorder=!0,this.forceOppositeLinksAtCorners=!1,this.mamesh=t}return t.prototype.goChanging=function(){this.checkArgs(),this.createPolygonesFromSmallestTrianglesAnSquares(),this.detectBorder(),this.createLinksTurningAround(),this.makeLinksFinaly()},t.prototype.checkArgs=function(){if(!(null!=this.mamesh.smallestSquares&&0!=this.mamesh.smallestSquares.length||null!=this.mamesh.smallestTriangles&&0!=this.mamesh.smallestTriangles.length))throw"no triangles nor squares given";this.mamesh.clearLinksAndLines()},t.prototype.createPolygonesFromSmallestTrianglesAnSquares=function(){for(var t=this,i=0;i<this.mamesh.smallestTriangles.length;i+=3)this.polygones.push(new o([this.mamesh.smallestTriangles[i],this.mamesh.smallestTriangles[i+1],this.mamesh.smallestTriangles[i+2]]));for(i=0;i<this.mamesh.smallestSquares.length;i+=4)this.polygones.push(new o([this.mamesh.smallestSquares[i],this.mamesh.smallestSquares[i+1],this.mamesh.smallestSquares[i+2],this.mamesh.smallestSquares[i+3]]));for(var s=0,n=this.polygones;s<n.length;s++)for(var r=n[s],a=r.points.length,i=0;i<a;i++){var h=r.points[i%a],l=r.points[(i+1)%a];this.subdivideSegment(r,h,l,this.mamesh.cutSegmentsDico)}this.mamesh.vertices.forEach(function(e){t.polygonesAroundEachVertex.putValue(e,new Array)}),this.polygones.forEach(function(e){e.points.forEach(function(i){t.polygonesAroundEachVertex.getValue(i).push(e)})}),this.markIsolateVertexAsCorner&&this.mamesh.vertices.forEach(function(i){1==t.polygonesAroundEachVertex.getValue(i).length&&(i.markers.push(e.Vertex.Markers.corner),e.logger.c("new corners was added when we automatically create then links from the triangulatedRect/square"))})},t.prototype.detectBorder=function(){for(var t=this,i=0;i<this.mamesh.vertices.length;i++){for(var s=this.mamesh.vertices[i],n=this.polygonesAroundEachVertex.getValue(s),r=new e.HashMap(!0),o=0,a=n;o<a.length;o++){var h=a[o].theTwoAnglesAdjacentFrom(s),l=h[0],u=h[1];null==r.getValue(l)?r.putValue(l,1):r.putValue(l,r.getValue(l)+1),null==r.getValue(u)?r.putValue(u,1):r.putValue(u,r.getValue(u)+1)}var c=0;if(r.allKeys().forEach(function(i){if(1==r.getValue(i))c++,null==t.borderTJonction.getValue(s)&&(t.borderTJonction.putValue(s,new Array),t.markBorder&&s.markers.push(e.Vertex.Markers.border)),t.borderTJonction.getValue(s).push(i);else if(r.getValue(i)>2)throw" non conform mesh: a link appear strictly more than 2 times as side of polygones turning around a vertex   "}),0!=c&&2!=c)throw"strange mesh (perhaps too holy): the vertex: "+s.toString(0)+" has:"+c+" link with multiplicity 1"}},t.prototype.createLinksTurningAround=function(){for(var t=this,i=function(i,s){var n=t.mamesh.cutSegmentsDico[e.Segment.segmentId(i.hashNumber,s.hashNumber)];null!=n&&(null!=t.interiorTJonction.getValue(n.middle)?console.log("attention, une double interiorTjonction"):t.interiorTJonction.putValue(n.middle,!0),t.forcedOpposite.putValue(n.middle,[i,s]))},s=0,n=this.polygones;s<n.length;s++){var r=n[s],o=r.points.length;if(o>3)if(4==o)i(r.points[0],r.points[2]),i(r.points[1],r.points[3]);else for(var a=0;a<o;a++)i(r.points[a],r.points[(a+2)%o])}this.mamesh.vertices.forEach(function(i){var s=t.polygonesAroundEachVertex.getValue(i);if(null!=t.borderTJonction.getValue(i)&&null!=t.interiorTJonction.getValue(i))throw"a vertex cannot be a interior and border T-jonction";if(null==t.borderTJonction.getValue(i)){var n=s[0];null==n?e.logger.c("some vertex was not around a square/triangulatedRect"):t.createLinksTurningFromOnePolygone(i,n,s,!1)}else{var r=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[0],s);null==r&&(r=t.findAPolygoneWithOrientedEdge(i,t.borderTJonction.getValue(i)[1],s)),t.createLinksTurningFromOnePolygone(i,r,s,!0)}})},t.prototype.makeLinksFinaly=function(){var t=this;this.mamesh.vertices.forEach(function(i){if(t.forceOppositeLinksAtCorners||!i.hasMark(e.Vertex.Markers.corner)){var s=i.links.length;if(null!=t.borderTJonction.getValue(i)){var n=i.links[0],r=i.links[s-1];n.opposites=[r],r.opposites=[n]}else{if(s%2==0)for(var o=0;o<s;o++){var n=i.links[o],r=i.links[(o+s/2)%s];n.opposites=[r],r.opposites=[n]}if(null!=t.forcedOpposite.getValue(i)){var a=t.forcedOpposite.getValue(i)[0],h=t.forcedOpposite.getValue(i)[1];i.changeToLinkWithoutOpposite(a),i.changeToLinkWithoutOpposite(h),i.setTwoOppositeLinks(a,h)}}}})},t.prototype.findAPolygoneWithOrientedEdge=function(e,t,i){for(var s=0,n=i;s<n.length;s++)for(var r=n[s],o=r.points.length,a=0;a<o;a++)if(r.points[a%o].hashNumber==e.hashNumber&&r.points[(a+1)%o].hashNumber==t.hashNumber)return r;return null},t.prototype.findAPolygoneWithThisEdge=function(t,i,s){for(var n=0,r=s;n<r.length;n++)for(var o=r[n],a=o.points.length,h=0;h<a;h++)if(e.Segment.segmentId(o.points[h%a].hashNumber,o.points[(h+1)%a].hashNumber)==e.Segment.segmentId(t.hashNumber,i.hashNumber))return o;return null},t.prototype.createLinksTurningFromOnePolygone=function(t,i,s,n){for(var r=i.theOutgoingAnglesAdjacentFrom(t),o=i,a=!0;s.length>0;){if(t.links.push(new e.Link(r)),a)r=o.theIngoingAnglesAdjacentFrom(t);else{var h=o.theTwoAnglesAdjacentFrom(t);r=h[0].hashNumber==r.hashNumber?h[1]:h[0]}e.tab.removeFromArray(s,o),null==(o=this.findAPolygoneWithOrientedEdge(t,r,s))&&(o=this.findAPolygoneWithOrientedEdge(r,t,s),a=!1)}n&&t.links.push(new e.Link(r))},t.prototype.subdivideSegment=function(t,i,s,n){var r=n[e.Segment.segmentId(i.hashNumber,s.hashNumber)];if(null!=r){var o=t.points.indexOf(i),a=t.points.indexOf(s),h=Math.min(o,a);Math.max(o,a)==t.points.length-1&&0==h?t.points.splice(length,0,r.middle):t.points.splice(h+1,0,r.middle),this.subdivideSegment(t,i,r.middle,n),this.subdivideSegment(t,s,r.middle,n)}},t}();t.LinkCreaterSorterAndBorderDetecterByPolygons=r;var o=function(){function e(e){this.points=e}return e.prototype.hasAngle=function(e){for(var t=0,i=this.points;t<i.length;t++)if(i[t].hashNumber==e.hashNumber)return!0;return!1},e.prototype.theOutgoingAnglesAdjacentFrom=function(e){for(var t=this.points.length,i=0;i<t;i++)if(this.points[i]==e)return this.points[(i+1)%t];throw"we do not find the point in this polygone"},e.prototype.theIngoingAnglesAdjacentFrom=function(e){for(var t=this.points.length,i=0;i<t;i++)if(this.points[i]==e)return this.points[(i-1+t)%t];throw"we do not find the point in this polygone"},e.prototype.theTwoAnglesAdjacentFrom=function(e){for(var t=this.points.length,i=0;i<t;i++)if(this.points[i]==e)return[this.points[(i-1+t)%t],this.points[(i+1)%t]];throw"we do not find the point in this polygone"},e.prototype.toString=function(){for(var e="[",t=0,i=this.points;t<i.length;t++)e+=i[t].hashNumber+",";return e+"]"},e}();t.Polygone=o}(e.linkModule||(e.linkModule={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=BABYLON.Tools,s=BABYLON.Collider,n=function(t){function n(n,a){var h=t.call(this,name,new BABYLON.Vector3(0,0,-10),n.scene)||this;return h.translationSpeed=1,h.checkCollisions=!1,h.showPredefinedConsoleLog=!1,h.grabbers=[],h.useOnlyFreeMode=!1,h.useFreeModeWhenCursorOutOfGrabber=!0,h.onGrabberChange=null,h.onTranslate=null,h.tooSmallAngle=.001,h.tooBigAngle=.3,h.cumulatedAngle=0,h.relativeCursorPositionOnGrabber=new e.XYZ(0,0,0),h.cursorPositionOnGrabberOld=new e.XYZ(0,0,0),h.angleOfRotationAroundGrabber=0,h.axeOfRotationAroundGrabber=new e.XYZ(0,0,0),h.camDir=new e.XYZ(0,0,0),h.oldCamDir=new e.XYZ(0,0,0),h.angleForCamRot=0,h.axisForCamRot=new e.XYZ(0,0,0),h.myNullVector=new e.XYZ(123,234,345),h.frozonProjectionMatrix=new e.MM,h.frozonViewMatrix=new e.MM,h.pickingRay={origin:new e.XYZ(0,0,0),direction:new e.XYZ(0,0,0)},h.aPartOfTheFrontDir=new e.XYZ(0,0,0),h.whishedCamPos=new o(h),h.trueCamPos=new r(h),h._paralDisplacement=new e.XYZ(0,0,0),h._matrixRotationAroundCam=new e.MM,h._matrixRotationAroundZero=new e.MM,h.camRelativePos=new e.XYZ(0,0,0),h._collider=new s,h.correctionToRecenter=new e.XYZ(0,0,0),h._deltaPosition=new e.XYZ(0,0,0),h._popo=new e.XYZ(0,0,0),h._babylonRay=new BABYLON.Ray(new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,0,1)),h.pointerIsOnCurrentGrabber=!1,h._tempCN=new e.XYZ(0,0,0),h._end=new e.XYZ(0,0,0),h.pointerIsDown=!1,h._lookForTheBestGrabber=!0,h._target=e.XYZ.newZero(),h.viewMM=new e.MM,h._keys=[],h.keysUp=[38],h.keysDown=[40],h.keysLeft=[37],h.keysRight=[39],h.keysFrontward=[],h.keysBackward=[],h._axeForKeyRotation=new e.XYZ(0,0,0),h._additionnalVec=new e.XYZ(0,0,0),h.wheelPrecision=1,h.eventPrefix=i.GetPointerPrefix(),h.scene=n.scene,e.geo.copyXYZ(h.myNullVector,h.cursorPositionOnGrabberOld),e.geo.copyXYZ(h.myNullVector,h.oldCamDir),h.$canvasElement=n.canvas,h.toogleIconCursor("cursorDefault"),h.replaceTheFirstGrabber(a),h.attachControl(n.canvas),h}return __extends(n,t),n.prototype.changePosition=function(e,t){void 0===t&&(t=!0),this.whishedCamPos.changePosition(e),t||(this.trueCamPos.position=e)},n.prototype.changeFrontDir=function(e,t){void 0===t&&(t=!0),this.whishedCamPos.changeFrontDir(e),t||this.trueCamPos.changeFrontDir(e)},n.prototype.changeUpVector=function(e,t){void 0===t&&(t=!0),this.whishedCamPos.changeUpVector(e),t||this.trueCamPos.changeUpVector(e)},n.prototype.setFreeDisplacementMode=function(){this.currentGrabber.mesh.visibility=0,this.useOnlyFreeMode=!0,this.currentGrabber.focusOnMyCenterWhenCameraGoDownWard=!1},n.prototype.addGrabber=function(e){e.checkArgs(),this.grabbers.push(e)},n.prototype.replaceTheFirstGrabber=function(e){null!=this.grabbers[0]&&this.grabbers[0].dispose(),e.checkArgs(),e.grabberCamera=this,this.grabbers[0]=e,this.currentGrabber=this.grabbers[0]},n.prototype.freeRotation=function(){this.showPredefinedConsoleLog&&console.log("free rotation angle",this.angleForCamRot.toFixed(4)),this.rotate(this.axisForCamRot,this.angleForCamRot),this.toogleIconCursor("cursorMove")},n.prototype.grabberMovement=function(){this.currentGrabber.parallelDisplacementInsteadOfRotation?(this._paralDisplacement.copyFrom(this.relativeCursorPositionOnGrabber).substract(this.cursorPositionOnGrabberOld).scale(-1),this._paralDisplacement.add(this.whishedCamPos.getPosition()),this.whishedCamPos.changePosition(this._paralDisplacement)):(this.showPredefinedConsoleLog&&console.log("grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4)),this.rotateAroundCenter(this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,this.currentGrabber.referenceCenter)),this.toogleIconCursor("cursorGrabbing"),this.currentGrabber.showGrabberOnlyWhenGrabbing&&(this.currentGrabber.mesh.visibility=1)},n.prototype.mixedRotation=function(e){this.showPredefinedConsoleLog&&console.log("free rotation angle",this.angleForCamRot.toFixed(4),"grabber rotation angle",this.angleOfRotationAroundGrabber.toFixed(4)),this.twoRotations(this.axisForCamRot,this.angleForCamRot,this.axeOfRotationAroundGrabber,this.angleOfRotationAroundGrabber,e),this.toogleIconCursor("cursorGrabbing"),this.currentGrabber.showGrabberOnlyWhenGrabbing&&(this.currentGrabber.mesh.visibility=1)},n.prototype.rotate=function(t,i){e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundCam),e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir),e.geo.multiplicationMatrixVector(this._matrixRotationAroundCam,this.whishedCamPos.upVector,this.whishedCamPos.upVector)},n.prototype.rotateAroundCenter=function(t,i,s){null!=this.currentGrabber.referenceCenter&&(e.geo.axisAngleToMatrix(t,i,this._matrixRotationAroundZero),e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.frontDir,this.whishedCamPos.frontDir),e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.whishedCamPos.upVector,this.whishedCamPos.upVector),this.camRelativePos.copyFrom(this.whishedCamPos.getPosition()).substract(s),e.geo.multiplicationMatrixVector(this._matrixRotationAroundZero,this.camRelativePos,this.camRelativePos),this.camRelativePos.add(s),this.whishedCamPos.changePosition(this.camRelativePos))},n.prototype.twoRotations=function(e,t,i,s,n){this.rotate(e,t*(1-n)),this.rotateAroundCenter(i,s*n,this.currentGrabber.referenceCenter)},n.prototype.translateCam=function(t){var i=t*this.translationSpeed;if(t<0&&this.currentGrabber.focusOnMyCenterWhenCameraGoDownWard&&null!=this.currentGrabber.referenceCenter){var s=Math.min(1,e.geo.distance(this.whishedCamPos.getPosition(),this.currentGrabber.referenceCenter)/this.currentGrabber.endOfZone3);s=s*s*.1,e.geo.scale(this.whishedCamPos.frontDir,1-s,this.aPartOfTheFrontDir),e.geo.substract(this.currentGrabber.referenceCenter,this.whishedCamPos.getPosition(),this.correctionToRecenter),this.correctionToRecenter.lengthSquared()>e.geo.epsilon&&(e.geo.normalize(this.correctionToRecenter,this.correctionToRecenter),e.geo.scale(this.correctionToRecenter,s,this.correctionToRecenter),e.geo.add(this.correctionToRecenter,this.aPartOfTheFrontDir,this.aPartOfTheFrontDir)),this.whishedCamPos.changeFrontDir(this.aPartOfTheFrontDir)}0!=i&&(e.geo.scale(this.whishedCamPos.frontDir,i,this._deltaPosition),e.geo.add(this.whishedCamPos.getPosition(),this._deltaPosition,this._popo),this.whishedCamPos.changePosition(this._popo),null!=this.onTranslate&&this.onTranslate())},n.prototype.onPointerMove=function(t,i){if(this.pointerIsDown){var s=!0,n=!0;this.createPickingRayWithFrozenCamera(t,i,this.currentGrabber.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay),e.geo.copyXYZ(this.pickingRay.direction,this.camDir),this._babylonRay.direction=this.pickingRay.direction,this._babylonRay.origin=this.pickingRay.origin;var r=this.currentGrabber.mesh.intersects(this._babylonRay,!1);this.pointerIsOnCurrentGrabber=r.hit;var o=r.distance;this.pointerIsOnCurrentGrabber&&(this.relativeCursorPositionOnGrabber.x=r.pickedPoint.x,this.relativeCursorPositionOnGrabber.y=r.pickedPoint.y,this.relativeCursorPositionOnGrabber.z=r.pickedPoint.z),null!=this.currentGrabber.referenceCenter&&this.relativeCursorPositionOnGrabber.substract(this.currentGrabber.referenceCenter);var a=this.currentGrabber.interpolationCoefAccordingToCamPosition(this.trueCamPos.position,o);if(this.showPredefinedConsoleLog&&console.log("alpha",a),e.geo.xyzEquality(this.oldCamDir,this.myNullVector)&&(e.geo.copyXYZ(this.camDir,this.oldCamDir),n=!1),e.geo.xyzEquality(this.cursorPositionOnGrabberOld,this.myNullVector)?(this.pointerIsOnCurrentGrabber&&e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld),s=!1):this.pointerIsOnCurrentGrabber||(e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld),s=!1),n&&(this.angleForCamRot=e.geo.angleBetweenTwoVectorsBetween0andPi(this.camDir,this.oldCamDir),this.angleForCamRot>this.tooSmallAngle?(e.geo.cross(this.camDir,this.oldCamDir,this.axisForCamRot),e.geo.normalize(this.axisForCamRot,this.axisForCamRot)):n=!1),s&&(this.angleOfRotationAroundGrabber=e.geo.angleBetweenTwoVectorsBetween0andPi(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld),this.angleOfRotationAroundGrabber>this.tooSmallAngle?(e.geo.cross(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld,this.axeOfRotationAroundGrabber),this.axeOfRotationAroundGrabber.normalize()):s=!1),s&&this.angleOfRotationAroundGrabber>this.tooBigAngle)return console.log("a too big angle around zero : ignored"+this.angleOfRotationAroundGrabber.toFixed(4)),void e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld);this.useOnlyFreeMode&&n?this.freeRotation():this.pointerIsOnCurrentGrabber?0==a?n&&this.freeRotation():a<1&&a>0?n&&s?this.mixedRotation(a):s&&this.grabberMovement():1==a&&s&&this.grabberMovement():this.useFreeModeWhenCursorOutOfGrabber&&n&&this.freeRotation(),s&&e.geo.copyXYZ(this.relativeCursorPositionOnGrabber,this.cursorPositionOnGrabberOld),n&&e.geo.copyXYZ(this.camDir,this.oldCamDir),s&&(this.cumulatedAngle+=this.angleOfRotationAroundGrabber),n&&(this.cumulatedAngle+=this.angleForCamRot),this.cumulatedAngle>Math.PI/12&&(e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix),e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix),this.cumulatedAngle=0,e.geo.copyXYZ(this.myNullVector,this.oldCamDir),e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld),this.showPredefinedConsoleLog&&console.log("nouvelles matrices enregistrées"))}},n.prototype.createPickingRayWithFrozenCamera=function(e,t,i,s,n,r){var o=this.getEngine(),a=this.viewport.toGlobal(o.getRenderWidth(),o.getRenderHeight());e=e/o.getHardwareScalingLevel()-a.x,t=t/o.getHardwareScalingLevel()-(o.getRenderHeight()-a.y-a.height),this.createNewRay(e,t,a.width,a.height,i,s,n,r)},n.prototype.createNewRay=function(t,i,s,n,r,o,a,h){e.geo.unproject(e.geo.copyXyzFromFloat(t,i,0,this._tempCN),s,n,r,o,a,h.origin),e.geo.unproject(e.geo.copyXyzFromFloat(t,i,1,this._tempCN),s,n,r,o,a,this._end),e.geo.substract(this._end,h.origin,h.direction),e.geo.normalize(h.direction,h.direction)},n.prototype.onPointerDown=function(t,i){this.pointerIsDown=!0,e.geo.copyMat(this.getProjectionMatrix(),this.frozonProjectionMatrix),e.geo.copyMat(this.getViewMatrix(),this.frozonViewMatrix),this.cumulatedAngle=0,this._lookForTheBestGrabber&&this.grabbers.length>1&&(this.lookForTheBestGrabber(t,i),this._lookForTheBestGrabber=!1)},n.prototype.lookForTheBestGrabber=function(t,i){for(var s=Number.POSITIVE_INFINITY,n=null,r=0,o=this.grabbers;r<o.length;r++){var a=o[r];this.createPickingRayWithFrozenCamera(t,i,a.mesh.getWorldMatrix(),this.frozonViewMatrix,this.frozonProjectionMatrix,this.pickingRay),e.geo.copyXYZ(this.pickingRay.direction,this.camDir),this._babylonRay.direction=this.pickingRay.direction,this._babylonRay.origin=this.pickingRay.origin;var h=a.mesh.intersects(this._babylonRay,!0);h.hit&&h.distance<s&&(s=h.distance,n=a)}null!=n&&n!=this.currentGrabber&&(null!=this.onGrabberChange&&this.onGrabberChange(this.currentGrabber,n),this.currentGrabber=n,console.log("we have changed grabber, the new one is: ",n.name))},n.prototype.onPointerUp=function(){this._lookForTheBestGrabber=!0,this.toogleIconCursor("cursorDefault"),this.currentGrabber.showGrabberOnlyWhenGrabbing&&(this.currentGrabber.mesh.visibility=0),this.pointerIsDown=!1,e.geo.copyXYZ(this.myNullVector,this.oldCamDir),e.geo.copyXYZ(this.myNullVector,this.cursorPositionOnGrabberOld)},n.prototype.reset=function(){this._keys=[]},n.prototype.toogleIconCursor=function(e){this.cursorActualStyle!=e&&(this.$canvasElement.className=e,this.cursorActualStyle=e)},n.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&this.trueCamPos.almostEqual(this.whishedCamPos)},n.prototype._getViewMatrix=function(){return e.geo.copyXYZ(this.trueCamPos.position,this._target),e.geo.add(this._target,this.trueCamPos.frontDir,this._target),e.geo.LookAtLH(this.trueCamPos.position,this._target,this.trueCamPos.upVector,this.viewMM),this.viewMM},n.prototype.update=function(){this.checkForKeyPushed(),this.trueCamPos.almostEqual(this.whishedCamPos)||this.trueCamPos.goCloser(this.whishedCamPos),this.position.copyFrom(this.trueCamPos.position),this.upVector.copyFrom(this.trueCamPos.upVector)},n.prototype.onKeyDown=function(e){-1===this.keysUp.indexOf(e.keyCode)&&-1===this.keysDown.indexOf(e.keyCode)&&-1===this.keysLeft.indexOf(e.keyCode)&&-1===this.keysRight.indexOf(e.keyCode)&&-1===this.keysBackward.indexOf(e.keyCode)&&-1===this.keysFrontward.indexOf(e.keyCode)||(-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),e.preventDefault&&e.preventDefault())},n.prototype.onKeyUp=function(e){if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysBackward.indexOf(e.keyCode)||-1!==this.keysFrontward.indexOf(e.keyCode)){var t=this._keys.indexOf(e.keyCode);t>=0&&this._keys.splice(t,1),e.preventDefault&&e.preventDefault()}},n.prototype.checkForKeyPushed=function(){if(0!=this._keys.length){e.geo.copyXyzFromFloat(0,0,0,this._axeForKeyRotation);for(var t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)&&(e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec),e.geo.scale(this._additionnalVec,-1,this._additionnalVec),e.geo.add(this._axeForKeyRotation,this._additionnalVec,this._axeForKeyRotation)),-1!==this.keysUp.indexOf(i)&&(e.geo.cross(this.whishedCamPos.frontDir,this.whishedCamPos.upVector,this._additionnalVec),e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)),-1!==this.keysRight.indexOf(i)&&(e.geo.copyXYZ(this.whishedCamPos.upVector,this._additionnalVec),e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)),-1!==this.keysDown.indexOf(i)&&(e.geo.cross(this.whishedCamPos.upVector,this.whishedCamPos.frontDir,this._additionnalVec),e.geo.add(this._additionnalVec,this._axeForKeyRotation,this._axeForKeyRotation)),-1!==this.keysBackward.indexOf(i)?this.translateCam(-.1):-1!==this.keysFrontward.indexOf(i)&&this.translateCam(.1)}if(!(e.geo.squareNorme(this._axeForKeyRotation)<e.geo.epsilon)){this.rotate(this._axeForKeyRotation,-.02)}}},n.prototype.deltaNotToBigFunction=function(e){return e>.1?.1:e<-.1?-.1:e},n.prototype.attachControl=function(e,t){var s,n=this;this._attachedElement||(this._attachedElement=e,this._onPointerDown=function(i){if(!s){s=i.pointerId,t||i.preventDefault();var r=e.getBoundingClientRect();n.onPointerDown(i.clientX-r.left,i.clientY-r.top)}},this._onPointerUp=function(e){s=null,t||e.preventDefault(),n.onPointerUp()},this._onPointerMove=function(i){if(s===i.pointerId){var r=e.getBoundingClientRect();n.onPointerMove(i.clientX-r.left,i.clientY-r.top),t||i.preventDefault()}},this._onMouseMove=this._onPointerMove,this._wheel=function(e){var i=0;e.wheelDelta?i=n.deltaNotToBigFunction(e.wheelDelta/(300*n.wheelPrecision)):e.detail&&(i=n.deltaNotToBigFunction(-e.detail/(30*n.wheelPrecision))),i&&n.translateCam(i),e.preventDefault&&(t||e.preventDefault())},this._onKeyDown=function(e){n.onKeyDown(e)},this._onKeyUp=function(e){n.onKeyUp(e)},this._onLostFocus=function(){n._keys=[],s=null},this._onGestureStart=function(t){void 0!==window.MSGesture&&(n._MSGestureHandler||(n._MSGestureHandler=new MSGesture,n._MSGestureHandler.target=e),n._MSGestureHandler.addPointer(t.pointerId))},this._onGesture=function(e){},this._reset=function(){n.reset(),s=null},e.addEventListener(this.eventPrefix+"down",this._onPointerDown,!1),e.addEventListener(this.eventPrefix+"up",this._onPointerUp,!1),e.addEventListener(this.eventPrefix+"out",this._onPointerUp,!1),e.addEventListener(this.eventPrefix+"move",this._onPointerMove,!1),e.addEventListener("mousemove",this._onMouseMove,!1),e.addEventListener("MSPointerDown",this._onGestureStart,!1),e.addEventListener("MSGestureChange",this._onGesture,!1),e.addEventListener("mousewheel",this._wheel,!1),e.addEventListener("DOMMouseScroll",this._wheel,!1),i.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},n.prototype.detachControl=function(e){this._attachedElement==e&&(e.removeEventListener(this.eventPrefix+"down",this._onPointerDown),e.removeEventListener(this.eventPrefix+"up",this._onPointerUp),e.removeEventListener(this.eventPrefix+"out",this._onPointerUp),e.removeEventListener(this.eventPrefix+"move",this._onPointerMove),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("MSPointerDown",this._onGestureStart),e.removeEventListener("MSGestureChange",this._onGesture),e.removeEventListener("mousewheel",this._wheel),e.removeEventListener("DOMMouseScroll",this._wheel),i.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._MSGestureHandler=null,this._attachedElement=null,this._reset&&this._reset())},n}(BABYLON.Camera);t.GrabberCamera=n;var r=function(t){function i(i){var s=t.call(this)||this;return s.grabberPilot=i,s.position=new e.XYZ(0,0,-3),s.upVector=new e.XYZ(0,1,0),s.frontDir=new e.XYZ(0,0,1),s.sizes=new e.XYZ(1,1,1),s.smoothParam=.5,s.positioningCopy=new e.Positioning,s}return __extends(i,t),i.prototype.almostEqual=function(t){return e.geo.xyzAlmostEquality(this.position,t.getPosition())&&e.geo.xyzAlmostEquality(this.upVector,t.upVector)&&e.geo.xyzAlmostEquality(this.frontDir,t.frontDir)},i.prototype.goCloser=function(t){e.geo.between(t.position,this.position,this.smoothParam,this.position),e.geo.between(t.upVector,this.upVector,this.smoothParam,this.upVector),e.geo.between(t.frontDir,this.frontDir,this.smoothParam,this.frontDir),this.upVector.lengthSquared()<e.geo.epsilonSquare&&(this.upVector.copyFrom(t.upVector).scale(-1),e.logger.c("a wished upVector was opposite to the true upVector")),this.frontDir.lengthSquared()<e.geo.epsilonSquare&&(this.frontDir.copyFrom(t.frontDir).scale(-1),e.logger.c("a wished frontDir was opposite to the true frontDir")),null!=this.grabberPilot.onPositioningChange&&(this.positioningCopy.copyFrom(this),this.grabberPilot.onPositioningChange(this.positioningCopy))},i.prototype.copyFrom=function(t){e.geo.copyXYZ(t.position,this.position),e.geo.copyXYZ(t.upVector,this.upVector),e.geo.copyXYZ(t.frontDir,this.frontDir)},i.prototype.changeFrontDir=function(t){e.geo.orthonormalizeKeepingFirstDirection(t,this.upVector,this.frontDir,this.upVector)},i.prototype.changeUpVector=function(t){e.geo.orthonormalizeKeepingFirstDirection(this.upVector,t,this.upVector,this.frontDir)},i}(e.Positioning);t.CamPositioning=r;var o=function(t){function i(i){var n=t.call(this)||this;return n.camera=i,n.upVector=new e.XYZ(0,1,0),n.frontDir=new e.XYZ(0,0,1),n.position=new e.XYZ(0,0,-3),n._newPositionBeforCollision=new e.XYZ(0,0,0),n._velocity=new e.XYZ(0,0,0),n._collider=new s,n.ellipsoid=new e.XYZ(1,1,1),n._oldPosition=new e.XYZ(0,0,0),n._diffPosition=new e.XYZ(0,0,0),n._newPosition=new e.XYZ(0,0,0),n._inter=new e.XYZ(0,0,0),n._upPerturbation=new e.XYZ(0,0,0),n._onCollisionPositionChange=function(e,t,i){void 0===i&&(i=null),n._newPosition.copyFrom(t),n._newPosition.subtractToRef(n._oldPosition,n._diffPosition).scale(2),null!=i?(console.log("collision"),n._upPerturbation.copyFrom(n.upVector).scale(.005),n.position.add(n._diffPosition).add(n._upPerturbation)):n.position.copyFrom(n._oldPosition)},n}return __extends(i,t),i.prototype.getPosition=function(){return this.position},i.prototype.changePosition=function(e){null!=this.camera.positionChangesBiaiser?this._newPositionBeforCollision.copyFrom(this.camera.positionChangesBiaiser(this.position,e,this.camera.currentGrabber)):this._newPositionBeforCollision.copyFrom(e),this.camera.checkCollisions?(this._velocity.copyFrom(this._newPositionBeforCollision).substract(this.camera.trueCamPos.position),this._collideWithWorld(this._velocity,this._newPositionBeforCollision)):this.position.copyFrom(this._newPositionBeforCollision)},i.prototype._collideWithWorld=function(e,t){this._collider.radius=this.ellipsoid,this._oldPosition.copyFrom(t),this.camera.scene.collisionCoordinator.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,-13)},i}(e.Positioning);t.WishedPositioning=o;var a=function(){function t(t){this.parallelDisplacementInsteadOfRotation=!1,this.showGrabberOnlyWhenGrabbing=!0,this.referenceCenter=null,this.onGrabbingActions=new e.StringMap,this.endOfZone1=1,this.endOfZone2=3,this.endOfZone3=10,this.zoneAreDefinedFromCenterRatherFromSurface=!0,this.focusOnMyCenterWhenCameraGoDownWard=!0,this.scene=t,this.material=new BABYLON.StandardMaterial("",this.scene),this.material=new BABYLON.StandardMaterial("texture1",this.scene),this.material.alpha=.3,this.material.diffuseColor=new BABYLON.Color3(1,1,1)}return t.prototype.dispose=function(){this.mesh.dispose()},t.prototype.interpolationCoefAccordingToCamPosition=function(t,i){var s=0;return s=this.zoneAreDefinedFromCenterRatherFromSurface?e.geo.distance(t,this.referenceCenter):i,s<=this.endOfZone1?0:s>=this.endOfZone2?1:(s-this.endOfZone1)/(this.endOfZone2-this.endOfZone1)},t.prototype.checkArgs=function(){if(this.zoneAreDefinedFromCenterRatherFromSurface&&null==this.referenceCenter)throw"you must define a reference center when zoneAreDefinedFromCenterRatherFromSurface";if(this.focusOnMyCenterWhenCameraGoDownWard&&null==this.referenceCenter)throw"you must define a reference center when focusOnMyCenterWhenCameraGoDownWard";if(this.endOfZone1>this.endOfZone2)throw"zone2 must contains zone1";if(this.endOfZone2>this.endOfZone3)throw"zone3 must contains zone2"},t}();t.Grabber=a;var h=function(t){function i(i,s,n,r){void 0===s&&(s=new e.XYZ(1,1,1)),void 0===n&&(n=new e.XYZ(0,0,0)),void 0===r&&(r=!1);var o=t.call(this,i)||this;return o.radius=1,o.radius=s.x,o.endOfZone1=o.radius,o.endOfZone2=4*o.radius,o.endOfZone3=10*o.radius,o.referenceCenter=n,o.focusOnMyCenterWhenCameraGoDownWard=!0,o.parallelDisplacementInsteadOfRotation=!1,o.showGrabberOnlyWhenGrabbing=!0,o.mesh=BABYLON.Mesh.CreateSphere("default sphere for grabbing",10,2,i),o.mesh.position=n,o.mesh.scaling=s,o.mesh.material=o.material,o.mesh.isPickable=r,o}return __extends(i,t),i}(a);t.SphericalGrabber=h;var l=function(t){function i(i,s,n,r,o){void 0===s&&(s=new e.XYZ(1,1,1)),void 0===n&&(n=new e.XYZ(0,0,0)),void 0===r&&(r=new e.XYZW(0,0,0,1)),void 0===o&&(o=!1);var a=t.call(this,i)||this;return a.referenceCenter=null,a.focusOnMyCenterWhenCameraGoDownWard=!1,a.parallelDisplacementInsteadOfRotation=!0,a.zoneAreDefinedFromCenterRatherFromSurface=!1,a.endOfZone1=0,a.endOfZone2=0,a.mesh=BABYLON.Mesh.CreatePlane("default plane for grabbing",1,i),a.mesh.position=n,a.mesh.scaling=s,a.mesh.rotationQuaternion=r,a.mesh.material=a.material,a.mesh.isPickable=o,a}return __extends(i,t),i}(a);t.PlanarGrabber=l}(e.macamera||(e.macamera={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(t){this.attractionOfTangent=new e.XYZ(1,.0123456721,.00078654343),this.computeTangent=!0,this.computeNormal=!0,this.computeSizes=!0,this.sizesProp=new e.XYZ(.3,.3,.3),this.allVerticesHaveSameSizes=!0,this.temp=new e.XYZ(0,0,0),this._side1=new e.XYZ(0,0,0),this._side2=new e.XYZ(0,0,0),this.mamesh=t}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length&&0==this.mamesh.smallestTriangles.length)throw"no triangles nor Square. The normals cannot be computed"},t.prototype.go=function(){var t=this,i=new e.HashMap;if(0==this.mamesh.vertices.length)return void e.logger.c("you try to compute normal, tangent, diameter for an empty mamesh");if(this.mamesh.vertices.forEach(function(t){var s=new e.Positioning;s.position=t.position,s.upVector=new e.XYZ(0,0,0),s.frontDir=new e.XYZ(0,0,0),i.putValue(t,s)}),this.computeTangent&&this.mamesh.vertices.forEach(function(s){var n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=new e.XYZ(0,0,0),a=new e.XYZ(0,0,0);if(0==s.links.length)throw"a vertex with no links. Impossible to compute a tangent";for(var h=t.attractionOfTangent.length(),l=0;l<s.links.length;l++)if(t.temp.copyFrom(s.links[l].to.position).substract(s.position),t.temp.length()<e.geo.epsilon)e.logger.c("a mamesh has two vertices at almost the same position");else{var u=e.geo.dot(t.temp,t.attractionOfTangent)/t.temp.length()/h;u>n&&(n=u,o.copyFrom(t.temp)),u<r&&(r=u,a.copyFrom(t.temp))}-r>2*n?i.getValue(s).frontDir.copyFrom(a.scale(-1)):i.getValue(s).frontDir.copyFrom(o)}),this.computeNormal){for(var s=[],n=0;n<this.mamesh.smallestTriangles.length/3;n++)this._side1.copyFrom(this.mamesh.smallestTriangles[3*n+1].position).substract(this.mamesh.smallestTriangles[3*n].position),this._side2.copyFrom(this.mamesh.smallestTriangles[3*n+2].position).substract(this.mamesh.smallestTriangles[3*n].position),s[n]=new e.XYZ(0,0,0),e.geo.cross(this._side1,this._side2,s[n]),s[n].normalize();for(var r=[],n=0;n<this.mamesh.smallestSquares.length/4;n++){this._side1.copyFrom(this.mamesh.smallestSquares[4*n+1].position).substract(this.mamesh.smallestSquares[4*n].position),this._side2.copyFrom(this.mamesh.smallestSquares[4*n+3].position).substract(this.mamesh.smallestSquares[4*n].position),r[n]=new e.XYZ(0,0,0),e.geo.cross(this._side1,this._side2,r[n]);try{r[n].normalize()}catch(e){throw"the square"+this.mamesh.smallestSquares[4*n].hashNumber+","+this.mamesh.smallestSquares[4*n+1].hashNumber+","+this.mamesh.smallestSquares[4*n+2].hashNumber+","+this.mamesh.smallestSquares[4*n+3].hashNumber+" is degenerated"}}for(n=0;n<s.length;n++){var o=this.mamesh.smallestTriangles[3*n],a=this.mamesh.smallestTriangles[3*n+1],h=this.mamesh.smallestTriangles[3*n+2];i.getValue(o).upVector.add(s[n]),i.getValue(a).upVector.add(s[n]),i.getValue(h).upVector.add(s[n])}for(n=0;n<r.length;n++){var o=this.mamesh.smallestSquares[4*n],a=this.mamesh.smallestSquares[4*n+1],h=this.mamesh.smallestSquares[4*n+2],l=this.mamesh.smallestSquares[4*n+3];i.getValue(o).upVector.add(r[n]),i.getValue(a).upVector.add(r[n]),i.getValue(h).upVector.add(r[n]),i.getValue(l).upVector.add(r[n])}var u=[];if(this.mamesh.vertices.forEach(function(t){try{i.getValue(t).upVector.normalize()}catch(i){e.logger.c("a too small upVector for a vertex, probably a vertex which is not in any polygone. The upVector will be the mean of other upVector"),u.push(t)}}),u.length>0){for(var c=new e.XYZ(0,0,0),m=0,p=this.mamesh.vertices;m<p.length;m++){var d=p[m];c.add(i.getValue(d).upVector)}try{c.normalize()}catch(e){throw"canot manage to compute upVector for any vertex"}for(var g=0,f=u;g<f.length;g++){var v=f[g];i.getValue(v).upVector.copyFrom(c)}}}if(this.computeSizes)if(this.allVerticesHaveSameSizes){var y=0,b=this.mamesh.vertices[0],w=0;b.links.forEach(function(t){w+=e.geo.distance(b.position,t.to.position)}),y=w/b.links.length,this.mamesh.vertices.forEach(function(e){return i.getValue(e).scaling.copyFrom(t.sizesProp).scale(y)})}else this.mamesh.vertices.forEach(function(s){var n=0;s.links.forEach(function(t){n+=e.geo.distance(s.position,t.to.position)}),i.getValue(s).scaling.copyFrom(t.sizesProp).scale(n/s.links.length)});return i},t}();t.PositioningComputerForMameshVertices=i}(e.mameshAroundComputations||(e.mameshAroundComputations={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t,i,s,n){if(null==s.middle){var r=new e.XYZ(0,0,0);e.geo.between(s.a.position,s.b.position,.5,r),s.middle=i.newVertex(r,Math.max(s.a.dichoLevel,s.b.dichoLevel)+1,t(s.a.param,s.b.param)),s.a.hasMark(e.Vertex.Markers.border)&&s.b.hasMark(e.Vertex.Markers.border)&&s.middle.markers.push(e.Vertex.Markers.border),null!=n&&(s.orth1=n)}else null!=n&&(s.orth2=n)}var s=function(){function t(t){this.makeLinks=!0,this.trianglesToCut=null,this.nbDicho=1,this.newParamForMiddle=function(t,i){var s=new e.XYZ(0,0,0);return e.geo.between(t,i,.5,s),s},this.mamesh=t}return t.prototype.checkArgs=function(){0==this.mamesh.smallestTriangles.length&&e.logger.c("no triangulatedRect for triangulatedRect dichotomy")},t.prototype.go=function(){this.checkArgs(),this.makeLinks||this.mamesh.clearLinksAndLines();var t;null==this.trianglesToCut?(this.trianglesToCut=this.mamesh.smallestTriangles,t=new Array):t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestTriangles,3,this.trianglesToCut).go();for(var s=this.createAndAddSegmentsFromTriangles(this.trianglesToCut),n=0;n<this.trianglesToCut.length;n+=3){var r=this.trianglesToCut[n],o=this.trianglesToCut[n+1],a=this.trianglesToCut[n+2],h=s[e.Segment.segmentId(r.hashNumber,o.hashNumber)],l=s[e.Segment.segmentId(o.hashNumber,a.hashNumber)],u=s[e.Segment.segmentId(a.hashNumber,r.hashNumber)];this.makeLinks?(i(this.newParamForMiddle,this.mamesh,h,a),i(this.newParamForMiddle,this.mamesh,l,r),i(this.newParamForMiddle,this.mamesh,u,o)):(i(this.newParamForMiddle,this.mamesh,h),i(this.newParamForMiddle,this.mamesh,l),i(this.newParamForMiddle,this.mamesh,u));var c=h.middle,m=l.middle,p=u.middle;t.push(r,c,p),t.push(o,m,c),t.push(a,p,m),t.push(c,m,p)}if(this.makeLinks)for(var d in s){var g=s[d],f=s[e.Segment.segmentId(g.a.hashNumber,g.orth1.hashNumber)],v=s[e.Segment.segmentId(g.b.hashNumber,g.orth1.hashNumber)];if(null!=g.orth2){var y=s[e.Segment.segmentId(g.a.hashNumber,g.orth2.hashNumber)],b=s[e.Segment.segmentId(g.b.hashNumber,g.orth2.hashNumber)];g.middle.setTwoOppositeLinks(f.middle,b.middle),g.middle.setTwoOppositeLinks(y.middle,v.middle)}else g.middle.setOneLink(f.middle),g.middle.setOneLink(v.middle);try{var w=function(e,t,i){e.findLink(t).to=i};w(g.a,g.b,g.middle),w(g.b,g.a,g.middle),g.middle.setTwoOppositeLinks(g.a,g.b)}catch(e){throw"a bad segment, probably your triangles are not corrects (e.g. one missing, or one more)"}}this.mamesh.smallestTriangles=t},t.prototype.createAndAddSegmentsFromTriangles=function(e){for(var t={},i=0;i<e.length;i+=3){var s=e[i],n=e[i+1],r=e[i+2];this.mamesh.getOrCreateSegment(s,n,t),this.mamesh.getOrCreateSegment(n,r,t),this.mamesh.getOrCreateSegment(r,s,t)}return t},t}();t.TriangleDichotomer=s;var n=function(){function t(i){this.makeLinks=!0,this.squareToCut=null,this.dichoStyle=t.DichoStyle.fourSquares,this.newParamForMiddle=function(t,i){var s=new e.XYZ(0,0,0);return e.geo.between(t,i,.5,s),s},this.newParamForCenter=function(t,i,s,n){var r=new e.XYZ(0,0,0);return e.geo.baryCenter([t,i,s,n],[.25,.25,.25,.25],r),r},this.mamesh=i}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()},t.prototype.go=function(){this.checkArgs();var s;null==this.squareToCut?(this.squareToCut=this.mamesh.smallestSquares,s=new Array):s=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go();for(var n=this.createAndAddSegmentsFromSquare(this.squareToCut),r=0;r<this.squareToCut.length;r+=4){var o=this.squareToCut[r],a=this.squareToCut[r+1],h=this.squareToCut[r+2],l=this.squareToCut[r+3],u=n[e.Segment.segmentId(o.hashNumber,a.hashNumber)],c=n[e.Segment.segmentId(a.hashNumber,h.hashNumber)],m=n[e.Segment.segmentId(h.hashNumber,l.hashNumber)],p=n[e.Segment.segmentId(l.hashNumber,o.hashNumber)];i(this.newParamForMiddle,this.mamesh,u),i(this.newParamForMiddle,this.mamesh,c),i(this.newParamForMiddle,this.mamesh,m),i(this.newParamForMiddle,this.mamesh,p);var d=u.middle,g=c.middle,f=m.middle,v=p.middle;if(this.dichoStyle==t.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[.25,.25,.25,.25],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1,w=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param)),x=new e.Segment(d,f);x.middle=w,this.mamesh.cutSegmentsDico[e.Segment.segmentId(d.hashNumber,f.hashNumber)]=x,s.push(o,d,w,v),s.push(a,g,w,d),s.push(h,f,w,g),s.push(l,v,w,f)}else{if(this.dichoStyle!=t.DichoStyle.fourTriangles)throw"ho ho";s.push(d,g,f,v),this.mamesh.smallestTriangles.push(o,d,v),this.mamesh.smallestTriangles.push(a,g,d),this.mamesh.smallestTriangles.push(h,f,g),this.mamesh.smallestTriangles.push(l,v,f)}}this.mamesh.smallestSquares=s,this.makeLinks&&new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh).goChanging()},t.prototype.createAndAddSegmentsFromSquare=function(e){for(var t={},i=0;i<e.length;i+=4){var s=e[i],n=e[i+1],r=e[i+2],o=e[i+3];this.mamesh.getOrCreateSegment(s,n,t),this.mamesh.getOrCreateSegment(n,r,t),this.mamesh.getOrCreateSegment(r,o,t),this.mamesh.getOrCreateSegment(o,s,t)}return t},t}();t.SquareDichotomer=n;var r=function(){function t(t){this.makeLinks=!0,this.squareToCut=null,this.dichoStyle=n.DichoStyle.fourSquares,this.newParamForMiddle=function(t,i){var s=new e.XYZ(0,0,0);return e.geo.between(t,i,.5,s),s},this.newParamForCenter=function(t,i,s,n){var r=new e.XYZ(0,0,0);return e.geo.baryCenter([t,i,s,n],[.25,.25,.25,.25],r),r},this.mamesh=t}return t.prototype.checkArgs=function(){if(0==this.mamesh.smallestSquares.length)throw"no square for square dichotomy";this.mamesh.clearLinksAndLines()},t.prototype.go=function(){this.checkArgs();var t;null==this.squareToCut?(this.squareToCut=this.mamesh.smallestSquares,t=new Array):t=new e.tab.ArrayMinusBlocksElements(this.mamesh.smallestSquares,4,this.squareToCut).go();for(var s=this.createAndAddSegmentsFromSquare(this.squareToCut),r=0;r<this.squareToCut.length;r+=4){var o=this.squareToCut[r],a=this.squareToCut[r+1],h=this.squareToCut[r+2],l=this.squareToCut[r+3],u=s[e.Segment.segmentId(o.hashNumber,a.hashNumber)],c=s[e.Segment.segmentId(a.hashNumber,h.hashNumber)],m=s[e.Segment.segmentId(h.hashNumber,l.hashNumber)],p=s[e.Segment.segmentId(l.hashNumber,o.hashNumber)];i(this.newParamForMiddle,this.mamesh,u),i(this.newParamForMiddle,this.mamesh,c),i(this.newParamForMiddle,this.mamesh,m),i(this.newParamForMiddle,this.mamesh,p);var d=u.middle,g=c.middle,f=m.middle,v=p.middle;if(this.dichoStyle==n.DichoStyle.fourSquares){var y=new e.XYZ(0,0,0);e.geo.baryCenter([u.a.position,u.b.position,m.a.position,m.b.position],[.25,.25,.25,.25],y);var b=Math.max(u.a.dichoLevel,u.b.dichoLevel,m.a.dichoLevel,m.b.dichoLevel)+1,w=this.mamesh.newVertex(y,b,this.newParamForCenter(u.a.param,u.b.param,m.a.param,m.b.param)),x=new e.Segment(d,f);x.middle=w,this.mamesh.cutSegmentsDico[e.Segment.segmentId(d.hashNumber,f.hashNumber)]=x,t.push(o,d,w,v),t.push(a,g,w,d),t.push(h,f,w,g),t.push(l,v,w,f)}else{if(this.dichoStyle!=n.DichoStyle.fourTriangles)throw"ho ho";t.push(d,g,f,v),this.mamesh.smallestTriangles.push(o,d,v),this.mamesh.smallestTriangles.push(a,g,d),this.mamesh.smallestTriangles.push(h,f,g),this.mamesh.smallestTriangles.push(l,v,f)}}this.mamesh.smallestSquares=t,this.makeLinks&&new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh).goChanging()},t.prototype.createAndAddSegmentsFromSquare=function(e){for(var t={},i=0;i<e.length;i+=4){var s=e[i],n=e[i+1],r=e[i+2],o=e[i+3];this.mamesh.getOrCreateSegment(s,n,t),this.mamesh.getOrCreateSegment(n,r,t),this.mamesh.getOrCreateSegment(r,o,t),this.mamesh.getOrCreateSegment(o,s,t)}return t},t}();t.SimplestSquareDichotomer=r,function(e){!function(e){e[e.fourSquares=0]="fourSquares",e[e.fourTriangles=1]="fourTriangles"}(e.DichoStyle||(e.DichoStyle={}))}(n=t.SquareDichotomer||(t.SquareDichotomer={}));var o=function(){function t(e){this.subdivider=3,this.hexahedronsToCut=null,this.suppressVolumes=null,this.createdPointsPerSegment={},this.createdPointsPerSurface={},this.newHexahedrons=null,this.points=null,this.mamesh=e}return t.prototype.checkArgs=function(){(null==this.hexahedronsToCut&&0==this.mamesh.hexahedrons.length||null!=this.hexahedronsToCut&&0==this.hexahedronsToCut.length)&&e.logger.c("HexahedronSubdivider : No input")},t.prototype.go=function(){this.checkArgs(),null==this.hexahedronsToCut&&(this.hexahedronsToCut=this.mamesh.hexahedrons),this.points=new Array(this.subdivider+1);for(var e=0;e<=this.subdivider;e++){this.points[e]=new Array(this.subdivider+1);for(var t=0;t<=this.subdivider;t++)this.points[e][t]=new Array(this.subdivider+1)}this.subdivideHexahedrons()},t.prototype.subdivideHexahedronInVertices=function(t){var i=this,s=this.subdivider,n=[[0,0,0],[s,0,0],[s,0,s],[0,0,s],[0,s,s],[0,s,0],[s,s,0],[s,s,s]];n.forEach(function(e,s){var n=e[0],r=e[1],o=e[2];i.points[n][r][o]=i.hexahedronsToCut[t+s]});for(var r=0,o=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]];r<o.length;r++){var a=o[r],h=a[0],l=a[1],u=e.Hash.segment(this.hexahedronsToCut[t+h],this.hexahedronsToCut[t+l]);this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+l].hashNumber&&(Z=[l,h],h=Z[0],l=Z[1]);for(var c=n[h],m=c[0],p=c[1],d=c[2],g=n[l],f=g[0],v=g[1],y=g[2],b=1;b<s;b++)this.points[m+(f-m)/s*b][p+(v-p)/s*b][d+(y-d)/s*b]=this.createdPointsPerSegment[u][b]}for(var w=0,x=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]];w<x.length;w++){for(var M=x[w],h=M[0],l=M[1],T=M[2],V=M[3],u=e.Hash.quad(this.hexahedronsToCut[t+h],this.hexahedronsToCut[t+l],this.hexahedronsToCut[t+T],this.hexahedronsToCut[t+V]);this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+l].hashNumber||this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+T].hashNumber||this.hexahedronsToCut[t+h].hashNumber>this.hexahedronsToCut[t+V].hashNumber;)D=[l,T,V,h],h=D[0],l=D[1],T=D[2],V=D[3];this.hexahedronsToCut[t+l].hashNumber>this.hexahedronsToCut[t+V].hashNumber&&(q=[V,l],l=q[0],V=q[1]);for(var C=n[h],m=C[0],p=C[1],d=C[2],k=n[l],f=k[0],v=k[1],y=k[2],S=n[T],O=S[0],A=S[1],_=S[2],b=1;b<s;b++)for(var P=1;P<s;P++)this.points[m+(f-m)/s*b+(O-f)/s*P][p+(v-p)/s*b+(A-v)/s*P][d+(y-d)/s*b+(_-y)/s*P]=this.createdPointsPerSurface[u][b][P]}for(var F=1;F<s;F++)for(var N=1;N<s;N++)for(var L=1;L<s;L++){var Y=new e.XYZ(0,0,0),B=F/s,X=N/s,I=L/s;e.geo.baryCenter([this.hexahedronsToCut[t].position,this.hexahedronsToCut[t+1].position,this.hexahedronsToCut[t+2].position,this.hexahedronsToCut[t+3].position,this.hexahedronsToCut[t+4].position,this.hexahedronsToCut[t+5].position,this.hexahedronsToCut[t+6].position,this.hexahedronsToCut[t+7].position],[(1-B)*(1-X)*(1-I),B*(1-X)*(1-I),B*(1-X)*I,(1-B)*(1-X)*I,(1-B)*X*I,(1-B)*X*(1-I),B*X*(1-I),B*X*I],Y),this.points[F][N][L]=this.mamesh.newVertex(Y)}var Z,D,q},t.prototype.makeNewHexahedronsFromPoints=function(){null==this.suppressVolumes&&(this.suppressVolumes=[]);for(var e=this.subdivider,t=this,i=0;i<e;i++)!function(i){for(var s=0;s<e;s++)!function(s){for(var n=0;n<e;n++)!function(e){if(t.suppressVolumes.some(function(t){return t[0]==i&&t[1]==s&&t[2]==e}))return"continue";t.newHexahedrons.push.apply(t.newHexahedrons,[t.points[i][s][e],t.points[i+1][s][e],t.points[i+1][s][e+1],t.points[i][s][e+1],t.points[i][s+1][e+1],t.points[i][s+1][e],t.points[i+1][s+1][e],t.points[i+1][s+1][e+1]])}(n)}(s)}(i)},t.prototype.makeSurfacesVertices=function(){for(var t=[[0,1,2,3],[4,7,6,5],[0,3,4,5],[1,6,7,2],[2,7,4,3],[0,5,6,1]],i=0;i<this.hexahedronsToCut.length;i+=8)for(var s=0,n=t;s<n.length;s++){var r=n[s],o=r[0],a=r[1],h=r[2],l=r[3];null==this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]&&(this.createdPointsPerSurface[e.Hash.quad(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l])]=this.subdivideSurface(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a],this.hexahedronsToCut[i+h],this.hexahedronsToCut[i+l]))}},t.prototype.makeSegmentsVertices=function(){for(var t=[[0,1],[1,2],[2,3],[3,0],[0,5],[1,6],[2,7],[3,4],[4,5],[5,6],[6,7],[7,4]],i=0;i<this.hexahedronsToCut.length;i+=8)for(var s=0,n=t;s<n.length;s++){var r=n[s],o=r[0],a=r[1];null==this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a])]&&(this.createdPointsPerSegment[e.Hash.segment(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a])]=this.subdivideSegment(this.hexahedronsToCut[i+o],this.hexahedronsToCut[i+a]))}},t.prototype.subdivideSegment=function(t,i){t=(h=e.Hash.segmentOrd(t,i))[0],i=h[1];for(var s=[],n=this.subdivider,r=1;r<n;r++){var o=new e.XYZ(0,0,0),a=r/n;e.geo.baryCenter([t.position,i.position],[1-a,a],o),s[r]=this.mamesh.newVertex(o)}return s;var h},t.prototype.subdivideSurface=function(t,i,s,n){t=(p=e.Hash.quadOrd(t,i,s,n))[0],i=p[1],s=p[2],n=p[3];for(var r=[],o=this.subdivider,a=1;a<o;a++){r[a]=[];for(var h=1;h<o;h++){var l=new e.XYZ(0,0,0),u=[h/o,a/o],c=u[0],m=u[1];e.geo.baryCenter([t.position,i.position,s.position,n.position],[(1-c)*(1-m),c*(1-m),c*m,(1-c)*m],l),r[a][h]=this.mamesh.newVertex(l)}}return r;var p},t.prototype.subdivideHexahedrons=function(){this.makeSegmentsVertices(),this.makeSurfacesVertices();var e=this.hexahedronsToCut.length/8;this.newHexahedrons=[];for(var t=0;t<e;t++)this.subdivideHexahedronInVertices(8*t),this.makeNewHexahedronsFromPoints()},t}();t.HexahedronSubdivider=o;var a=function(){function t(e){this.hexahedronsToDraw=null,this.newSurfaces=null,this.surfacesSet={},this.mamesh=e}return t.prototype.checkArgs=function(){(null==this.hexahedronsToDraw&&(null==this.mamesh.hexahedrons||0==this.mamesh.hexahedrons.length)||null!=this.hexahedronsToDraw&&0==this.hexahedronsToDraw.length)&&e.logger.c("SurfacesFromHexahedrons : No input")},t.prototype.go=function(){this.checkArgs(),null==this.hexahedronsToDraw&&(this.hexahedronsToDraw=this.mamesh.hexahedrons);var t=[[0,3,2,1],[4,5,6,7],[0,5,4,3],[1,2,7,6],[2,3,4,7],[0,1,6,5]];this.newSurfaces=[];for(var i=0;i<this.hexahedronsToDraw.length;i+=8)for(var s=0,n=t;s<n.length;s++){var r=n[s],o=r[0],a=r[1],h=r[2],l=r[3],u=e.Hash.quad(this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+a],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]);null==this.surfacesSet[u]?this.surfacesSet[u]=[this.hexahedronsToDraw[i+o],this.hexahedronsToDraw[i+a],this.hexahedronsToDraw[i+h],this.hexahedronsToDraw[i+l]]:delete this.surfacesSet[u]}for(var c in this.surfacesSet)this.newSurfaces.push.apply(this.newSurfaces,this.surfacesSet[c]);for(var m=this.newSurfaces.length,o=0;o<m;o+=5e3)this.mamesh.smallestSquares.push.apply(this.mamesh.smallestSquares,this.newSurfaces.slice(o,o+5e3))},t}();t.SurfacesFromHexahedrons=a;var h=function(){function t(e){this.copyCutSegmentsDico=!0,this.copyLines=!0,this.oldMamesh=e}return t.prototype.go=function(){var t=new e.HashMap,i=new e.Mamesh;if(this.oldMamesh.vertices.forEach(function(s){var n=e.XYZ.newFrom(s.param),r=i.newVertex(s.position,s.dichoLevel,n);t.putValue(s,r),r.importantMarker=s.importantMarker,s.markers.forEach(function(e){return r.markers.push(e)})}),this.oldMamesh.vertices.forEach(function(i){for(var s=t.getValue(i),n=0;n<i.links.length;n++)s.links[n]=new e.Link(t.getValue(i.links[n].to));for(n=0;n<i.links.length;n++){var r=i.links[n],o=s.links[n];if(null!=r.opposites){o.opposites=[];for(var a=0,h=r.opposites;a<h.length;a++){var l=h[a],u=i.links.indexOf(l);o.opposites.push(s.links[u])}}}}),this.oldMamesh.smallestTriangles.forEach(function(e){i.smallestTriangles.push(t.getValue(e))}),this.oldMamesh.smallestSquares.forEach(function(e){i.smallestSquares.push(t.getValue(e))}),this.copyLines&&this.oldMamesh.linesWasMade){var s=this.oldMamesh.getStraightLinesAsVertices(),n=this.oldMamesh.getLoopLinesAsVertices();i.lines=[],s.forEach(function(s){var n=[];s.forEach(function(e){n.push(t.getValue(e))}),i.lines.push(new e.Line(n,!1))}),n.forEach(function(s){var n=[];s.forEach(function(e){n.push(t.getValue(e))}),i.lines.push(new e.Line(n,!0))})}if(this.copyCutSegmentsDico)for(var r in this.oldMamesh.cutSegmentsDico){var o=this.oldMamesh.cutSegmentsDico[r],a=t.getValue(o.a),h=t.getValue(o.b),l=new e.Segment(a,h);l.middle=t.getValue(o.middle),null!=o.orth1&&(l.orth1=t.getValue(o.orth1)),null!=o.orth2&&(l.orth2=t.getValue(o.orth2)),i.cutSegmentsDico[e.Segment.segmentId(a.hashNumber,h.hashNumber)]=l}else this.copyCutSegmentsDico=null;return i},t}();t.MameshDeepCopier=h;var l=function(){function t(t){var i=this;this.percolationProba=.5,this.probaToPercolateFunction=function(e){return 3==e.links.length?0:4==e.links.length?.3*i.percolationProba:5==e.links.length?.6*i.percolationProba:e.links.length>=6?i.percolationProba:void 0},this.SUB_random=new e.proba.Random,this.doNotPercolateOnBorder=!0,this.maxPercolationForAVertexAlreadyPercolate=0,t instanceof e.Mamesh?this.IN_vertices=t.vertices:this.IN_vertices=t}return t.prototype.goChanging=function(){if(null==this.IN_vertices)throw"vertices must be specifiate";for(var t=new e.HashMap,i=0,s=this.IN_vertices;i<s.length;i++){o=s[i];t.putValue(o,o.links.length)}for(var n=0,r=this.IN_vertices;n<r.length;n++){var o=r[n];if((!this.doNotPercolateOnBorder||!o.hasMark(e.Vertex.Markers.border))&&this.SUB_random.pseudoRand()<this.probaToPercolateFunction(o)){var a=this.SUB_random.pseudoRandInt(o.links.length),h=o.links[a].to;h.links.length>=t.getValue(h)-this.maxPercolationForAVertexAlreadyPercolate&&e.Vertex.separateTwoVoisins(o,h)}}},t}();t.PercolationOnLinks=l;var u=function(){function t(e){this.OUT_nbLinkSuppressed=0,this.OUT_nbVerticesSuppressed=0,this.suppressCellWithNoVoisin=!0,this.suppressLinkWithoutOppositeFunction=function(e){return e.links.length>=5},this.IN_mamesh=e}return t.prototype.goChanging=function(){if(null==this.IN_mamesh)throw"a Mamesh is require as IN_arg";null!=this.suppressLinkWithoutOppositeFunction&&this.suppressLinkWithoutOpposite()},t.prototype.suppressLinkWithoutOpposite=function(){for(var t=!0;t;){t=!1;for(var i=0,s=this.IN_mamesh.vertices;i<s.length;i++){var n=s[i];if(this.suppressLinkWithoutOppositeFunction(n))for(a=0;a<n.links.length;a++){var r=n.links[a];if(null==r.opposites){t=!0,e.Vertex.separateTwoVoisins(n,r.to),this.OUT_nbLinkSuppressed++;break}}}}if(this.suppressCellWithNoVoisin){for(var o=[],a=0;a<this.IN_mamesh.vertices.length;a++)0==this.IN_mamesh.vertices[a].links.length&&(o.push(a),this.OUT_nbVerticesSuppressed++);this.IN_mamesh.vertices=e.tab.arrayMinusSomeIndices(this.IN_mamesh.vertices,o)}},t}();t.MameshCleaner=u}(e.mameshModification||(e.mameshModification={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(t,i,s){void 0===i&&(i=0),void 0===s&&(s=1),this.errColor=new e.Color("#000"),this.colors=[];for(var n=((s+=1e-4)-(i+=-1e-4))/(t.length-1),r=0;r<t.length;r++)this.colors.push([r*n+i,t[r]])}return t.colorToVec3=function(e){return"vec3("+e[0].toFixed(10)+","+e[1].toFixed(10)+","+e[2].toFixed(10)+")"},t.prototype.toWebGLCode=function(e,i){for(var s="",n=0;n<this.colors.length-1;n++){var r=this.colors[n][0],o=this.colors[n+1][0];s+="if("+r.toFixed(10)+" <= "+i+" && "+i+" <= "+o.toFixed(10)+") ";var a=this.colors[n][1].toBABYLON_Color3().asArray(),h=this.colors[n+1][1].toBABYLON_Color3().asArray();s+=e+" = (",s+=t.colorToVec3(h)+"*("+i+"+"+(-r).toFixed(10)+") + ",s+=t.colorToVec3(a)+"*("+o.toFixed(10)+"-"+i+"))",s+=" / "+(o-r).toFixed(10)+";",s+=" else "}var l=this.errColor.toBABYLON_Color3().asArray();return s+=e+" = "+t.colorToVec3(l)+";"},t}();t.GradientColor=i;var s=function(){function e(e){this.scene=null,this.scene=e,this.id="mathis_tmp_"+n.shaderId.toString(),n.shaderId++}return Object.defineProperty(e.prototype,"fragmentShader",{set:function(e){BABYLON.Effect.ShadersStore[this.id+"FragmentShader"]=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexShader",{set:function(e){BABYLON.Effect.ShadersStore[this.id+"VertexShader"]=e},enumerable:!0,configurable:!0}),e}();s.shaderId=0,t.Shader=s;var n=function(t){function s(e,i){var s=t.call(this,i)||this;return s.gradient=null,s.func=e,s}return __extends(s,t),s.prototype.go=function(){this.vertexShader="\n                    precision highp float;\n                    attribute vec3 position;\n                    uniform mat4 worldViewProjection;\n                    varying vec3 vPosition;\n                    void main(void) {\n                        vPosition = position;\n                        gl_Position = worldViewProjection * vec4(position,1.);\n                }";var t=this.gradient;null==t&&(t=new i([new e.Color("#2211dd"),new e.Color("#dd1122")]));var s=t.toWebGLCode("color","func"),n="func = "+this.func.replace(/x|y|z/g,"vPosition.$&")+";";return n=n.replace(/(^|[^0-9.])([0-9]+)(?=([^0-9.]|$))/g,"$1$2."),this.fragmentShader="\n                    precision highp float;\n\n                    varying vec3 vPosition;\n                    void main(void) {\n                        vec3 color;\n                        float func;\n                        "+n+";\n                        "+s+";\n                        color = clamp(color,0.,1.);\n                        gl_FragColor = vec4(color,1.);\n                }",new BABYLON.ShaderMaterial("",this.scene,{vertexElement:this.id,fragmentElement:this.id},{attributes:["position"],uniforms:["worldViewProjection"]})},s}(s);t.FuncMapperShader=n}(e.materials||(e.materials={}))}(mathis||(mathis={}));var mathis;!function(e){function t(e){if(void 0===e&&(e=!1),"undefined"!=typeof $)return!0;if(e)throw"jQuery is not present";return!1}e.jQueryOK=t;var i=function(){function e(e){this.nbTimesThisActionMustBeFired=Number.POSITIVE_INFINITY,this.isPaused=!1,this.firedCount=0,this.id="",this.frameInterval=null,this.timeIntervalMilli=null,this.passageOrderIndex=1,this.action=e,this.lastTimeFired=performance.now()}return e}();e.PeriodicAction=i;var s=function(){function i(i,s,o){void 0===i&&(i=null),void 0===s&&(s=!0),void 0===o&&(o=!1);var a=this;if(this.callbackIfWebglNotHere=null,this.periodicActions=[],this.sortAction=function(e,t){return e.passageOrderIndex-t.passageOrderIndex},this.backgroundColor=new e.Color("#d3d3d3"),this.parentWidth=null,!o){if(null==i){var h=document.getElementsByTagName("html")[0];h.style.height="100%",h.style.width="100%",h.style.padding="0",h.style.margin="0",this.canvasParent=document.getElementsByTagName("body")[0],this.canvasParent.style.height="100%",this.canvasParent.style.width="100%",this.canvasParent.style.padding="0",this.canvasParent.style.margin="0"}else if("string"==typeof i){if(this.canvasParent=document.getElementById(i),null==this.canvasParent)throw"the id:"+i+" does not correspond to any HTMLElement"}else{if(!(i instanceof HTMLElement))throw"htmlElementOrId must be an htmlElement or the id of an html element";this.canvasParent=i}if(this.canvasParent.offsetHeight<10)throw"the container-height is too small. Perhaps no css-included ?";if(this.canvasParent.offsetWidth<10)throw"the container-width is too small.  Perhaps no css-included ?";this.canvas=document.createElement("canvas"),this.canvas.style.touchAction="none",this.canvasParent.appendChild(this.canvas),this.set100(this.canvas),this.callbackIfWebglNotHere=function(){setTimeout(function(){var e=document.createElement("DIV");e.id="noWebGL",e.innerHTML="<h3> Activez WebGL et relancez la page.</h3>\n                     <p> Safari: Développement > Activer WebGL</p>",a.canvasParent.appendChild(e),a.canvasParent.style.position="absolute",a.canvasParent.style.top="0",a.canvasParent.style.left="0",a.canvasParent.style.textAlign="center",a.canvasParent.style.zIndex="1001",a.canvasParent.style.backgroundColor="red"},100)};try{this.engine=new BABYLON.Engine(this.canvas,!0)}catch(t){e.logger.c("webGL seems to not be present. Here is the message from Babylon:"+t),this.callbackIfWebglNotHere(),this.engine=null}if(null!=this.engine){this.resetScene();var l=0,u=0,c=0;this.engine.runRenderLoop(function(){c++;for(var t in a.periodicActions){var i=a.periodicActions[t];if(!i.isPaused)if(null==i.timeIntervalMilli&&null==i.frameInterval&&(i.frameInterval=1,e.logger.c("no intervalle given for a periodic action: by default the action is fired every frame")),null!=i.timeIntervalMilli){var s=performance.now();s-i.lastTimeFired>i.timeIntervalMilli&&(a.fireAction(i),i.lastTimeFired=s)}else null!=i.frameInterval&&c%i.frameInterval==0&&a.fireAction(i)}a.scene.render(),l++;var n=a.engine.getFps();n<u&&(u=n),l%100==0&&(null!=a.$info&&(a.$info.textContent=u.toFixed()),u=Number.MAX_VALUE)}),this.domEventsHandler()}s&&(this.addDefaultLight(),this.addDefaultCamera()),t()&&(this.messageDiv=new r(this),this.subWindow_NE=new n(this,"NE"),this.subWindow_NW=new n(this,"NW"),this.subWindow_N=new n(this,"N"),this.subWindow_SE=new n(this,"SE"),this.subWindow_SW=new n(this,"SW"),this.subWindow_S=new n(this,"S"),this.subWindow_W=new n(this,"W"),this.subWindow_E=new n(this,"E"))}}return i.prototype.showFPSinCorner=function(){this.$info=document.createElement("DIV"),this.canvasParent.appendChild(this.$info),this.$info.style.position="absolute",this.$info.style.top="0",this.$info.style.left="0",this.$info.style.width="100px",this.$info.style.height="20px",this.$info.style.backgroundColor="red",this.$info.style.zIndex="1000"},i.prototype.dispose=function(){this.engine.dispose()},i.prototype.resetScene=function(){null!=this.scene&&this.scene.dispose(),this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=this.backgroundColor.toBABYLON_Color4()},i.prototype.clearScene=function(t,i,s){if(void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===s&&(s=!0),this.scene.fogMode=BABYLON.Scene.FOGMODE_NONE,null==this.scene)throw"no scene to clear";var n=[];if(null==this.scene.activeCamera||t)this.scene.cameras=[],null!=this.scene.activeCamera&&this.scene.activeCamera.detachControl(this.canvas),this.scene.activeCamera=null;else if(this.scene.activeCamera instanceof e.macamera.GrabberCamera)for(var r=0,o=this.scene.activeCamera.grabbers;r<o.length;r++){var a=o[r];n.push(a.mesh)}s||null==this.skybox?this.skybox=null:n.push(this.skybox),this.scene.meshes=n,i&&(this.scene.lights=[])},i.prototype.emptyAllCorner=function(){t(!0),this.subWindow_NW.empty(),this.subWindow_NE.empty(),this.subWindow_N.empty(),this.subWindow_SW.empty(),this.subWindow_SE.empty(),this.subWindow_S.empty(),this.subWindow_W.empty(),this.subWindow_E.empty()},i.prototype.addDefaultLight=function(){var e=new BABYLON.HemisphericLight("Hemi0",new BABYLON.Vector3(-2.5,1.4,-3.3),this.scene);e.diffuse=new BABYLON.Color3(1,1,1),e.specular=new BABYLON.Color3(.6,.6,.6),e.groundColor=new BABYLON.Color3(.3,.3,.3)},i.prototype.getGrabberCamera=function(){if(null==this.scene.activeCamera)throw"no camera defined";if(this.scene.activeCamera instanceof e.macamera.GrabberCamera)return this.scene.activeCamera;throw"active camera is not a grabber camera"},i.prototype.addDefaultCamera=function(){var t=new e.macamera.SphericalGrabber(this.scene);this.scene.activeCamera=new e.macamera.GrabberCamera(this,t),this.scene.activeCamera.attachControl(this.canvas)},i.prototype.pushPeriodicAction=function(e){this.periodicActions.push(e),this.periodicActions.sort(this.sortAction)},i.prototype.suppressPeriodicAction=function(e){var t=this.periodicActions.indexOf(e);if(-1==t)throw"this action is not registered";this.periodicActions.splice(t,1)},i.prototype.cleanAllPeriodicActions=function(){this.periodicActions=[]},i.prototype.pauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++)t[e].isPaused=!0},i.prototype.unpauseAllPeriodicActions=function(){for(var e=0,t=this.periodicActions;e<t.length;e++)t[e].isPaused=!1},i.prototype.fireAction=function(e){e.action(),++e.firedCount>=e.nbTimesThisActionMustBeFired&&this.suppressPeriodicAction(e)},i.prototype.set100=function(e){e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%"},i.prototype.onParentDimChange=function(){var e=this.canvasParent.offsetWidth;null==this.parentWidth?this.parentWidth=e:e!=this.parentWidth&&(this.parentWidth=e,this.engine.resize(),console.log("dim of parent of canvas  changes"))},i.prototype.domEventsHandler=function(){var e=this;this.parentWidth=this.canvasParent.offsetWidth,window.addEventListener("resize",function(){e.onParentDimChange()}),setInterval(function(){e.onParentDimChange()},1e3);var t,i=function(){var t=e.scene.pick(e.scene.pointerX,e.scene.pointerY,function(e){return e.isPickable},!1);if(null!=t.pickedMesh){var i=t.pickedMesh.onClick;null!=i&&i(t.pickedPoint)}},s=function(){t=performance.now()},n=function(){performance.now()-t<500&&i()},r=BABYLON.Tools.GetPointerPrefix();this.canvas.addEventListener(r+"down",s,!1),this.canvas.addEventListener(r+"up",n,!1)},i}();e.MathisFrame=s;var n=function(){function e(e,i){this.mathisFrame=e,t(!0),this.$visual=$('<div class="subWindow">'),this.$visual.addClass(i),this.mathisFrame.canvasParent.appendChild(this.$visual[0])}return e.prototype.appendAndGoToLine=function(e){this.$visual.append($("<div>").append(e))},e.prototype.append=function(e){this.$visual.append(e)},e.prototype.empty=function(){this.$visual.empty()},e}();e.SubWindow=n;var r=function(){function e(e){this.mathisFrame=e}return e.prototype.addInMathisFrame=function(){this.$logDiv=document.createElement("DIV"),this.mathisFrame.canvasParent.appendChild(this.$logDiv),this.$logDiv.style.position="absolute",this.$logDiv.style.top="0",this.$logDiv.style.left="0",this.$logDiv.style.width="100%",this.$logDiv.style.backgroundColor="white",this.$logDiv.style.zIndex="900"},e.prototype.append=function(e){null==this.$logDiv&&this.addInMathisFrame();var t=document.createElement("DIV");t.innerHTML=e,this.$logDiv.appendChild(t)},e.prototype.empty=function(){null!=this.$logDiv&&(this.$logDiv.innerHTML="")},e}();e.MessageDiv=r;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addInMathisFrame=function(){},t.prototype.append=function(e){},t.prototype.empty=function(){},t}(r);e.EmptyMessageDivForTest=o;var a=function(e){function t(){var t=e.call(this,null,null,!0)||this;return t.messageDiv=new o(t),t}return __extends(t,e),t.prototype.dispose=function(){},t.prototype.resetScene=function(){},t.prototype.clearScene=function(e,t,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===i&&(i=!0)},t.prototype.addDefaultLight=function(){},t.prototype.getGrabberCamera=function(){return new h},t.prototype.addDefaultCamera=function(){},t.prototype.pushPeriodicAction=function(e){},t.prototype.set100=function(e){},t}(s);e.EmptyMathisFrameForFastTest=a;var h=function(){function e(){}return e.prototype.changePosition=function(e,t){void 0===t&&(t=!0)},e.prototype.changeFrontDir=function(e,t){void 0===t&&(t=!0)},e.prototype.changeUpVector=function(e,t){void 0===t&&(t=!0)},e}();e.EmptyGrabberCameraForTest=h}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(t,i,s,r){this.posInWebCoor=new e.XYZ(0,0,0),this.currentDomain=new o(0,0,0),this.centerOfCurrentDomain=new e.XYZ(0,0,0),this.fondamentalDomain=new n(new e.XYZ(t,0,0),new e.XYZ(0,i,0),new e.XYZ(0,0,s));var h=e.tab.maxValue([t,i,s])*r;this.meshRepeater=new a(this,h/2,r)}return t.prototype.positionToCentredPosition=function(t){return this.fondamentalDomain.pointToWebCoordinate(t,this.posInWebCoor),this.currentDomain.whichContains(this.posInWebCoor),this.currentDomain.getCenter(this.fondamentalDomain,this.centerOfCurrentDomain),e.XYZ.newFrom(t).substract(this.centerOfCurrentDomain)},t.prototype.addMesh=function(e,t){void 0===t&&(t=!0),this.meshRepeater.addAbstractMesh(e,t)},t.prototype.actualize=function(e){void 0===e&&(e=!0),this.meshRepeater.actualize(e)},t}();t.PeriodicWorld=i;var s=function(){function t(t,i,s){this.vecA=t,this.vecB=i,this.vecC=s,this.matWebCoordinateToPoint=new e.MM,this.matPointToWebCoordinate=new e.MM,this.isCartesian=!1,this.pointWC=new e.XYZ(0,0,0),this.domainCenter=new e.XYZ(0,0,0),this.domainAroundCenter=new e.XYZ(0,0,0),this._positionWC=new r(0,0,0),this._domainPosition=new o(0,0,0),this._domainPositioncenter=new e.XYZ(0,0,0),this._zero=new e.XYZ(0,0,0),e.geo.matrixFromLines(t,i,s,this.matWebCoordinateToPoint),e.geo.inverse(this.matWebCoordinateToPoint,this.matPointToWebCoordinate)}return t.prototype.contains=function(e){throw"must be override"},t.prototype.webCoordinateToPoint=function(t,i){return e.geo.multiplicationMatrixVector(this.matWebCoordinateToPoint,t,i)},t.prototype.pointToWebCoordinate=function(t,i){e.geo.multiplicationMatrixVector(this.matPointToWebCoordinate,t,i)},t.prototype.getDomainContaining=function(e){if(this.pointToWebCoordinate(e,this.pointWC),this.isCartesian)return new o(this.pointWC.x,this.pointWC.y,this.pointWC.z);for(var t=-1;t<=1;t++)for(var i=-1;i<=1;i++)for(var s=-1;s<=1;s++){var n=new o(this.pointWC.x+t,this.pointWC.y+i,this.pointWC.z+s);if(n.contains(e,this))return n}},t.prototype.getDomainsAround=function(t,i,s){void 0===s&&(s=!0);for(var n=[],r=Math.floor(t/=2),a=new e.XYZ(r,r,r),h=-a.x;h<=a.x;h++)for(var l=-a.y;l<=a.y;l++)for(var u=-a.z;u<=a.z;u++){var c=new o(h,l,u);s&&0==h&&0==l&&0==u||(c.getCenter(this,this.domainAroundCenter),e.XYZ.DistanceSquared(this.domainAroundCenter,this.domainCenter)<i*i&&n.push(c))}return n},t.prototype.modulo=function(e,t){this.pointToWebCoordinate(e,this._positionWC),this._domainPosition.whichContains(this._positionWC),this._domainPosition.getCenter(this,this._domainPositioncenter),t.copyFrom(e).substract(this._domainPositioncenter)},t}();t.FundamentalDomain=s;var n=function(t){function i(i,s,n){var r=t.call(this,i,s,n)||this;return r.pointWC2=new e.XYZ(0,0,0),r.isCartesian=!0,r}return __extends(i,t),i.prototype.contains=function(e){return t.prototype.pointToWebCoordinate.call(this,e,this.pointWC2),!(Math.abs(this.pointWC2.x)>.5)&&(!(Math.abs(this.pointWC2.y)>.5)&&!(Math.abs(this.pointWC2.z)>.5))},i.prototype.drawMe=function(t){var i=BABYLON.Mesh.CreateBox("",1,t);i.scaling=new e.XYZ(this.vecA.length(),this.vecB.length(),this.vecC.length()),i.material=new BABYLON.StandardMaterial("",t),i.material.alpha=.2},i.prototype.getCorner=function(){var t=new e.XYZ(0,0,0);return t.add(this.vecA).add(this.vecB).add(this.vecC),t.scaleInPlace(-.5),t},i.prototype.getArretes=function(t){var i=this.getCorner(),s=new Array,n=BABYLON.Mesh.CreateCylinder("",1,1,1,12,null,t),r=BABYLON.Mesh.CreateCylinder("",1,1,1,12,null,t),o=BABYLON.Mesh.CreateCylinder("",1,1,1,12,null,t);return new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecA),n).goChanging(),new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecB),r).goChanging(),new e.visu3d.ElongateAMeshFromBeginToEnd(i,e.XYZ.newFrom(i).add(this.vecC),o).goChanging(),s.push(n),s.push(r),s.push(o),s},i}(s);t.CartesianFundamentalDomain=n;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.XYZ);t.WebCoordinate=r;var o=function(t){function i(i,s,n){var r=t.call(this,Math.round(i),Math.round(s),Math.round(n))||this;return r._point=new e.XYZ(0,0,0),r._domainCenter=new e.XYZ(0,0,0),r}return __extends(i,t),i.prototype.whichContains=function(e){return this.x=Math.round(e.x),this.y=Math.round(e.y),this.z=Math.round(e.z),this},i.prototype.equals=function(e){return e.x==this.x&&(e.y==this.y&&e.z==this.z)},i.prototype.getCenter=function(e,t){e.webCoordinateToPoint(this,t)},i.prototype.contains=function(e,t){return this._point.copyFrom(e),this.getCenter(t,this._domainCenter),this._point.substract(this._domainCenter),t.contains(this._point)},i}(r);t.Domain=o;var a=function(){function t(e,t,i){this.periodic=e,this.maxDistance=t,this.nbRepetitions=i,this.clones=[]}return t.prototype.createClones=function(t){for(var i=0,s=this.visibleDomains;i<s.length;i++){var n=s[i],r=this.sourceMesh.createInstance(""),o=new e.XYZ(0,0,0);n.getCenter(this.periodic.fondamentalDomain,o),this.clones.push([r,o]),this.actualize(t)}},t.prototype.actualize=function(e){var t=this.sourceMesh.position;e&&(t=this.periodic.positionToCentredPosition(t),this.sourceMesh.position=t);for(var i=0,s=this.clones;i<s.length;i++){var n=s[i],r=n[0],o=n[1];r.scaling.copyFrom(this.sourceMesh.scaling),r.position.copyFrom(t),null!=this.sourceMesh.rotationQuaternion&&(r.rotationQuaternion=new BABYLON.Quaternion(0,0,0,0),r.rotationQuaternion.copyFrom(this.sourceMesh.rotationQuaternion)),r.position.addInPlace(o),r.visibility=1,r.isVisible=!0}},t.prototype.addAbstractMesh=function(e,t){void 0===t&&(t=!0),this.visibleDomains=this.periodic.fondamentalDomain.getDomainsAround(this.nbRepetitions,this.maxDistance),e instanceof BABYLON.Mesh?(this.sourceMesh=e,this.createClones(t)):e instanceof BABYLON.InstancedMesh&&(this.sourceMesh=e.sourceMesh,this.createClones(t))},t}()}(e.periodicWorld||(e.periodicWorld={}))}(mathis||(mathis={}));var mathis;!function(e){var t=function(){function e(e,t){void 0===t&&(t=!1);var i=this;this.action=t?function(){i.timeout=setTimeout(e,0)}:e}return e.prototype.dispose=function(){null!=this.timeout&&clearTimeout(this.timeout)},e}(),i=function(){function e(){this.active=!1,this.tasks=new Array,this.currentIndex=-1,this.stopped=!1}return e.prototype.stop=function(){this.stopped=!0},e.prototype.nextOne=function(){++this.currentIndex<this.tasks.length?this.tasks[this.currentIndex].action():this.active=!1},e.prototype.sameOne=function(){this.tasks[this.currentIndex].action()},e.prototype.pushGroupOfTask=function(e,i){var s=this;void 0===i&&(i=!1),e.forEach(function(e){s.tasks.push(new t(e,i))}),this.active||(this.nextOne(),this.active=!0)},e.prototype.dispose=function(){for(var e=0,t=this.tasks;e<t.length;e++)t[e].dispose()},e}();e.Queue=i}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(e,t,i,s){h.copyFromFloats(e.param.x,e.param.y,e.param.z).add(t);var n=s.getValue(h);h.copyFromFloats(e.param.x,e.param.y,e.param.z).add(i);var r=s.getValue(h);null!=n&&null!=r?e.setTwoOppositeLinks(n,r):null==n&&null!=r?e.setOneLink(r):null!=n&&null==r&&e.setOneLink(n)}function s(e,t,i,s,n){var r=e;if(null!=r){var o=n.getValue(l.copyFrom(e.param).add(i));if(null!=o){var a=n.getValue(l.copyFrom(e.param).add(i).add(s));if(null!=a){var h=n.getValue(l.copyFrom(e.param).add(s));null!=h&&t.addASquare(r,o,a,h)}}}}var n=function(){function t(e){this.makeLinks=!0,this.markCorners=!0,this.addALoopLineAround=!1,this.mamesh=e}return t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0)),i=this.mamesh.newVertex(new e.XYZ(0,1,0)),s=this.mamesh.newVertex(new e.XYZ(1,0,0));this.mamesh.addATriangle(t,i,s),this.markCorners&&(t.markers.push(e.Vertex.Markers.corner),i.markers.push(e.Vertex.Markers.corner),s.markers.push(e.Vertex.Markers.corner)),this.makeLinks&&(this.addALoopLineAround?(t.setTwoOppositeLinks(i,s),i.setTwoOppositeLinks(s,t),s.setTwoOppositeLinks(t,i)):(t.setOneLink(i),t.setOneLink(s),i.setOneLink(t),i.setOneLink(s),s.setOneLink(t),s.setOneLink(i)))},t}();t.SingleTriangle=n;var r=function(){function t(){this.markCorner=!0,this.markBorder=!0,this.origin=new e.XYZ(-1,-1,0),this.end=new e.XYZ(1,1,0),this.nbSubdivisionInSide=6,this.setAllDichoLevelTo0=!0,this.mamesh=new e.Mamesh}return t.prototype.go=function(){for(var t=0;t<3;t++){var i=new e.XYZ(Math.cos(2*Math.PI*t/3-Math.PI/2),Math.sin(2*Math.PI*t/3-Math.PI/2),0),s=e.XYZ.newFrom(i);(c=this.mamesh.newVertex(s,0,i)).markers.push(e.Vertex.Markers.corner)}this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[1],this.mamesh.vertices[2]);for(var n=Math.floor(Math.log(this.nbSubdivisionInSide)/Math.log(2)),r=0;r<n;r++)(o=new e.mameshModification.TriangleDichotomer(this.mamesh)).makeLinks=!1,o.go();if(Math.pow(2,n)!=this.nbSubdivisionInSide){var o=new e.mameshModification.TriangleDichotomer(this.mamesh);o.makeLinks=!1,o.go()}var a=new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(this.mamesh);if(a.markIsolateVertexAsCorner=!1,a.goChanging(),Math.pow(2,n)!=this.nbSubdivisionInSide){var h=new e.grateAndGlue.ExtractCentralPart(this.mamesh,Math.floor((Math.pow(2,n+1)-this.nbSubdivisionInSide)/3));h.markBorder=this.markBorder,this.mamesh=h.go(),this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner)for(var l=0,u=this.mamesh.vertices;l<u.length;l++){var c=u[l];2==c.links.length&&c.markers.push(e.Vertex.Markers.corner)}if(this.setAllDichoLevelTo0)for(var m=0,p=this.mamesh.vertices;m<p.length;m++)p[m].dichoLevel=0;return e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end),this.mamesh},t}();t.TriangulatedTriangle=r;var o=function(){function t(t){this.markCorner=!0,this.markBorder=!0,this.origin=new e.XYZ(-1,-1,0),this.end=new e.XYZ(1,1,0),this.nbSubdivisionInARadius=1,this.setAllDichoLevelTo0=!0,this.mamesh=new e.Mamesh,this.nbSides=t}return t.prototype.go=function(){var t=this.mamesh.newVertex(new e.XYZ(0,0,0),0,new e.XYZ(0,0,0));t.markers.push(e.Vertex.Markers.center);for(r=0;r<this.nbSides;r++){var i=new e.XYZ(Math.cos(2*Math.PI*r/this.nbSides-Math.PI/2),Math.sin(2*Math.PI*r/this.nbSides-Math.PI/2),0),s=e.XYZ.newFrom(i),n=this.mamesh.newVertex(s,0,i);this.markBorder&&n.markers.push(e.Vertex.Markers.border)}for(r=1;r<this.nbSides+1;r++)this.mamesh.addATriangle(this.mamesh.vertices[0],this.mamesh.vertices[r],this.mamesh.vertices[r%this.nbSides+1]);if(this.nbSides%2==0)for(r=1;r<=this.nbSides/2;r++)t.setTwoOppositeLinks(this.mamesh.vertices[r],this.mamesh.vertices[r+this.nbSides/2]);else for(r=1;r<=this.nbSides;r++)t.setOneLink(this.mamesh.vertices[r]);for(var r=1;r<=this.nbSides;r++){var o=this.mamesh.vertices[r],a=r==this.nbSides?this.mamesh.vertices[1]:this.mamesh.vertices[r+1],h=1==r?this.mamesh.vertices[this.nbSides]:this.mamesh.vertices[r-1];o.setOneLink(t),o.setOneLink(a),o.setOneLink(h)}for(var l=Math.log(this.nbSubdivisionInARadius)/Math.log(2),u=0;u<l;u++)(c=new e.mameshModification.TriangleDichotomer(this.mamesh)).makeLinks=!0,c.go();if(l!=Math.floor(l)){var c=new e.mameshModification.TriangleDichotomer(this.mamesh);c.makeLinks=!0,c.go();var m=new e.grateAndGlue.ExtractCentralPart(this.mamesh,-this.nbSubdivisionInARadius);m.markBorder=this.markBorder,this.mamesh=m.go(),this.mamesh.isolateMameshVerticesFromExteriorVertices()}if(this.markCorner)for(var p=0,d=this.mamesh.vertices;p<d.length;p++)3==(n=d[p]).links.length&&n.markers.push(e.Vertex.Markers.corner);if(e.spacialTransformations.adjustInASquare(this.mamesh,this.origin,this.end),this.setAllDichoLevelTo0)for(var g=0,f=this.mamesh.vertices;g<f.length;g++)f[g].dichoLevel=0;return this.mamesh},t}();t.TriangulatedPolygone=o;var a=function(){function t(){this.nbU=3,this.set_nbV_toHaveRegularReseau=!1,this.set_nbU_toHaveRegularReseau=!1,this.nbV=3,this.origin=new e.XYZ(0,0,0),this.end=new e.XYZ(1,1,0),this.kComponentTranslation=0,this.nbVerticalDecays=0,this.nbHorizontalDecays=0,this.squareMailleInsteadOfTriangle=!0}return t.prototype.go=function(){if(this.checkArgs(),this.set_nbV_toHaveRegularReseau&&this.set_nbU_toHaveRegularReseau)throw"you must chose only one of the two options";var t,i;this.set_nbV_toHaveRegularReseau?(t=(this.end.x-this.origin.x)/(this.nbU-1),i=this.squareMailleInsteadOfTriangle?t:t*Math.sqrt(3)/2,this.nbV=Math.floor((this.end.y-this.origin.y)/i+1)):this.set_nbU_toHaveRegularReseau?(i=(this.end.y-this.origin.y)/(this.nbV-1),t=this.squareMailleInsteadOfTriangle?i:i/Math.sqrt(3)*2,this.nbU=Math.floor((this.end.x-this.origin.x)/t+1)):(t=(this.end.x-this.origin.x)/(this.nbU-1),i=(this.end.y-this.origin.y)/(this.nbV-1));var s=this.end.x-this.origin.x,n=this.end.y-this.origin.y,r=this.computeDecayVector(t,s,i,n,this.nbVerticalDecays,this.nbHorizontalDecays),o=this.computeDecayVector(i,n,t,s,this.nbHorizontalDecays,this.nbVerticalDecays),a=new e.XYZ(o.y,o.x,0);return r.z+=this.kComponentTranslation,a.z+=this.kComponentTranslation,{dirU:r,dirV:a,nbU:this.nbU,nbV:this.nbV}},t.prototype.checkArgs=function(){var t=this.end.x-this.origin.x,i=this.end.y-this.origin.y;if(Math.abs(t)<e.geo.epsilon||Math.abs(i)<e.geo.epsilon)throw"origin and end are almost in the same line";if(this.nbU<2)throw"this.nbI must be >=2";if(this.nbV<2)throw"this.nbJ must be >=2"},t.prototype.computeDecayVector=function(t,i,s,n,r,o){var a=new e.XYZ(0,0,0);return a.x=t*i*n/(i*n-t*s*o*r),a.y=s*r/i*a.x,a},t}();t.BasisForRegularReseau=a;var h=new e.XYZ(0,0,0),l=new e.XYZ(0,0,0),u=function(){function t(t){this.nbU=3,this.nbV=3,this.fixedW=0,this.dirU=new e.XYZ(1,0,0),this.dirV=new e.XYZ(0,1,0),this.dirW=new e.XYZ(0,0,0),this.origine=new e.XYZ(0,0,0),this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.squareVersusTriangleMaille=!0,this.oneMoreVertexForOddLine=!1,this.markCorner=!0,this.markBorder=!0,this.markCenter=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.OUT_paramToVertex=new e.HashMap(!0),this._xyz=new e.XYZ(0,0,0),this._iDirection=new e.XYZ(0,0,0),this._jDirection=new e.XYZ(0,0,0),this._kDirection=new e.XYZ(0,0,0),this.mamesh=new e.Mamesh,this.generator=t}return t.prototype.checkArgs=function(){this.makeTriangleOrSquare||this.makeLinks||e.logger.c("few interest if you do not add neither square nor links");var t=new e.XYZ(0,0,0);if(e.geo.cross(this.dirU,this.dirV,t),t.x==Number.NaN||t.y==Number.NaN||t.z==Number.NaN)throw"a problem with Vi of Vj";if(t.length()<e.geo.epsilon)throw"origin and end are almost in the same line"},t.prototype.getVertex=function(e,t){return this._xyz.x=e,this._xyz.y=t,this._xyz.z=this.fixedW,this.OUT_paramToVertex.getValue(this._xyz)},t.prototype.go=function(){if(null!=this.generator){var t=this.generator.go();this.dirU.copyFrom(t.dirU),this.dirV.copyFrom(t.dirV),this.nbU=t.nbU,this.nbV=t.nbV,this.origine.copyFrom(this.generator.origin),this.squareVersusTriangleMaille=this.generator.squareMailleInsteadOfTriangle}this.checkArgs();for(i=0;i<this.nbU;i++)for(s=0;s<this.nbV;s++){n=new e.XYZ(i,s,this.fixedW);if(null==this.holeParameters||!this.holeParameters(n)){r=this.squareVersusTriangleMaille||s%2!=0?0:.5;this._iDirection.copyFrom(this.dirU).scale(i+r),this._jDirection.copyFrom(this.dirV).scale(s),this._kDirection.copyFrom(this.dirW).scale(this.fixedW);o=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(null==this.putAVertexOnlyAtXYZCheckingThisCondition||this.putAVertexOnlyAtXYZCheckingThisCondition(o)){p=this.mamesh.newVertex(o,0,n);this.OUT_paramToVertex.putValue(n,p)}}}if(this.oneMoreVertexForOddLine)for(var i=this.nbU,s=0;s<this.nbV;s++)if(s%2==1){var n=new e.XYZ(i,s,this.fixedW);if(null==this.holeParameters||!this.holeParameters(n)){var r=this.squareVersusTriangleMaille||s%2!=0?0:.5;this._iDirection.copyFrom(this.dirU).scale(i+r),this._jDirection.copyFrom(this.dirV).scale(s),this._kDirection.copyFrom(this.dirW).scale(this.fixedW);var o=new e.XYZ(0,0,0).add(this._iDirection).add(this._jDirection).add(this._kDirection).add(this.origine);if(null==this.putAVertexOnlyAtXYZCheckingThisCondition||this.putAVertexOnlyAtXYZCheckingThisCondition(o)){p=this.mamesh.newVertex(o,0,n);this.OUT_paramToVertex.putValue(n,p)}}}if(0==this.mamesh.vertices.length&&console.log("you have created a IN_mamesh with no vertex. Perhaps because of {@link Regular.putAVertexOnlyAtXYZCheckingThisCondition }"),this.makeLinks&&(this.squareVersusTriangleMaille?this.linksCreationForSquare():this.linksCreationForTriangle()),this.makeTriangleOrSquare&&(this.squareVersusTriangleMaille?this.squareCreation():this.triangleCreation()),this.markBorder)if(this.squareVersusTriangleMaille)for(var a=0,h=this.mamesh.vertices;a<h.length;a++)4!=(c=h[a]).links.length&&c.markers.push(e.Vertex.Markers.border);else for(var l=0,u=this.mamesh.vertices;l<u.length;l++){var c=u[l];6!=c.links.length&&c.markers.push(e.Vertex.Markers.border)}if(this.markCorner){var m=this.oneMoreVertexForOddLine&&this.nbV%2==0?1:0,p=void 0;null!=(p=this.getVertex(0,0))&&p.markers.push(e.Vertex.Markers.corner),null!=(p=this.getVertex(this.nbU-1+m,this.nbV-1))&&p.markers.push(e.Vertex.Markers.corner),null!=(p=this.getVertex(0,this.nbV-1))&&p.markers.push(e.Vertex.Markers.corner),null!=(p=this.getVertex(this.nbU-1,0))&&p.markers.push(e.Vertex.Markers.corner)}if(this.markCenter){var d=this.nbU/2,g=[];Math.floor(d)!=d?g.push(Math.floor(d)):g.push(Math.floor(d),Math.floor(d)-1);var f=this.nbV/2,v=[];Math.floor(f)!=f?v.push(Math.floor(f)):v.push(Math.floor(f),Math.floor(f)-1);for(var y=0,b=g;y<b.length;y++)for(var i=b[y],w=0,x=v;w<x.length;w++){s=x[w];null!=(p=this.getVertex(i,s))&&p.markers.push(e.Vertex.Markers.center)}}return this.mamesh},t.prototype.linksCreationForSquare=function(){var t=this;this.mamesh.vertices.forEach(function(s){i(s,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.OUT_paramToVertex),i(s,e.XYZ.temp0(0,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex)})},t.prototype.squareCreation=function(){for(var t=new e.XYZ(1,0,0),i=new e.XYZ(0,1,0),n=0,r=this.mamesh.vertices;n<r.length;n++)s(r[n],this.mamesh,t,i,this.OUT_paramToVertex)},t.prototype.linksCreationForTriangle=function(){var t=this;this.mamesh.vertices.forEach(function(s){i(s,e.XYZ.temp0(1,0,0),e.XYZ.temp1(-1,0,0),t.OUT_paramToVertex),s.param.y%2==0?(i(s,e.XYZ.temp0(1,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex),i(s,e.XYZ.temp0(0,1,0),e.XYZ.temp1(1,-1,0),t.OUT_paramToVertex)):(i(s,e.XYZ.temp0(0,1,0),e.XYZ.temp1(-1,-1,0),t.OUT_paramToVertex),i(s,e.XYZ.temp0(-1,1,0),e.XYZ.temp1(0,-1,0),t.OUT_paramToVertex))})},t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e],s=i.param.x,n=i.param.y;if(n%2==0){r=i;if(null==(o=this.getVertex(s+1,n+1)))continue;null!=(a=this.getVertex(s,n+1))&&this.mamesh.addATriangle(r,o,a),null!=(h=this.getVertex(s+1,n))&&this.mamesh.addATriangle(r,h,o)}else{var r=i,o=this.getVertex(s,n+1);if(null==o)continue;var a=this.getVertex(s+1,n);null!=a&&this.mamesh.addATriangle(r,a,o);var h=this.getVertex(s+1,n+1);null!=h&&this.mamesh.addATriangle(o,a,h)}}},t}();t.Regular2d=u;var c;!function(e){e[e.flat=0]="flat",e[e.cylinder=1]="cylinder",e[e.moebius=2]="moebius",e[e.torus=3]="torus",e[e.klein=4]="klein"}(c=t.Topology||(t.Topology={}));var m;!function(e){e[e.quad=0]="quad",e[e.triangleH=1]="triangleH",e[e.triangleV=2]="triangleV"}(m=t.Maille||(t.Maille={}));var p=function(){function t(){this.nbU=3,this.adaptVForRegularReseau=!1,this.nbV=3,this.nbSubInterval_U=1,this.nbSubInterval_V=1,this.origin=new e.XYZ(-.7,-.7,0),this.end=new e.XYZ(.7,.7,0),this.nbVerticalDecays=0,this.nbHorizontalDecays=0,this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.makeLine=!0,this.oneMoreVertexForOddLine=!1,this.markCorner=!0,this.markBorder=!0,this.markCenter=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.maille=m.quad,this.topology=c.flat,this.flatVersusNaturalShape=!0}return t.prototype.inverseXY=function(e){var t=e.x;e.x=e.y,e.y=t},t.prototype.go=function(){var t=this.maille==m.triangleV,i=e.XYZ.newFrom(this.origin),s=e.XYZ.newFrom(this.end),n=this.nbU,r=this.nbV,o=this.nbSubInterval_U,h=this.nbSubInterval_V,l=this.nbVerticalDecays,c=this.nbHorizontalDecays;t&&(this.inverseXY(i),this.inverseXY(s),n=this.nbV,r=this.nbU,o=this.nbSubInterval_V,h=this.nbSubInterval_U,l=this.nbHorizontalDecays,c=this.nbVerticalDecays);var p=new a;p.nbU=(n-1)*o+1,this.adaptVForRegularReseau&&(t?p.set_nbU_toHaveRegularReseau=!0:p.set_nbV_toHaveRegularReseau=!0),p.nbV=(r-1)*h+1,p.origin=i,p.end=s,p.nbVerticalDecays=l,p.nbHorizontalDecays=c,p.squareMailleInsteadOfTriangle=!this.triangle;var d=p.go(),g=new u;g.dirU.copyFrom(d.dirU),g.dirV.copyFrom(d.dirV),g.nbU=d.nbU,g.nbV=d.nbV,g.origine.copyFrom(p.origin),g.squareVersusTriangleMaille=!this.triangle,g.makeLinks=this.makeLinks,g.makeTriangleOrSquare=this.makeTriangleOrSquare,g.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine,g.holeParameters=this.holeParameters,g.markCorner=this.markCorner,g.markBorder=this.markBorder,g.markCenter=this.markCenter,g.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;var f=g.go();if(t)for(var v=0,y=f.vertices;v<y.length;v++){var b=y[v];this.inverseXY(b.position)}return this.subdivisionsAndLines(f,o,h),f},Object.defineProperty(t.prototype,"triangle",{get:function(){return this.maille==m.triangleV||this.maille==m.triangleH},enumerable:!0,configurable:!0}),t.prototype.subdivisionsAndLines=function(t,i,s){var n=[];if(this.triangle)for(var r=this.nbSubInterval_U,o=0,a=t.vertices;o<a.length;o++){var h=a[o];h.param.x%r==0&&h.param.y%(2*r)==0?(h.dichoLevel=0,n.push(h)):h.param.x%r==Math.ceil(r/2)&&h.param.y%(2*r)==r?(h.dichoLevel=0,n.push(h)):h.dichoLevel=1}else for(var l=0,u=t.vertices;l<u.length;l++){var c=u[l];c.param.x%i==0&&c.param.y%s==0?(c.dichoLevel=0,n.push(c)):c.dichoLevel=1}if(this.makeLine){var m=new e.lineModule.LineComputer(t);m.startingVertices=n,t.lines=m.go()}},t.prototype.stickingTopologies=function(t){if(this.flatVersusNaturalShape){this.memorize=new e.HashMap;for(var i=0,s=t.vertices;i<s.length;i++){var n=s[i];this.memorize.putValue(n,e.XYZ.newFrom(n.position))}}var r;if(this.topology==c.klein)r=new e.equations.KleinBagel;else if(this.topology==c.cylinder)r=new e.equations.Cylinder;else if(this.topology==c.moebius)r=new e.equations.Moebius;else{if(this.topology!=c.torus)throw"topology non valid in this class";r=new e.equations.Torus}for(var o=this.end.x-this.origin.x,a=this.end.y-this.origin.y,h=0,l=t.vertices;h<l.length;h++){var u=((v=l[h]).position.x-this.origin.x)/o*(r.rangeU[1]-r.rangeU[0])+r.rangeU[0],m=(v.position.y-this.origin.y)/a*(r.rangeV[1]-r.rangeV[0])+r.rangeV[0];v.position.x=r.X(u,m),v.position.y=r.Y(u,m),v.position.z=r.Z(u,m)}var p=new e.grateAndGlue.Merger(t,null,null);p.mergeLink=!0,p.goChanging();var d=new e.linkModule.OppositeLinkAssocierByAngles(t.vertices);if(d.maxAngleToAssociateLinks=.3*Math.PI,d.goChanging(),this.flatVersusNaturalShape)for(var g=0,f=t.vertices;g<f.length;g++){var v=f[g];v.position=this.memorize.getValue(v)}},t}();t.Regular2dPlus=p;var d=function(){function t(t){void 0===t&&(t=5),this.size=t,this.origin=new e.XYZ(0,0,0),this.end=new e.XYZ(1,0,0)}return t.prototype.go=function(){if(null==this.size||this.size<=0)throw"non valide size:"+this.size;for(var t=new e.Mamesh,i=0;i<this.size;i++){var s=new e.Vertex;s.position=this.iToXYX(i),t.vertices.push(s)}for(i=1;i<this.size-1;i++)t.vertices[i].setTwoOppositeLinks(t.vertices[i-1],t.vertices[i+1]);return t.vertices[0].setOneLink(t.vertices[1]),t.vertices[this.size-1].setOneLink(t.vertices[this.size-2]),t},t.prototype.iToXYX=function(t){var i=t/(this.size-1);return e.XYZ.newFrom(this.end).substract(this.origin).scale(i).add(this.origin)},t}();t.Regular1D=d;var g=function(){function t(){this.nbU=3,this.nbJ=3,this.nbW=3,this.dirU=new e.XYZ(1,0,0),this.dirV=new e.XYZ(0,1,0),this.dirW=new e.XYZ(0,0,1),this.origine=new e.XYZ(0,0,0),this.decayOddStrates=!1,this.makeLinks=!0,this.makeTriangleOrSquare=!0,this.strateHaveSquareMailleVersusTriangleMaille=!0,this.oneMoreVertexForOddLine=!1,this.interStrateMailleAreSquareVersusTriangle=!0,this.createJKSquares=!0,this.createIKSquaresOrTriangles=!0,this.putAVertexOnlyAtXYZCheckingThisCondition=null,this.paramToVertex=new e.HashMap}return t.prototype.go=function(){var t=this;this.mamesh=new e.Mamesh;var i=new e.XYZ(0,0,0);this.decayOddStrates&&i.add(this.dirU).scale(.5);for(var n=0;n<this.nbW;n++){var r=new u;r.makeTriangleOrSquare=this.makeTriangleOrSquare,r.makeLinks=!0,r.oneMoreVertexForOddLine=this.oneMoreVertexForOddLine,r.squareVersusTriangleMaille=this.strateHaveSquareMailleVersusTriangleMaille,r.nbU=this.nbU,r.nbV=this.nbJ,r.fixedW=n,r.dirU=this.dirU,r.dirV=this.dirV,r.dirW.copyFrom(this.dirW),r.origine=e.XYZ.newFrom(this.origine),n%2==1&&r.origine.substract(i),r.putAVertexOnlyAtXYZCheckingThisCondition=this.putAVertexOnlyAtXYZCheckingThisCondition;for(var o=r.go(),a=0,h=r.OUT_paramToVertex.allEntries();a<h.length;a++){var l=h[a];this.mamesh.vertices.push(l.value),this.paramToVertex.putValue(l.key,l.value)}for(var c=0,m=o.smallestSquares;c<m.length;c++){g=m[c];this.mamesh.smallestSquares.push(g)}for(var p=0,d=o.smallestTriangles;p<d.length;p++){var g=d[p];this.mamesh.smallestTriangles.push(g)}}if(this.interStrateMailleAreSquareVersusTriangle){if(this.linksCreationForSquareMaille(),this.createJKSquares){var f=new e.XYZ(0,1,0),v=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){s(e,t.mamesh,f,v,t.paramToVertex)})}if(this.createIKSquaresOrTriangles){var y=new e.XYZ(1,0,0),b=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){s(e,t.mamesh,y,b,t.paramToVertex)})}}else{if(this.linksCreationForTriangleMaille(),this.createJKSquares){var w=new e.XYZ(0,1,0),x=new e.XYZ(0,0,1);this.mamesh.vertices.forEach(function(e){s(e,t.mamesh,w,x,t.paramToVertex)})}this.createIKSquaresOrTriangles&&this.triangleCreation()}return this.mamesh},t.prototype.linksCreationForSquareMaille=function(){var t=this,s=new e.XYZ(0,0,1),n=new e.XYZ(0,0,-1);this.mamesh.vertices.forEach(function(e){i(e,s,n,t.paramToVertex)})},t.prototype.linksCreationForTriangleMaille=function(){var t=this;this.mamesh.vertices.forEach(function(s){s.param.z%2==0?(i(s,e.XYZ.temp0(1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex),i(s,e.XYZ.temp0(0,0,1),e.XYZ.temp1(1,0,-1),t.paramToVertex)):(i(s,e.XYZ.temp0(0,0,1),e.XYZ.temp1(-1,0,-1),t.paramToVertex),i(s,e.XYZ.temp0(-1,0,1),e.XYZ.temp1(0,0,-1),t.paramToVertex))})},t.prototype.getVertex=function(t,i,s){return this.paramToVertex.getValue(new e.XYZ(t,s,i))},t.prototype.triangleCreation=function(){for(var e=0,t=this.mamesh.vertices;e<t.length;e++){var i=t[e],s=i.param.x,n=i.param.z,r=i.param.y;if(n%2==0){o=i;if(null==(a=this.getVertex(s+1,n+1,r)))continue;null!=(h=this.getVertex(s,n+1,r))&&this.mamesh.addATriangle(o,a,h),null!=(l=this.getVertex(s+1,n,r))&&this.mamesh.addATriangle(o,l,a)}else{var o=i,a=this.getVertex(s,n+1,r);if(null==a)continue;var h=this.getVertex(s+1,n,r);null!=h&&this.mamesh.addATriangle(o,h,a);var l=this.getVertex(s+1,n+1,r);null!=l&&this.mamesh.addATriangle(a,h,l)}}},t}();t.Regular3D=g}(e.reseau||(e.reseau={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t,i,s){for(var n=e.XYZ.newFrom(t.vertices[0].position),r=e.XYZ.newFrom(t.vertices[0].position),o=0,a=t.vertices;o<a.length;o++)(p=a[o]).position.x>n.x&&(n.x=p.position.x),p.position.y>n.y&&(n.y=p.position.y),p.position.x<r.x&&(r.x=p.position.x),p.position.y<r.y&&(r.y=p.position.y);for(var h=e.XYZ.newFrom(n).substract(r),l=e.XYZ.newFrom(s).substract(i),u=new e.XYZ(l.x/h.x,l.y/h.y,0),c=0,m=t.vertices;c<m.length;c++){var p=m[c];p.position.substract(r).resizes(u).add(i)}}var s=function(){function t(e){this.propBeginToRound=0,this.propEndToRound=1,this.integerBeginToRound=null,this.integerEndToRound=null,this.exponentOfRoundingFunction=1,this.referenceRadiusIsMinVersusMaxVersusMean=2,this.preventStratesCrossings=!0,this.mamesh=e}return t.prototype.goChanging=function(){if(isNaN(this.exponentOfRoundingFunction))throw"must be a number";if(this.propBeginToRound<0||this.propBeginToRound>1)throw"must be in [0,1]";if(this.propEndToRound<0||this.propEndToRound>1)throw"must be in [0,1]";if(!(this.propBeginToRound>=this.propEndToRound)){for(var t=[],i=0,s=this.mamesh.vertices;i<s.length;i++){var n=s[i];n.hasMark(e.Vertex.Markers.border)&&t.push(n)}var r=e.graph.ringify(t);if(null==this.integerBeginToRound&&(this.integerBeginToRound=Math.floor(r.length*this.propBeginToRound)),null==this.integerEndToRound&&(this.integerEndToRound=Math.ceil(r.length*this.propEndToRound)),this.integerEndToRound<0&&(this.integerEndToRound=r.length+this.integerEndToRound),this.integerBeginToRound>r.length||this.integerBeginToRound<0)throw"problem";if(this.integerEndToRound>r.length||this.integerEndToRound<0)throw"problem";if(!(this.integerEndToRound<=this.integerBeginToRound)){for(var o=new e.XYZ(0,0,0),a=0,h=this.mamesh.vertices;a<h.length;a++){var l=h[a];o.add(l.position)}o.scale(1/this.mamesh.vertices.length);for(var u=new e.XYZ(0,0,0),c=this.integerBeginToRound;c<this.integerEndToRound;c++){for(var m=-1,p=Number.POSITIVE_INFINITY,d=0,g=0,f=r[c];g<f.length;g++){w=f[g];(I=e.geo.distance(w.position,o))>m&&(m=I),I<p&&(p=I),d+=I}if(d/=r[c].length,m>e.geo.epsilon){var v=void 0;0==this.referenceRadiusIsMinVersusMaxVersusMean?v=p:1==this.referenceRadiusIsMinVersusMaxVersusMean?v=m:2==this.referenceRadiusIsMinVersusMaxVersusMean&&(v=d),v;for(var y=0,b=r[c];y<b.length;y++){var w=b[y],x=u.copyFrom(w.position).substract(o),M=x.length(),T=Math.pow(v/M,this.exponentOfRoundingFunction);x.scale(T),w.position.copyFrom(x.add(o))}}}if(this.preventStratesCrossings){if(this.integerBeginToRound>0){for(var V=-1,C=0,k=r[this.integerBeginToRound];C<k.length;C++){w=k[C];(I=e.geo.distance(w.position,o))>V&&(V=I)}for(var S=Number.POSITIVE_INFINITY,O=0,A=r[this.integerBeginToRound-1];O<A.length;O++){w=A[O];(I=e.geo.distance(w.position,o))<S&&(S=I)}Z=null;if(1.1*V>S&&(Z=1.1*V/S),null!=Z)for(D=0;D<this.integerBeginToRound;D++)for(var _=0,P=r[D];_<P.length;_++)(w=P[_]).position.copyFrom(u.copyFrom(w.position).substract(o).scale(Z).add(o))}if(this.integerEndToRound<r.length){for(var F=Number.POSITIVE_INFINITY,N=0,L=r[this.integerEndToRound-1];N<L.length;N++){w=L[N];(I=e.geo.distance(w.position,o))<F&&(F=I)}for(var Y=-1,B=0,X=r[this.integerEndToRound];B<X.length;B++){var w=X[B],I=e.geo.distance(w.position,o);I>Y&&(Y=I)}var Z=null;if(1.1*Y>F&&(Z=F/(1.1*Y)),null!=Z)for(var D=this.integerEndToRound;D<r.length;D++)for(var q=0,z=r[D];q<z.length;q++)(w=z[q]).position.copyFrom(u.copyFrom(w.position).substract(o).scale(Z).add(o))}}}}},t}();t.RoundSomeStrates=s;var n=function(){function t(t,i,s,n){void 0===s&&(s=new e.XYZ(0,0,0)),void 0===n&&(n=new e.XYZ(1,1,1)),this.axisForRotation=new e.XYZ(0,0,1),this.centerForSimilitude=null,this.vertices=t,this.angle=i,this.vectorForTranslation=s,this.sizesForResize=n}return t.prototype.goChanging=function(){var t=this;if(null==this.centerForSimilitude){this.centerForSimilitude=new e.XYZ(0,0,0);var i=1/this.vertices.length,s=[],n=[];this.vertices.forEach(function(e){n.push(e.position),s.push(i)}),e.geo.baryCenter(n,s,this.centerForSimilitude)}var r=new e.MM;e.geo.axisAngleToMatrix(this.axisForRotation,this.angle,r),this.vertices.forEach(function(i){i.position.substract(t.centerForSimilitude),i.position.resizes(t.sizesForResize),e.geo.multiplicationMatrixVector(r,i.position,i.position),i.position.add(t.centerForSimilitude).add(t.vectorForTranslation)})},t}();t.Similitude=n,t.adjustInASquare=i}(e.spacialTransformations||(e.spacialTransformations={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(e,t,i,s){this.mamesh=e,this.nbBiggerFacesDeleted=t,this.areaVsPerimeter=i,this.fillConvexFaces=s}return t.prototype.thornsSuppression=function(){for(var t=0,i=this.mamesh.vertices;t<i.length;t++)for(var s=!0,n=h=i[t];s;)if(1==n.links.length){var r=n;n=n.links[0].to,e.Vertex.separateTwoVoisins(r,r.links[0].to),e.tab.removeFromArray(this.mamesh.vertices,r)}else s=!1;for(var o=0,a=this.mamesh.vertices;o<a.length;o++){var h=a[o];h.links.length<1&&e.tab.removeFromArray(this.mamesh.vertices,h)}},t.prototype.normalsComputation=function(){for(var t=new e.HashMap,i=new e.HashMap,s=0,n=this.mamesh.vertices;s<n.length;s++){var r=n[s],o=0,a=void 0,h=[];if(r.links.length>1){for(var l=0,u=r.links;l<u.length;l++){var c=u[l],m=new BABYLON.Vector3(0,0,0);m.x=c.to.position.x-r.position.x,m.y=c.to.position.y-r.position.y,m.z=c.to.position.z-r.position.z,m.normalize(),h.push(m)}(o=BABYLON.Vector3.Dot(h[0],h[1]))<0&&(o*=-1);for(var p=h[0],d=h[1],g=0;g<h.length;g++)for(var f=g+1;f<h.length;f++)(a=BABYLON.Vector3.Dot(h[g],h[f]))<0&&(a*=-1),o>a&&(o=a,p=h[g],d=h[f]);var v=BABYLON.Vector3.Cross(p,d);v.normalize(),t.putValue(r,new e.XYZ(v.x,v.y,v.z)),i.putValue(r,-1)}}return t},t.prototype.aligningNormals=function(t){for(var i=this.mamesh.vertices[0],s=0;s<this.mamesh.vertices.length-1&&0==t.getValue(i).x&&0==t.getValue(i).y&&0==t.getValue(i).z;)i=this.mamesh.vertices[s+1],s++;var n=[];n.push(i);var r=[];r.push(n);for(var o=new e.HashMap,a=n;a.length>0;)a=e.graph.getEdge(a,o),r.push(a);for(var h=1;h<r.length;h++)for(var l=0,u=r[h];l<u.length;l++)for(var c=u[l],m=0,p=c.links;m<p.length;m++)for(var d=p[m],g=0,f=r[h-1];g<f.length;g++){var v=f[g];if(d.to==v){if(0==t.getValue(c).x&&0==t.getValue(c).y&&0==t.getValue(c).z){var y=new e.XYZ(t.getValue(v).x,t.getValue(v).y,t.getValue(v).z);t.putValue(c,y)}if(BABYLON.Vector3.Dot(t.getValue(v),t.getValue(c))<0){var b=new e.XYZ(-t.getValue(c).x,-t.getValue(c).y,-t.getValue(c).z);t.putValue(c,b)}}}},t.prototype.alreadyFilledSurfacesDetection=function(t){for(var i=new e.StringMap,s=0,n=this.mamesh.vertices;s<n.length;s++)for(var r=n[s],o=0,a=r.links;o<a.length;o++){var h=a[o];i.putValue(r.hashNumber+","+h.to.hashNumber,!1)}for(p=0;p<this.mamesh.smallestTriangles.length;p+=3){var l=this.mamesh.smallestTriangles[p],u=this.mamesh.smallestTriangles[p+1],c=this.mamesh.smallestTriangles[p+2],m=t.getValue(this.mamesh.smallestTriangles[p]);(g=new BABYLON.Vector3(0,0,0)).x=l.position.x-u.position.x,g.y=l.position.y-u.position.y,g.z=l.position.z-u.position.z,(f=new BABYLON.Vector3(0,0,0)).x=l.position.x-c.position.x,f.y=l.position.y-c.position.y,f.z=l.position.z-c.position.z,(v=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(new e.XYZ(g.x,g.y,g.z),new e.XYZ(f.x,f.y,f.z),m))<(y=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(new e.XYZ(f.x,f.y,f.z),new e.XYZ(g.x,g.y,g.z),m))?(i.putValue(l.hashNumber+","+u.hashNumber,!0),i.putValue(u.hashNumber+","+c.hashNumber,!0),i.putValue(c.hashNumber+","+l.hashNumber,!0)):(i.putValue(l.hashNumber+","+c.hashNumber,!0),i.putValue(c.hashNumber+","+u.hashNumber,!0),i.putValue(u.hashNumber+","+l.hashNumber,!0))}for(var p=0;p<this.mamesh.smallestSquares.length;p+=4){var l=this.mamesh.smallestSquares[p],u=this.mamesh.smallestSquares[p+1],c=this.mamesh.smallestSquares[p+2],d=this.mamesh.smallestSquares[p+3],m=t.getValue(this.mamesh.smallestSquares[p]),g=new BABYLON.Vector3(0,0,0);g.x=l.position.x-u.position.x,g.y=l.position.y-u.position.y,g.z=l.position.z-u.position.z;var f=new BABYLON.Vector3(0,0,0);f.x=l.position.x-d.position.x,f.y=l.position.y-d.position.y,f.z=l.position.z-d.position.z;var v=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(new e.XYZ(g.x,g.y,g.z),new e.XYZ(f.x,f.y,f.z),m),y=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(new e.XYZ(f.x,f.y,f.z),new e.XYZ(g.x,g.y,g.z),m);v<y?(i.putValue(l.hashNumber+","+u.hashNumber,!0),i.putValue(u.hashNumber+","+c.hashNumber,!0),i.putValue(c.hashNumber+","+d.hashNumber,!0),i.putValue(d.hashNumber+","+l.hashNumber,!0)):(i.putValue(l.hashNumber+","+d.hashNumber,!0),i.putValue(d.hashNumber+","+c.hashNumber,!0),i.putValue(c.hashNumber+","+u.hashNumber,!0),i.putValue(u.hashNumber+","+l.hashNumber,!0))}return i},t.prototype.floatedLinksSuppression=function(t,i){for(var s=0,n=t;s<n.length;s++){var r=n[s];if(e.Vertex.separateTwoVoisins(r[0],r[1]),r[0].links.length<1){for(var o=0,a=i;o<a.length;o++)for(var h=0,l=m=a[o];h<l.length;h++)(g=l[h])==r[0]&&e.tab.removeFromArray(m,r[0]);e.tab.removeFromArray(this.mamesh.vertices,r[0])}if(r[1].links.length<1){for(var u=0,c=i;u<c.length;u++)for(var m=c[u],p=0,d=m;p<d.length;p++){var g=d[p];g==r[1]&&e.tab.removeFromArray(m,r[1])}e.tab.removeFromArray(this.mamesh.vertices,r[1])}}},t.prototype.polygonsDetection=function(t,i){for(var s=[],n=[],r=[],o=[],a=0,h=this.mamesh.vertices;a<h.length;a++)for(var l=h[a],u=0,c=l.links;u<c.length;u++){var m=[l,c[u].to];o.push(m)}for(var p=0,d=o;p<d.length;p++){var g=d[p],f=[],v=g[0],y=g[1],b=g[0],w=g[1],x=[b,w];if(f.push(x),1!=i.getValue(b.hashNumber+","+w.hashNumber)){for(var M=[],T=!1,V=!0;V;){for(var C=6.4,k=b.links[0],S=!0,O=0,A=w.links;O<A.length;O++)if((Y=A[O]).to!=b&&0==i.getValue(w.hashNumber+","+Y.to.hashNumber)){var _=new e.XYZ(b.position.x-w.position.x,b.position.y-w.position.y,b.position.z-w.position.z),P=new e.XYZ(Y.to.position.x-w.position.x,Y.to.position.y-w.position.y,Y.to.position.z-w.position.z),F=e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(_,P,t.getValue(b));F<0&&(F=6.2831853072+F),F<C&&(C=F,k=Y),S=!1}if(S)for(var N=0,L=w.links;N<L.length;N++){var Y=L[N];if(Y.to==b){k=Y,M[M.length-1]=Y.to;break}}for(var B=[w,k.to],X=!1,I=0,Z=f;I<Z.length;I++){var D=Z[I];B[0]==D[1]&&B[1]==D[0]&&(X=!0)}for(var q=!1,z=0,E=M;z<E.length;z++)E[z]==k.to&&(q=!0);X?(s.push(B),T=!0):(q||M.push(k.to),f.push(B)),i.putValue(w.hashNumber+","+k.to.hashNumber,!0),b=w,w=k.to,b==v&&w==y&&(V=!1)}n.push(M),r.push(T)}}return this.floatedLinksSuppression(s,n),this.reorderFloatingPolygon(n,r),n},t.prototype.reorderFloatingPolygon=function(e,t){for(var i=0;i<e.length&&i<t.length;i++)if(t[i]){for(var s=[],n=e[i][0],r=e[i][0],o=void 0,a=!0,h=0,l=r.links;h<l.length;h++){var u=l[h];if(this.isInPolygon(e[i],u.to)){o=u.to;break}}s.push(r);for(var c=!0;c;){if(o!=n){for(var m=0,p=o.links;m<p.length;m++)if((u=p[m]).to!=r&&this.isInPolygon(e[i],u.to)){s.push(o),r=o,o=u.to,a=!1;break}}else c=!1;a&&(c=!1)}e[i]=s}},t.prototype.isInPolygon=function(e,t){for(var i=0,s=e;i<s.length;i++)if(s[i]==t)return!0;return!1},t.prototype.areaAndPerimeterComputation=function(t){for(var i=[],s=[],n=0,r=-1,o=0,a=t;o<a.length;o++){var h=a[o];if(r++,3==h.length){var l=e.geo.distance(h[0].position,h[1].position),u=e.geo.distance(h[0].position,h[2].position),c=e.geo.distance(h[1].position,h[2].position);if(this.areaVsPerimeter){var m=(l+u+c)/2,p=Math.sqrt(m*(m-l)*(m-u)*(m-c));i.push(p)}else{w=l+u+c;i.push(w)}}else if(4==h.length){var l=e.geo.distance(h[0].position,h[1].position),u=e.geo.distance(h[1].position,h[2].position),c=e.geo.distance(h[2].position,h[3].position),d=e.geo.distance(h[3].position,h[0].position),g=e.geo.distance(h[0].position,h[2].position);if(this.areaVsPerimeter){var f=(l+u+g)/2,v=Math.sqrt(f*(f-l)*(f-u)*(f-g)),y=(c+d+g)/2,b=Math.sqrt(y*(y-c)*(y-d)*(y-g));i.push(v+b)}else{var w=l+u+c+d;i.push(w)}}else if(h.length>=5){var x=(new e.Vertex).setPosition(0,0,0);n=1/h.length;for(var M=[],T=[],V=0,C=h;V<C.length;V++){var k=C[V];M.push(k.position),T.push(n)}e.geo.baryCenter(M,T,x.param);var S=(new e.Vertex).setPosition(x.param.x,x.param.y,x.param.z),O=0;if(this.areaVsPerimeter)for(N=0;N<h.length;N++){var A=((l=e.geo.distance(h[N].position,h[(N+1)%h.length].position))+(u=e.geo.distance(h[(N+1)%h.length].position,S.position))+(c=e.geo.distance(S.position,h[N].position)))/2;O+=Math.sqrt(A*(A-l)*(A-u)*(A-c))}else for(N=0;N<h.length;N++)O+=l=e.geo.distance(h[N].position,h[(N+1)%h.length].position);i.push(O),s[r]=S}}for(var _=0;_<this.nbBiggerFacesDeleted;_++){for(var P=-1,F=-1,N=0;N<i.length;N++)i[N]>P&&(P=i[N],F=N);i[F]=-1,t[F]=[]}return s},t.prototype.fillConvexSurface=function(t,i){i.markers.push(e.Vertex.Markers.polygonCenter),this.mamesh.vertices.push(i);for(var s=0;s<t.length;s++)this.mamesh.addATriangle(t[s],t[(s+1)%t.length],i),t[s].setOneLink(i),i.setOneLink(t[s])},t.prototype.fillNoConvexSurface=function(t,i){for(;t.length>=3;){for(var s=new e.HashMap,n=!1,r=0;r<t.length;r+=1){var o=void 0,a=void 0,h=t[r];o=0==r?t[t.length-1]:t[r-1],a=r==t.length-1?t[0]:t[r+1];var l=new e.XYZ(o.position.x-h.position.x,o.position.y-h.position.y,o.position.z-h.position.z),u=new e.XYZ(a.position.x-h.position.x,a.position.y-h.position.y,a.position.z-h.position.z);e.geo.angleBetweenTwoVectorsBetweenMinusPiAndPi(l,u,i.getValue(t[r]))<0?(s.putValue(h,!1),n=!0):s.putValue(h,!0)}for(var c=!0,r=0;r<t.length&&c;r++){var o=void 0,a=void 0,m=void 0,h=t[r];o=0==r?t[t.length-1]:t[r-1],a=r==t.length-1?t[0]:t[r+1],m=r==t.length-2?t[0]:r==t.length-1?t[1]:t[r+2],n?s.getValue(h)||(h.setOneLink(m),m.setOneLink(h),this.mamesh.addATriangle(h,a,m),e.tab.removeFromArray(t,a),c=!1):(o.setOneLink(a),a.setOneLink(o),this.mamesh.addATriangle(o,h,a),e.tab.removeFromArray(t,h),c=!1)}}},t.prototype.go=function(){this.thornsSuppression();var e=this.normalsComputation();this.aligningNormals(e);for(var t=this.alreadyFilledSurfacesDetection(e),i=this.polygonsDetection(e,t),s=this.areaAndPerimeterComputation(i),n=-1,r=0,o=i;r<o.length;r++){var a=o[r];if(n++,3==a.length)this.mamesh.addATriangle(a[0],a[1],a[2]);else if(4==a.length)this.mamesh.addASquare(a[0],a[1],a[2],a[3]);else if(a.length>=5)if(this.fillConvexFaces){var h=s[n];this.fillConvexSurface(a,h)}else this.fillNoConvexSurface(a,e)}return this.mamesh},t}();t.SurfaceConnectionProcess=i}(e.surfaceConnection||(e.surfaceConnection={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t,i,s){void 0===s&&(s=!1);var n=new e.StringMap;return n.putValue(o.verticalAxis,function(i){var n=t;return i.y%2==1&&s&&n++,new e.XYZ(n-1-i.x,i.y,i.z)}),n.putValue(o.horizontalAxis,function(t){return new e.XYZ(t.x,i-1-t.y,t.z)}),n.putValue(o.slashAxis,function(n){var r=t;return n.y%2==1&&s&&r++,new e.XYZ(r-1-n.x,i-1-n.y,n.z)}),n}function s(e,t,s){void 0===s&&(s=!1);for(var n=[],r=0,o=i(e,t,s).allValues();r<o.length;r++){var a=o[r];n.push(a)}return n}function n(t){for(var i=new e.StringMap,s=1;s<t;s++)!function(s){var n=2*Math.PI/t*s;i.putValue(o.rotation+s,function(t){var i=new e.XYZ(0,0,0);return i.x=t.x*Math.cos(n)-t.y*Math.sin(n),i.y=t.x*Math.sin(n)+t.y*Math.cos(n),i.z=t.z,i})}(s);return i}function r(e){for(var t=[],i=0,s=n(e).allValues();i<s.length;i++){var r=s[i];t.push(r)}return t}t.squareMainSymmetries=[function(t){return new e.XYZ(1-t.x,t.y,t.z)},function(t){return new e.XYZ(t.x,1-t.y,t.z)},function(t){return new e.XYZ(1-t.x,1-t.y,t.z)}];var o;!function(e){e.verticalAxis="symI",e.horizontalAxis="symJ",e.slashAxis="symIJ",e.rotation="rotation"}(o=t.keyWords||(t.keyWords={})),t.cartesian=i,t.cartesianAsArray=s,t.polygonRotations=n,t.getAllPolygonalRotations=r}(e.symmetries||(e.symmetries={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(e){if(null==e||0==e.length)throw"empty list";for(var t=e[0],i=0,s=1;s<e.length;s++)e[s]>t&&(t=e[s],i=s);return i}function s(e){return e[i(e)]}function n(e){return e[i(e)]}function r(e){if(null==e||0==e.length)throw"empty list";for(var t=e[0],i=0,s=1;s<e.length;s++)e[s]<t&&(t=e[s],i=s);return i}function o(e){return e[r(e)]}function a(e){return e[r(e)]}function h(e,t){if(null==e||0==e.length)throw"empty list";for(var i=e[0],s=0,n=1;n<e.length;n++)t(e[n],i)<0&&(i=e[n],s=n);return s}function l(e,t){return e[h(e,t)]}function u(e){for(;e.length>0;)e.pop()}function c(e,t){var i=e.indexOf(t);if(-1==i)throw cc("l'objet n'est pas dans le tableau",t),"l'objet précédent n'est pas dans le tableau:";e.splice(i,1)}function m(e,t){for(var i=[],s=0,n=e;s<n.length;s++){var r=n[s];t(r)||i.push(r)}return i}function p(e,t){for(var i=[],s=0;s<e.length;s++)-1!=t.indexOf(s)&&i.push(e[s]);return i}function d(e,t){for(var i=[],s=0;s<e.length;s++)-1==t.indexOf(s)&&i.push(e[s]);return i}function g(e,t,i){for(var s=[],n=0;n<e.length;n+=i)if(-1==t.indexOf(n))for(var r=0;r<i;r++)s.push(e[n+r]);return s}function f(t){for(var i=Number.MAX_VALUE,s=-1,n=0;n<t.length;n++)t[n]<i&&(i=t[n],s=n);return-1==s&&e.logger.c("an empty line has no minimum"),s}function v(e){for(var t=Number.NEGATIVE_INFINITY,i=-1,s=0;s<e.length;s++)e[s]>t&&(t=e[s],i=s);return i}function y(t){if(0==t.length)return e.logger.c("an empty line has no minimum"),-1;for(var i=t[0],s=0,n=0;n<t.length;n++)t[n]<i&&(i=t[n],s=n);return s}function b(e){for(var t=f(e),i=[],s=0;s<e.length;s++)i[s]=e[(s+t)%e.length];return JSON.stringify(i)}t.maxIndex=i,t.maxValue=s,t.maxValueString=n,t.minIndex=r,t.minValue=o,t.minValueString=a,t.minIndexOb=h,t.minValueOb=l,t.clearArray=u,t.removeFromArray=c,t.arrayMinusElements=m,t.arrayKeepingSomeIndices=p,t.arrayMinusSomeIndices=d,t.arrayMinusBlocksIndices=g,t.minIndexOfNumericList=f,t.maxIndexOfNumericList=v,t.minIndexOfStringList=y,t.indicesUpPermutationToString=b;var w=function(){function e(e,t,i){this.dicoOfExistingBlocks={},this.removeAlsoCircularPermutation=!0,this.longList=e,this.blockSize=t,null==i?(this.listToRemove=e,this.removeOnlyDoublon=!0):(this.listToRemove=i,this.removeOnlyDoublon=!1)}return e.prototype.go=function(){for(s=0;s<this.listToRemove.length;s+=this.blockSize)try{for(var e=[],t=0;t<this.blockSize;t++)e.push(this.listToRemove[s+t].hashString);this.dicoOfExistingBlocks[this.key(e)]=1}catch(e){throw"a block is not in your list"}for(var i=[],s=0;s<this.longList.length;s+=this.blockSize){for(var e=[],t=0;t<this.blockSize;t++)e.push(this.longList[s+t].hashString);if(this.removeOnlyDoublon){if(1==this.dicoOfExistingBlocks[this.key(e)]){for(t=0;t<this.blockSize;t++)i.push(this.longList[s+t]);this.dicoOfExistingBlocks[this.key(e)]++}}else if(null==this.dicoOfExistingBlocks[this.key(e)])for(t=0;t<this.blockSize;t++)i.push(this.longList[s+t])}return i},e.prototype.key=function(e){var t=[];if(this.removeAlsoCircularPermutation){t=[];for(var i=y(e),s=0;s<e.length;s++)t[s]=e[(s+i)%e.length]}else t=e;var n="";return t.forEach(function(e){n+=e+","}),n},e}();t.ArrayMinusBlocksElements=w}(e.tab||(e.tab={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t){for(var i=0,s=0,n=0,r=t;n<r.length;n++){var o=r[n];if(0!=o.links.length){for(var a=Number.MAX_VALUE,h=0,l=o.links;h<l.length;h++){var u=l[h],c=e.geo.distance(o.position,u.to.position);c<a&&(a=c)}i+=a,s++}}return i/=s}var s=function(){function t(t,i,s){if(this.nbSegments=32,this.meshModel=null,this.meshModels=null,this.useCloneInsteadOfInstances=!1,this.checkCollision=!1,this.color=e.color.thema.defaultVertexColor,this.radiusAbsolute=null,this.radiusProp=.1,this.vertexToCopiedMeshes=new e.HashMap,!e.deconnectViewerForTest){if(t instanceof e.Mamesh?this.vertices=t.vertices:this.vertices=t,null==i)throw"scene is null";this.scene=i,this.positionings=s}}return t.prototype.checkArgs=function(){null!=this.vertices&&null!=this.vertices[0]||cc("no vertex to draw")},t.prototype.go=function(){if(!e.deconnectViewerForTest){if(this.checkArgs(),null==this.meshModel&&null==this.meshModels)this.meshModel=BABYLON.Mesh.CreateSphere("",this.nbSegments,2,this.scene),this.meshModels=[this.meshModel];else{null==this.meshModels&&(this.meshModels=[]),null!=this.meshModel&&this.meshModels.push(this.meshModel);for(var t=0,s=this.meshModels;t<s.length;t++)(l=s[t]).bakeCurrentTransformIntoVertices()}for(var n=0,r=this.meshModels;n<r.length;n++)if(null==(l=r[n]).material){var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseColor=this.color.toBABYLON_Color3(),l.material=o}for(var a=0,h=this.meshModels;a<h.length;a++){var l=h[a];l.scaling=new e.XYZ(0,0,0)}if(null==this.positionings){this.positionings=new e.HashMap;for(var u=0,c=this.vertices;u<c.length;u++){var m=c[u],p=void 0;p=null==this.radiusAbsolute?i(this.vertices)*this.radiusProp:this.radiusAbsolute;var d=new e.Positioning;d.frontDir=new e.XYZ(1,0,0),d.upVector=new e.XYZ(0,1,0),d.scaling=new e.XYZ(p,p,p),this.positionings.putValue(m,d)}}this.buildVertexVisu()}},t.prototype.clear=function(){var e=this;this.vertices.forEach(function(t){if(null!=e.vertexToCopiedMeshes.getValue(t))for(var i=0,s=e.vertexToCopiedMeshes.getValue(t);i<s.length;i++)s[i].dispose()})},t.prototype.hidde=function(){var e=this;this.vertices.forEach(function(t){if(null!=e.vertexToCopiedMeshes.getValue(t))for(var i=0,s=e.vertexToCopiedMeshes.getValue(t);i<s.length;i++)s[i].visibility=0})},t.prototype.show=function(){var e=this;this.vertices.forEach(function(t){if(null!=e.vertexToCopiedMeshes.getValue(t))for(var i=0,s=e.vertexToCopiedMeshes.getValue(t);i<s.length;i++)s[i].visibility=1})},t.prototype.buildVertexVisu=function(e,t){var i=this;void 0===e&&(e=this.vertices),void 0===t&&(t=[]),t.forEach(function(e){if(null!=i.vertexToCopiedMeshes.getValue(e))for(var t=0,s=i.vertexToCopiedMeshes.getValue(e);t<s.length;t++)s[t].dispose();i.vertexToCopiedMeshes.removeKey(e)}),e.forEach(function(e){var t=[];if(i.useCloneInsteadOfInstances)for(var s=0,n=i.meshModels;s<n.length;s++){a=n[s];t.push(a.clone(""))}else for(var r=0,o=i.meshModels;r<o.length;r++){var a=o[r];t.push(a.createInstance(""))}for(var h=0,l=t;h<l.length;h++)(a=l[h]).checkCollisions=i.checkCollision,null!=i.parentNode&&(a.parent=i.parentNode);if(null!=i.vertexToCopiedMeshes.getValue(e))for(var u=0,c=i.vertexToCopiedMeshes.getValue(e);u<c.length;u++)(a=c[u]).dispose();i.vertexToCopiedMeshes.putValue(e,t),i.updatePositioning(e)})},t.prototype.updatePositionings=function(e){var t=this;void 0===e&&(e=this.vertices),e.forEach(function(e){return t.updatePositioning(e)})},t.prototype.updatePositioning=function(t){for(var i=e.XYZ.newFrom(t.position),s=0,n=this.vertexToCopiedMeshes.getValue(t);s<n.length;s++){var r=n[s];if(null==this.positionings.getValue(t))throw"a vertex without associated positioning";Math.abs(this.positionings.getValue(t).scaling.x)<e.geo.epsilon?r.visibility=0:(r.visibility=1,r.rotationQuaternion=this.positionings.getValue(t).quaternion(),r.position=i,r.scaling=this.positionings.getValue(t).scaling)}},t}();t.VerticesViewer=s;var n=function(){function t(t,i){this.parentNode=null,this.sideOrientation=BABYLON.Mesh.DOUBLESIDE,this.normalDuplication=r.duplicateOnlyWhenNormalsAreTooFarr,this.maxAngleBetweenNormals=Math.PI/4,this.color=e.color.thema.defaultSurfaceColor,this.alpha=.4,this.backFaceCulling=!0,this.mamesh=t,this.scene=i}return t.prototype.checkArgs=function(){if(null==this.scene)throw"the scene must but not null"},t.prototype.go=function(){if(null==this.mamesh)throw"no mamesh";if(!e.deconnectViewerForTest){for(var t=[],i=[],s=0,n=this.mamesh.vertices;s<n.length;s++){var r=n[s];t.push(r.position.x,r.position.y,r.position.z)}for(var o=[],a=0;a<this.mamesh.vertices.length;a++)o[this.mamesh.vertices[a].hashNumber]=a;for(var h=[],l=0;l<this.mamesh.smallestTriangles.length;l+=3){var u=this.mamesh.smallestTriangles[l],c=this.mamesh.smallestTriangles[l+1],m=this.mamesh.smallestTriangles[l+2];h.push(o[u.hashNumber],o[c.hashNumber],o[m.hashNumber])}for(l=0;l<this.mamesh.smallestSquares.length;l+=4){var u=this.mamesh.smallestSquares[l],c=this.mamesh.smallestSquares[l+1],m=this.mamesh.smallestSquares[l+2],p=this.mamesh.smallestSquares[l+3];h.push(o[u.hashNumber],o[c.hashNumber],o[p.hashNumber]),h.push(o[c.hashNumber],o[m.hashNumber],o[p.hashNumber])}var d=this.computeOneNormalPerTriangle(t,h),g=this.computeVertexNormalFromTrianglesNormal(t,h,d);this._ComputeSides(this.sideOrientation,t,h,g,i);var f=new BABYLON.VertexData;f.indices=h,f.positions=t,f.normals=g,f.uvs=i;var v=new BABYLON.Mesh("",this.scene);if(f.applyToMesh(v),null!=this.parentNode&&(v.parent=this.parentNode),null==this.material){var y=new BABYLON.StandardMaterial("",this.scene);y.diffuseColor=this.color.toBABYLON_Color3(),this.material=y,this.material.backFaceCulling=this.backFaceCulling,this.backFaceCulling||e.logger.c("backFaceCulling is desactivate on this mamesh."),this.material.sideOrientation=BABYLON.Mesh.BACKSIDE,y.alpha=this.alpha}return v.material=this.material,v}},t.prototype._ComputeSides=function(e,t,i,s,n){var r,o,a=i.length,h=s.length;switch(e=e||BABYLON.Mesh.DEFAULTSIDE){case BABYLON.Mesh.FRONTSIDE:break;case BABYLON.Mesh.BACKSIDE:var l;for(r=0;r<a;r+=3)l=i[r],i[r]=i[r+2],i[r+2]=l;for(o=0;o<h;o++)s[o]=-s[o];break;case BABYLON.Mesh.DOUBLESIDE:for(var u=t.length,c=u/3,m=0;m<u;m++)t[u+m]=t[m];for(r=0;r<a;r+=3)i[r+a]=i[r+2]+c,i[r+1+a]=i[r+1]+c,i[r+2+a]=i[r]+c;for(o=0;o<h;o++)s[h+o]=-s[o];for(var p=n.length,d=0;d<p;d++)n[d+p]=n[d]}},t.prototype.computeOneNormalPerTriangle=function(t,i){for(var s=[],n=0,r=0,o=0,a=0,h=0,l=0,u=0,c=0,m=0,p=0,d=0,g=0,f=0,v=i.length/3,y=0;y<v;y++)d=i[3*y],g=i[3*y+1],f=i[3*y+2],n=t[3*d]-t[3*g],r=t[3*d+1]-t[3*g+1],o=t[3*d+2]-t[3*g+2],a=t[3*f]-t[3*g],h=t[3*f+1]-t[3*g+1],u=r*(l=t[3*f+2]-t[3*g+2])-o*h,c=o*a-n*l,m=n*h-r*a,u/=p=0===(p=Math.sqrt(u*u+c*c+m*m))?1:p,c/=p,m/=p,s[y]=new e.XYZ(u,c,m);return s},t.prototype.computeVertexNormalFromTrianglesNormal=function(t,i,s){for(var n=this,o=[],a=0;a<t.length/3;a++)o[a]=new e.XYZ(0,0,0);if(this.normalDuplication==r.none){for(a=0;a<i.length;a+=3){l=Math.floor(a/3);o[i[a]].add(s[l]),o[i[a+1]].add(s[l]),o[i[a+2]].add(s[l])}o.forEach(function(t){try{t.normalize()}catch(i){e.logger.c("a very small normal is replaced by a random normal. Perhaps your surface double up. "),t.copyFrom(e.XYZ.newRandom()).normalize()}})}else{if(this.normalDuplication!=r.duplicateVertex&&this.normalDuplication!=r.duplicateOnlyWhenNormalsAreTooFarr)throw"wtf";for(var h=function(s,a,h,l,u,c){if(n.normalDuplication==r.duplicateOnlyWhenNormalsAreTooFarr)if(e.geo.xyzAlmostZero(s)||e.geo.xyzAlmostZero(a)||e.geo.angleBetweenTwoVectorsBetween0andPi(s,a)<n.maxAngleBetweenNormals)s.add(a);else{m=t.length/3;t.push(h,l,u),i[c]=m,o.push(a)}else{var m=t.length/3;t.push(h,l,u),i[c]=m,o.push(a)}},a=0;a<i.length;a+=3){var l=Math.floor(a/3),u=i[a];h(o[u],s[l],t[3*u],t[3*u+1],t[3*u+2],a),u=i[a+1],h(o[u],s[l],t[3*u],t[3*u+1],t[3*u+2],a+1),u=i[a+2],h(o[u],s[l],t[3*u],t[3*u+1],t[3*u+2],a+2)}}var c=[];return o.forEach(function(e){c.push(e.x,e.y,e.z)}),c},t}();t.SurfaceViewer=n;var r;!function(e){e[e.none=0]="none",e[e.duplicateOnlyWhenNormalsAreTooFarr=1]="duplicateOnlyWhenNormalsAreTooFarr",e[e.duplicateVertex=2]="duplicateVertex"}(r=t.NormalDuplication||(t.NormalDuplication={}));var o=function(){function t(t,i){this.radiusAbsolute=null,this.radiusProp=.05,this.tesselation=12,this.material=null,this.color=e.color.thema.defaultLinkColor,this.res=[],this.pairVertexToLateralDirection=null,this.segmentOrientationFunction=null,this.clonesInsteadOfInstances=!1,this.checkCollision=!0,this.barycenter=null,this.middle=new e.XYZ(0,0,0),this.mamesh=t,this.scene=i}return t.prototype.checkArgs=function(){if(null==this.scene)throw"scene is null";0==this.mamesh.vertices.length&&cc("your IN_mamesh has no vertex")},t.prototype.go=function(){if(!e.deconnectViewerForTest){this.checkArgs(),null==this.meshModel&&(null==this.material&&(this.material=new BABYLON.StandardMaterial("",this.scene),this.material.diffuseColor=this.color.toBABYLON_Color3()),this.meshModel=BABYLON.Mesh.CreateCylinder("",1,1,1,this.tesselation,5,this.scene),this.meshModel.material=this.material),this.meshModel.scaling=new e.XYZ(0,0,0),null==this.radiusAbsolute&&(this.radiusAbsolute=i(this.mamesh.vertices)*this.radiusProp/2);for(var t=new e.StringMap,s=0,n=this.mamesh.vertices;s<n.length;s++)for(var r=n[s],o=0,a=r.links;o<a.length;o++){var h=a[o],l=e.tab.indicesUpPermutationToString([r.hashNumber,h.to.hashNumber]);null==t.getValue(l)&&(this.drawOneLink(r,h.to),t.putValue(l,!0))}return this.res}},t.prototype.drawOneLink=function(t,i){if(null!=this.segmentOrientationFunction){if(0==this.segmentOrientationFunction(t,i))return;if(this.segmentOrientationFunction(t,i)<0){var s=t;t=i,i=s}}var n;(n=this.clonesInsteadOfInstances?this.meshModel.clone(""):this.meshModel.createInstance("")).checkCollisions=this.checkCollision;var r=new h(t.position,i.position,n);if(r.lateralScaling=2*this.radiusAbsolute,null!=this.pairVertexToLateralDirection)r.lateralDirection=this.pairVertexToLateralDirection(t,i);else{if(null==this.barycenter){this.barycenter=new e.XYZ(0,0,0);for(var o=0,a=this.mamesh.vertices;o<a.length;o++){var l=a[o];this.barycenter.add(l.position)}this.barycenter.scale(1/this.mamesh.vertices.length)}this.middle.copyFrom(t.position).add(i.position).scale(.5),this.middle.substract(this.barycenter),r.lateralDirection.copyFrom(this.middle)}r.goChanging(),null!=this.parentNode&&(n.parent=this.parentNode),this.res.push(n)},t}();t.LinksViewer=o;var a=function(){function t(t,i){if(this.vertices=null,this.doNotDrawLinesContainingOnlyInvisibleVertices=!0,this.color=null,this.lineToColor=null,this.lineToLevel=null,this.levelPropToColorFunc=function(t){return new e.Color(new e.HSV_01(.7*t,1,.8))},this.cap=BABYLON.Mesh.NO_CAP,this.tesselation=10,this.interpolationOption=new e.geometry.InterpolationOption,this.isThin=!1,this.radiusAbsolute=null,this.radiusProp=.05,this.radiusFunction=null,this.res=[],t instanceof e.Mamesh){var s=t;null!=s.lines&&0!=s.lines.length||(s.fillLineCatalogue(),e.logger.c("the mamesh has no line. So the line viewer automaticaly call the method mameh.fillLineCataclogue()")),this.lines=s.lines}else this.lines=t;this.scene=i}return t.prototype.go=function(){if(this.buildLineToColor(),!e.deconnectViewerForTest){if(null==this.scene)throw"scene is null";for(var t=0,i=this.lines;t<i.length;t++){var s=i[t];null!=this.lineToColor.getValue(s)&&this.drawOneLine(s)}return this.res}},t.prototype.clear=function(){for(var e=0,t=this.res;e<t.length;e++)t[e].dispose()},t.prototype.buildLineToColor=function(){if(null==this.color){if(null==this.lineToColor){if(null==this.lineToLevel){this.lineToLevel=new e.HashMap;for(var t=0;t<this.lines.length;t++)this.lineToLevel.putValue(this.lines[t],t)}var i=e.tab.maxValue(this.lineToLevel.allValues()),s=e.tab.minValue(this.lineToLevel.allValues());this.lineToColor=new e.HashMap;for(var n=0,r=this.lines;n<r.length;n++){var o=r[n],a=this.lineToLevel.getValue(o);if(null!=a){var h=(a-s)/(i-s);this.lineToColor.putValue(o,this.levelPropToColorFunc(h))}else this.lineToColor.putValue(o,null)}}}else{this.lineToColor=new e.HashMap;for(var l=0,u=this.lines;l<u.length;l++){o=u[l];this.lineToColor.putValue(o,this.color)}}},t.prototype.drawOneLine=function(e){var t=[],i=!0;if(e.vertices.forEach(function(e){t.push(e.position),e.isInvisible||(i=!1)}),!i||!this.doNotDrawLinesContainingOnlyInvisibleVertices){var s=this.drawOnePath(e,t);this.res.push(s)}},t.prototype.drawOnePath=function(t,s){var n,r,o=this;if(null!=this.interpolationOption&&this.interpolationOption.interpolationStyle!=e.geometry.InterpolationStyle.none){var a=new e.geometry.LineInterpoler(s);a.options=this.interpolationOption,t.isLoop&&(a.options.loopLine=!0),r=a.go()}else r=s,t.isLoop&&r.push(s[0]);s=r;var h=this.lineToColor.getValue(t).toBABYLON_Color3();if(this.isThin){var l=BABYLON.Mesh.CreateLines("",s,this.scene);l.color=h,n=l}else if(null!=this.radiusFunction){for(var u=0,c=0;c<s.length-1;c++)u+=e.geo.distance(s[c],s[c+1]);var m=function(e,t){return o.radiusFunction(t/u,s[e])};n=BABYLON.Mesh.CreateTube("",s,null,this.tesselation,m,this.cap,this.scene,!0,BABYLON.Mesh.FRONTSIDE)}else{if(null==this.radiusAbsolute){for(var p=new e.HashMap(!0),d=0,g=this.lines;d<g.length;d++)for(var f=0,v=g[d].vertices;f<v.length;f++){var y=v[f];p.putValue(y,!0)}this.radiusAbsolute=i(p.allKeys())*this.radiusProp}n=BABYLON.Mesh.CreateTube("",s,this.radiusAbsolute,this.tesselation,null,this.cap,this.scene,!0,BABYLON.Mesh.FRONTSIDE)}var b=new BABYLON.StandardMaterial("",this.scene);return b.diffuseColor=h,n.material=b,null!=this.parentNode&&(n.parent=this.parentNode),n},t}();t.LinesViewer=a;var h=function(){function t(t,i,s){this.lateralScaling=.05,this.lateralDirection=new e.XYZ(0,0,1),this.yAxis=new e.XYZ(0,1,0),this.zAxis=new e.XYZ(0,0,1),this.direction=new e.XYZ(0,0,0),this.nothing=new e.XYZ(0,0,0),this.begin=t,this.end=i,this.modelMesh=s}return t.prototype.goChanging=function(){this.direction.copyFrom(this.end).substract(this.begin);var t=this.direction.length();this.direction.normalize();var i=new e.XYZ(0,0,0);i.add(this.begin).add(this.end).scale(.5),this.modelMesh.scaling=new e.XYZ(this.lateralScaling,t,this.lateralScaling),this.modelMesh.position=i;var s=new e.XYZ(0,0,0),n=new e.XYZ(0,0,0);e.geo.cross(this.direction,this.lateralDirection,this.nothing),this.nothing.lengthSquared()<e.geo.epsilon?n.copyFromFloats(Math.random(),Math.random(),Math.random()):n.copyFrom(this.lateralDirection),e.geo.orthonormalizeKeepingFirstDirection(this.direction,n,this.nothing,s);var r=new e.XYZW(0,0,0,0);return e.geo.aQuaternionMovingABtoCD(this.yAxis,this.zAxis,this.direction,s,r,!0),this.modelMesh.rotationQuaternion=r,this.modelMesh},t}();t.ElongateAMeshFromBeginToEnd=h}(e.visu3d||(e.visu3d={}))}(mathis||(mathis={}));var cc,showDevMessages=!0;cc=showDevMessages?console.log.bind(window.console):function(){};var mathis;!function(e){e.geo=new e.Geo,e.logger=new e.Logger,e.deconnectViewerForTest=!1}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(t){var i=new e.StringMap;for(var s in t)if(t.hasOwnProperty(s)&&s.slice(0,3)==r.$$$){var n=s.slice(3),o=t[s];if($.isArray(o))o=new a(o),t[s]=o;else if(!(o instanceof a))throw"the attribute '$$$"+n+"'  must be an array or of Type Choices because it start by 3$";if(o.key=n,null!=i.getValue(n))throw"a configuration attribute is duplicated ";i.putValue(n,o)}for(var h=0,l=i.allKeys();h<l.length;h++)if(void 0===t[n=l[h]])throw"no attribute associate to  $$$"+n;t.COMMAND_DICO=i}function s(e){var t={};for(var i in e)if(i.slice(0,3)==r.$$$){var s=i.slice(3);"name"!=s&&"title"!=s&&"creator"!=s&&"keyWords"!=s&&(t[s]=e[s])}return t}function n(e){var t=[];for(var i in e)if(i.slice(0,3)==r.$$$){var s=i.slice(3);"name"!=s&&"title"!=s&&"creator"!=s&&"keyWords"!=s&&t.push(s)}return t.sort()}!function(e){e[e.basic=0]="basic",e[e.tool=1]="tool",e[e.math=2]="math",e[e.forDeveloper=3]="forDeveloper",e[e.proba=4]="proba"}(t.Keywords||(t.Keywords={}));var r;!function(e){e.$$$="$$$",e.spacesToSuppress="                ",e.toIncludeAtTheBeginOfTheFirstHiddenPiece=["var mathisFrame=new mathis.MathisFrame()"],e.traitementsForEachLine=[function(e){return e.replace(/this.mathisFrame\./g,"mathisFrame.")}],e.begin=["$$$begin","$$$b"],e.beginHidden=["$$$beginHidden","$$$bh"],e.end=["$$$end","$$$e"],e.endHidden=["$$$endHidden","$$$eh"]}(r=t.conv||(t.conv={}));var o;!function(e){e[e.select=0]="select",e[e.button=1]="button"}(o=t.ChoicesOptionsType||(t.ChoicesOptionsType={}));var a=function(){function e(e,t){if(void 0===t&&(t=null),this.$select=null,this.$button=null,this.values=e,this.options=null!=t?t:{},null!=this.options.visualValues&&e.length!=this.options.visualValues.length)throw"values.length and visualValues.length must be equal for:"+this.key}return e.prototype.changeIndex=function(e){null!=this.$select?(this.$select.selectedIndex=e,this.$select.onchange(null)):null!=this.$button&&(this.$button.selectedIndex=e,this.$button.onchange(),this.$button.updateVisual())},e.prototype.show=function(){this.$parent.show()},e.prototype.hide=function(){this.$parent.hide()},e}();t.Choices=a,t.buildCommandDico=i;var h=function(){function t(t,s,n){if(this.pieceOfCode=t,this.defaultContainer=s,this.mathisFrame=n,this.selectAndAroundClassName=null,this.keyTo$select=new e.StringMap,this.keyTo$button=new e.StringMap,this.containersToPutCommand=new e.StringMap,this.cleanContainerBefore=!1,this.addKeyOnTestOptions=!1,this.rebuildCommandDico=!0,this.go_fired=!1,null!=s){if(!(s instanceof jQuery))throw"defaultContainer must be null or a jQuery object";if(1!=s.length)throw"defaultContainer must contain a unique HTMLElement"}(this.rebuildCommandDico||null==t.COMMAND_DICO)&&i(this.pieceOfCode)}return t.prototype.setAllSelectsAccordingToPieceOfCode=function(){for(var e=0,t=this.pieceOfCode.COMMAND_DICO.allKeys();e<t.length;e++){for(var i=t[e],s=null,n=this.pieceOfCode.COMMAND_DICO.getValue(i),r=0;r<n.values.length;r++)null===n.values[r]||null===this.pieceOfCode[i]?null===n.values[r]&&null===this.pieceOfCode[i]&&(s=r):JSON.stringify(n.values[r])==JSON.stringify(this.pieceOfCode[i])&&(s=r);if(null==s){for(var o="",a=0,h=n.values;a<h.length;a++){var l=h[a];o+=JSON.stringify(l)+","}throw"in the pieceOfCode:"+this.pieceOfCode.NAME+", for the configuration-attribute:"+i+", the value:"+JSON.stringify(this.pieceOfCode[i])+" does not appear in the possible choices:"+o}var u=this.keyTo$select.getValue(i);if(null!=u)u.selectedIndex=s;else{var c=this.keyTo$button.getValue(i);null!=c&&(c.selectedIndex=s,c.updateVisual())}}},t.prototype.go=function(){var e=this;if(this.go_fired)throw"Binder.go can be fired only once";if(this.go_fired=!0,null!=this.defaultContainer&&this.containersToPutCommand.putValue("default",this.defaultContainer),null!=this.mathisFrame&&(this.containersToPutCommand.putValue("NW",this.mathisFrame.subWindow_NW.$visual),this.containersToPutCommand.putValue("NE",this.mathisFrame.subWindow_NE.$visual),this.containersToPutCommand.putValue("N",this.mathisFrame.subWindow_N.$visual),this.containersToPutCommand.putValue("SW",this.mathisFrame.subWindow_SW.$visual),this.containersToPutCommand.putValue("SE",this.mathisFrame.subWindow_SE.$visual),this.containersToPutCommand.putValue("S",this.mathisFrame.subWindow_S.$visual),this.containersToPutCommand.putValue("W",this.mathisFrame.subWindow_W.$visual),this.containersToPutCommand.putValue("E",this.mathisFrame.subWindow_E.$visual),null==this.containersToPutCommand.getValue("default")&&this.containersToPutCommand.putValue("default",this.mathisFrame.subWindow_NW.$visual)),this.cleanContainerBefore)for(var t=0,i=this.containersToPutCommand.allValues();t<i.length;t++)i[t].empty();for(var s=this,n=0,r=this.pieceOfCode.COMMAND_DICO.allKeys();n<r.length;n++)!function(t){var i=s.pieceOfCode.COMMAND_DICO.getValue(t);i.initialValueMemorized=s.pieceOfCode[t];var n=void 0,r=void 0;if(null!=i.options.containerName){if(null==(r=s.containersToPutCommand.getValue(i.options.containerName))||0==r.length)throw"the container name:"+i.options.containerName+" has no corresponding container"}else r=s.containersToPutCommand.getValue("default");var a=r.find("."+t);if(null==a||0==a.length)a=$("<span>").addClass(t),r.append($("<div>").append(a)),n=!0;else{if(a.length>1)throw"several places for the element with name:"+t;1==a.length&&(n=!1)}null!=s.selectAndAroundClassName&&a.addClass(s.selectAndAroundClassName),i.$parent=a;var h=$("<span>"),u=null==i.options.before?"":i.options.before,c=null==i.options.label?t+":":i.options.label;if(n?h.append(c).append(u):h.append(u),null==i.options.type||i.options.type==o.select){i.$select=document.createElement("select"),s.keyTo$select.putValue(t,i.$select),a.append(h),a.append(i.$select);for(d=0;d<i.$select.options.length;d++)i.$select.options[d]=null;for(d=0;d<i.values.length;d++){var m=document.createElement("option");m.value=i.values[d];var p="";s.addKeyOnTestOptions&&(p=i.key+":"),null!=i.options.visualValues?p+=i.options.visualValues[d]:p+=i.values[d],m.text=p,i.$select.appendChild(m)}i.$select.onchange=function(){e.pieceOfCode[i.key]=i.values[i.$select.selectedIndex],e.whenSelectOrButtonChange(i)}}else if(i.options.type==o.button){if(i.$button=new l,s.keyTo$button.putValue(t,i.$button),a.append(i.$button.$visual),null!=i.options.visualValues)i.$button.visualValues=i.options.visualValues;else for(var d=0;d<i.values.length;d++)i.$button.visualValues.push(i.values[d]);i.$button.onchange=function(){e.pieceOfCode[i.key]=i.values[i.$button.selectedIndex],e.whenSelectOrButtonChange(i),i.$button.updateVisual()}}}(r[n]);this.setAllSelectsAccordingToPieceOfCode()},t.prototype.whenSelectOrButtonChange=function(e){null!=this.onConfigChange&&this.onConfigChange(),null!=e.options.onchange?e.options.onchange():this.pieceOfCode.go()},t}();t.Binder=h;var l=function(){function e(){var e=this;this.visualValues=[],this.selectedIndex=0,this.$visual=$('<div class="clickable appliButton"></div>'),this.$visual.on("click touch",function(){e.increment(),e.onchange()})}return e.prototype.increment=function(){this.selectedIndex=(this.selectedIndex+1)%this.visualValues.length},e.prototype.updateVisual=function(){this.$visual.empty().append(this.visualValues[this.selectedIndex])},e}();t.$Button=l,t.pieceOfCodeToConfiguration=s,t.pieceOfCodeToSrotedConfigurationAttributes=n}(e.appli||(e.appli={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){function i(e,t){var i=new s(e).go();if(null!=i)t(i);else{var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=s.dataToMamesh(JSON.parse(this.responseText));t(e)}};var r=e.replace(/\s+/g,"-").toLowerCase();n.open("GET","TS/polyhedron/polyhedra/"+r+".json",!0),n.send()}}t.platonic=["tetrahedron","cube","octahedron","dodecahedron","icosahedron"],t.archimedean=["truncated tetrahedron","cuboctahedron","truncated cube","truncated octahedron","rhombicuboctahedron","truncated cuboctahedron","snub cube","icosidodecahedron","truncated dodecahedron","truncated icosahedron","rhombicosidodecahedron","truncated icosidodecahedron","snub dodecahedron"],t.antiprisms=["square antiprism","pentagonal antiprism","hexagonal antiprism","octagonal antiprism","decagonal antiprism"],t.johnson=["square pyramid","pentagonal pyramid","triangular cupola","square cupola","pentagonal cupola","pentagonal rotunda","elongated triangular pyramid","elongated square pyramid","elongated pentagonal pyramid","gyroelongated square pyramid","gyroelongated pentagonal pyramid","triangular bipyramid","pentagonal bipyramid","elongated triangular bipyramid","elongated square bipyramid","elongated pentagonal bipyramid","gyroelongated square bipyramid","elongated triangular cupola","elongated square cupola","elongated pentagonal cupola","elongated pentagonal rotunda","gyroelongated triangular cupola","gyroelongated square cupola","gyroelongated pentagonal cupola","gyroelongated pentagonal rotunda","gyrobifastigium","triangular orthobicupola","square orthobicupola","square gyrobicupola","pentagonal orthobicupola","pentagonal gyrobicupola","pentagonal orthocupolarotunda","pentagonal gyrocupolarotunda","pentagonal orthobirotunda","elongated triangular orthobicupola","elongated triangular gyrobicupola","elongated square gyrobicupola","elongated pentagonal orthobicupola","elongated pentagonal gyrobicupola","elongated pentagonal orthocupolarotunda","elongated pentagonal gyrocupolarotunda","elongated pentagonal orthobirotunda","elongated pentagonal gyrobirotunda","gyroelongated triangular bicupola","gyroelongated square bicupola","gyroelongated pentagonal bicupola","gyroelongated pentagonal cupolarotunda","gyroelongated pentagonal birotunda","augmented triangular prism","biaugmented triangular prism","triaugmented triangular prism","augmented pentagonal prism","biaugmented pentagonal prism","augmented hexagonal prism","parabiaugmented hexagonal prism","metabiaugmented hexagonal prism","triaugmented hexagonal prism","augmented dodecahedron","parabiaugmented dodecahedron","metabiaugmented dodecahedron","triaugmented dodecahedron","metabidiminished icosahedron","tridiminished icosahedron","augmented tridiminished icosahedron","augmented truncated tetrahedron","augmented truncated cube","biaugmented truncated cube","augmented truncated dodecahedron","parabiaugmented truncated dodecahedron","metabiaugmented truncated dodecahedron","triaugmented truncated dodecahedron","gyrate rhombicosidodecahedron","parabigyrate rhombicosidodecahedron","metabigyrate rhombicosidodecahedron","trigyrate rhombicosidodecahedron","diminished rhombicosidodecahedron","paragyrate diminished rhombicosidodecahedron","metagyrate diminished rhombicosidodecahedron","bigyrate diminished rhombicosidodecahedron","parabidiminished rhombicosidodecahedron","metabidiminished rhombicosidodecahedron","gyrate bidiminished rhombicosidodecahedron","tridiminished rhombicosidodecahedron","snub disphenoid","snub square antiprism","sphenocorona","augmented sphenocorona","sphenomegacorona","hebesphenomegacorona","disphenocingulum","bilunabirotunda","triangular hebesphenorotunda"],t.prisms=["triangular prism","pentagonal prism","hexagonal prism","octagonal prism","decagonal prism"];var s=function(){function t(e){this.makeLinks=!0,this.type=e.toLowerCase()}return t.dataToMamesh=function(t){for(var i=new e.Mamesh,s=0,n=t.vertices;s<n.length;s++){var r=n[s];i.newVertex(new e.XYZ(r[0],r[1],r[2]))}for(var o=Number.MIN_VALUE,a=0,h=i.vertices;a<h.length;a++){var l=(m=h[a]).position.length();l>o&&(o=l)}for(var u=0,c=i.vertices;u<c.length;u++){var m=c[u];m.position.scale(1/o)}for(var p=0,d=0,g=t.faces;d<g.length;d++){var f=g[d];if(3==f.length)i.addATriangle(i.vertices[f[0]],i.vertices[f[1]],i.vertices[f[2]]);else if(4==f.length)i.addASquare(i.vertices[f[0]],i.vertices[f[1]],i.vertices[f[2]],i.vertices[f[3]]);else if(f.length>=5){var v=i.newVertex(new e.XYZ(0,0,0));v.markers.push(e.Vertex.Markers.polygonCenter),p=1/f.length;for(var y=[i.vertices[f[0]]],b=[y[0].position],w=[p],x=1;x<f.length;x++)y.push(i.vertices[f[x]]),b.push(y[x].position),w.push(p);e.geo.baryCenter(b,w,v.position);for(x=0;x<f.length;x++)i.addATriangle(y[x],y[(x+1)%f.length],v)}}return new e.linkModule.LinkCreaterSorterAndBorderDetecterByPolygons(i).goChanging(),i},t.prototype.go=function(){var i=[];i.tetrahedron={vertices:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],faces:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},i.cube={vertices:[[0,0,1.224745],[1.154701,0,.4082483],[-.5773503,1,.4082483],[-.5773503,-1,.4082483],[.5773503,1,-.4082483],[.5773503,-1,-.4082483],[-1.154701,0,-.4082483],[0,0,-1.224745]],faces:[[0,1,4,2],[0,2,6,3],[0,3,5,1],[1,5,7,4],[2,4,7,6],[3,6,7,5]]},i.octahedron={vertices:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},i.dodecahedron={vertices:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],faces:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},i.icosahedron={vertices:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},i["truncated tetrahedron"]={vertices:[[0,0,1.105542],[.8528029,0,.7035265],[-.7106691,.4714045,.7035265],[.3316456,-.7856742,.7035265],[.9949367,.4714045,-.1005038],[-1.089693,.1571348,-.1005038],[-.5685352,.942809,-.1005038],[-.04737794,-1.099944,-.1005038],[.6159132,.1571348,-.904534],[.2842676,.942809,-.5025189],[-.758047,-.6285394,-.5025189],[.09475587,-.6285394,-.904534]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,10,11],[0,1,4,9,6,2],[0,2,5,10,7,3],[1,3,7,11,8,4],[5,6,9,8,11,10]]},i["truncated cube"]={vertices:[[0,0,1.042011],[.5621693,0,.8773552],[-.4798415,.2928932,.8773552],[.2569714,-.5,.8773552],[.8773552,.2928932,.4798415],[-.9014684,.2071068,.4798415],[-.5962706,.7071068,.4798415],[.1405423,-.9142136,.4798415],[1.017898,.2071068,-.08232778],[.7609261,.7071068,.08232778],[-1.017898,-.2071068,.08232778],[-.2810846,1,.08232778],[-.2810846,-1,.08232778],[.2810846,-1,-.08232778],[.9014684,-.2071068,-.4798415],[.2810846,1,-.08232778],[-.7609261,-.7071068,-.08232778],[-.8773552,-.2928932,-.4798415],[-.1405423,.9142136,-.4798415],[.5962706,-.7071068,-.4798415],[.4798415,-.2928932,-.8773552],[-.5621693,0,-.8773552],[-.2569714,.5,-.8773552],[0,0,-1.042011]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,15,18],[14,19,20],[21,22,23],[0,1,4,9,15,11,6,2],[0,2,5,10,16,12,7,3],[1,3,7,13,19,14,8,4],[5,6,11,18,22,21,17,10],[8,14,20,23,22,18,15,9],[12,16,17,21,23,20,19,13]]},i["truncated octahedron"]={vertices:[[0,0,1.054093],[.6324555,0,.843274],[-.421637,.4714045,.843274],[-.07027284,-.6285394,.843274],[.843274,.4714045,.421637],[.5621827,-.6285394,.6324555],[-.9135469,.3142697,.421637],[-.2108185,.942809,.421637],[-.5621827,-.7856742,.421637],[.9838197,.3142697,-.2108185],[.421637,.942809,.2108185],[.7027284,-.7856742,0],[-.7027284,.7856742,0],[-.9838197,-.3142697,.2108185],[-.421637,-.942809,-.2108185],[.5621827,.7856742,-.421637],[.9135469,-.3142697,-.421637],[.2108185,-.942809,-.421637],[-.5621827,.6285394,-.6324555],[-.843274,-.4714045,-.421637],[.07027284,.6285394,-.843274],[.421637,-.4714045,-.843274],[-.6324555,0,-.843274],[0,0,-1.054093]],faces:[[0,3,5,1],[2,7,12,6],[4,9,15,10],[8,13,19,14],[11,17,21,16],[18,20,23,22],[0,1,4,10,7,2],[0,2,6,13,8,3],[1,5,11,16,9,4],[3,8,14,17,11,5],[6,12,18,22,19,13],[7,10,15,20,18,12],[9,16,21,23,20,15],[14,19,22,23,21,17]]},i["truncated dodecahedron"]={vertices:[[0,0,1.014485],[.3367628,0,.9569589],[-.2902233,.1708204,.9569589],[.1634681,-.2944272,.9569589],[.5914332,.1708204,.806354],[-.5963465,.1527864,.806354],[-.4230517,.4472136,.806354],[.1377417,-.6,.806354],[.8302037,.1527864,.5626702],[.6667356,.4472136,.6201961],[-.8014407,-.0472136,.6201961],[-.3477493,.7236068,.6201961],[-.06735256,-.8,.6201961],[.2694102,-.8,.5626702],[.9618722,-.0472136,.3189863],[.5339072,.7236068,.4695912],[-.8271671,-.3527864,.4695912],[-.9599955,-.0763932,.3189863],[-.3992021,.8763932,.3189863],[-.09307895,.8944272,.4695912],[-.3734757,-.818034,.4695912],[.5081808,-.818034,.3189863],[.9361459,-.3527864,.1683814],[1.011448,-.0763932,-.0177765],[.4824544,.8763932,.1683814],[.2436839,.8944272,.4120653],[-.663699,-.6472136,.4120653],[-1.011448,.0763932,.0177765],[-.5577569,.8472136,.0177765],[-.5320305,-.8472136,.1683814],[.5577569,-.8472136,-.0177765],[.7628511,-.6472136,.1683814],[.9599955,.0763932,-.3189863],[.5320305,.8472136,-.1683814],[-.9618722,.0472136,-.3189863],[-.9361459,.3527864,-.1683814],[-.7628511,.6472136,-.1683814],[-.5081808,.818034,-.3189863],[-.4824544,-.8763932,-.1683814],[.3992021,-.8763932,-.3189863],[.8014407,.0472136,-.6201961],[.8271671,.3527864,-.4695912],[.663699,.6472136,-.4120653],[.3734757,.818034,-.4695912],[-.8302037,-.1527864,-.5626702],[-.2694102,.8,-.5626702],[-.5339072,-.7236068,-.4695912],[-.2436839,-.8944272,-.4120653],[.09307895,-.8944272,-.4695912],[.3477493,-.7236068,-.6201961],[.5963465,-.1527864,-.806354],[.06735256,.8,-.6201961],[-.6667356,-.4472136,-.6201961],[-.5914332,-.1708204,-.806354],[-.1377417,.6,-.806354],[.4230517,-.4472136,-.806354],[.2902233,-.1708204,-.9569589],[-.3367628,0,-.9569589],[-.1634681,.2944272,-.9569589],[0,0,-1.014485]],faces:[[0,3,1],[2,6,5],[4,8,9],[7,12,13],[10,17,16],[11,19,18],[14,22,23],[15,24,25],[20,26,29],[21,30,31],[27,35,34],[28,37,36],[32,40,41],[33,42,43],[38,46,47],[39,48,49],[44,53,52],[45,51,54],[50,55,56],[57,58,59],[0,1,4,9,15,25,19,11,6,2],[0,2,5,10,16,26,20,12,7,3],[1,3,7,13,21,31,22,14,8,4],[5,6,11,18,28,36,35,27,17,10],[8,14,23,32,41,42,33,24,15,9],[12,20,29,38,47,48,39,30,21,13],[16,17,27,34,44,52,46,38,29,26],[18,19,25,24,33,43,51,45,37,28],[22,31,30,39,49,55,50,40,32,23],[34,35,36,37,45,54,58,57,53,44],[40,50,56,59,58,54,51,43,42,41],[46,52,53,57,59,56,55,49,48,47]]},i["truncated icosahedron"]={vertices:[[0,0,1.021],[.4035482,0,.9378643],[-.2274644,.3333333,.9378643],[-.1471226,-.375774,.9378643],[.579632,.3333333,.7715933],[.5058321,-.375774,.8033483],[-.6020514,.2908927,.7715933],[-.05138057,.6666667,.7715933],[.1654988,-.6080151,.8033483],[-.5217096,-.4182147,.7715933],[.8579998,.2908927,.4708062],[.3521676,.6666667,.6884578],[.7841999,-.4182147,.5025612],[-.657475,.5979962,.5025612],[-.749174,-.08488134,.6884578],[-.3171418,.8302373,.5025612],[.1035333,-.8826969,.5025612],[-.5836751,-.6928964,.4708062],[.8025761,.5979962,.2017741],[.9602837,-.08488134,.3362902],[.4899547,.8302373,.3362902],[.7222343,-.6928964,.2017741],[-.8600213,.5293258,.1503935],[-.9517203,-.1535518,.3362902],[-.1793548,.993808,.1503935],[.381901,-.9251375,.2017741],[-.2710537,-.9251375,.3362902],[-.8494363,-.5293258,.2017741],[.8494363,.5293258,-.2017741],[1.007144,-.1535518,-.06725804],[.2241935,.993808,.06725804],[.8600213,-.5293258,-.1503935],[-.7222343,.6928964,-.2017741],[-1.007144,.1535518,.06725804],[-.381901,.9251375,-.2017741],[.1793548,-.993808,-.1503935],[-.2241935,-.993808,-.06725804],[-.8025761,-.5979962,-.2017741],[.5836751,.6928964,-.4708062],[.9517203,.1535518,-.3362902],[.2710537,.9251375,-.3362902],[.657475,-.5979962,-.5025612],[-.7841999,.4182147,-.5025612],[-.9602837,.08488134,-.3362902],[-.1035333,.8826969,-.5025612],[.3171418,-.8302373,-.5025612],[-.4899547,-.8302373,-.3362902],[-.8579998,-.2908927,-.4708062],[.5217096,.4182147,-.7715933],[.749174,.08488134,-.6884578],[.6020514,-.2908927,-.7715933],[-.5058321,.375774,-.8033483],[-.1654988,.6080151,-.8033483],[.05138057,-.6666667,-.7715933],[-.3521676,-.6666667,-.6884578],[-.579632,-.3333333,-.7715933],[.1471226,.375774,-.9378643],[.2274644,-.3333333,-.9378643],[-.4035482,0,-.9378643],[0,0,-1.021]],faces:[[0,3,8,5,1],[2,7,15,13,6],[4,10,18,20,11],[9,14,23,27,17],[12,21,31,29,19],[16,26,36,35,25],[22,32,42,43,33],[24,30,40,44,34],[28,39,49,48,38],[37,47,55,54,46],[41,45,53,57,50],[51,52,56,59,58],[0,1,4,11,7,2],[0,2,6,14,9,3],[1,5,12,19,10,4],[3,9,17,26,16,8],[5,8,16,25,21,12],[6,13,22,33,23,14],[7,11,20,30,24,15],[10,19,29,39,28,18],[13,15,24,34,32,22],[17,27,37,46,36,26],[18,28,38,40,30,20],[21,25,35,45,41,31],[23,33,43,47,37,27],[29,31,41,50,49,39],[32,34,44,52,51,42],[35,36,46,54,53,45],[38,48,56,52,44,40],[42,51,58,55,47,43],[48,49,50,57,59,56],[53,54,55,58,59,57]]},i.cuboctahedron={vertices:[[0,0,1.154701],[1,0,.5773503],[.3333333,.942809,.5773503],[-1,0,.5773503],[-.3333333,-.942809,.5773503],[1,0,-.5773503],[.6666667,-.942809,0],[-.6666667,.942809,0],[.3333333,.942809,-.5773503],[-1,0,-.5773503],[-.3333333,-.942809,-.5773503],[0,0,-1.154701]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,7,9],[4,10,6],[5,11,8],[9,11,10],[0,2,7,3],[0,4,6,1],[1,5,8,2],[3,9,10,4],[5,6,10,11],[7,8,11,9]]},i["truncated cuboctahedron"]={vertices:[[0,0,1.024117],[.4314788,0,.928785],[-.02106287,.4309644,.928785],[-.3410582,-.2642977,.928785],[.4104159,.4309644,.833453],[.7006238,-.2642977,.6986333],[-.3831839,.5976311,.7381211],[-.3919084,-.6380712,.6986333],[-.7031792,-.09763107,.7381211],[.6584981,.5976311,.5079694],[.6497736,-.6380712,.4684816],[.948706,-.09763107,.3731496],[-.4638216,.8333333,.3731496],[-.7242421,.3333333,.6427891],[-.7540295,-.4714045,.5079694],[-.1227634,-.9023689,.4684816],[.5778604,.8333333,.1429979],[.9276431,.3333333,.2778177],[.8978557,-.4714045,.1429979],[.3087154,-.9023689,.3731496],[-.8048797,.5690356,.2778177],[-.2157394,1,.04766598],[-.8470055,-.5690356,.08715377],[-.2157394,-1,.04766598],[.8470055,.5690356,-.08715377],[.2157394,1,-.04766598],[.8048797,-.5690356,-.2778177],[.2157394,-1,-.04766598],[-.8978557,.4714045,-.1429979],[-.3087154,.9023689,-.3731496],[-.9276431,-.3333333,-.2778177],[-.5778604,-.8333333,-.1429979],[.7540295,.4714045,-.5079694],[.1227634,.9023689,-.4684816],[.7242421,-.3333333,-.6427891],[.4638216,-.8333333,-.3731496],[-.948706,.09763107,-.3731496],[-.6497736,.6380712,-.4684816],[-.6584981,-.5976311,-.5079694],[.7031792,.09763107,-.7381211],[.3919084,.6380712,-.6986333],[.3831839,-.5976311,-.7381211],[-.7006238,.2642977,-.6986333],[-.4104159,-.4309644,-.833453],[.3410582,.2642977,-.928785],[.02106287,-.4309644,-.928785],[-.4314788,0,-.928785],[0,0,-1.024117]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,24,16],[15,23,27,19],[21,25,33,29],[22,30,38,31],[26,35,41,34],[28,37,42,36],[32,39,44,40],[43,46,47,45],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,31,23,15],[10,19,27,35,26,18],[12,21,29,37,28,20],[16,24,32,40,33,25],[30,36,42,46,43,38],[34,41,45,47,44,39],[0,3,7,15,19,10,5,1],[2,4,9,16,25,21,12,6],[8,13,20,28,36,30,22,14],[11,18,26,34,39,32,24,17],[23,31,38,43,45,41,35,27],[29,33,40,44,47,46,42,37]]},i.rhombicuboctahedron={vertices:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],faces:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},i["snub cube"]={vertices:[[0,0,1.077364],[.7442063,0,.7790187],[.3123013,.6755079,.7790187],[-.482096,.5669449,.7790187],[-.7169181,-.1996786,.7790187],[-.1196038,-.7345325,.7790187],[.6246025,-.7345325,.4806734],[1.056508,-.1996786,.06806912],[.8867128,.5669449,.2302762],[.2621103,1.042774,.06806912],[-.532287,.9342111,.06806912],[-1.006317,.3082417,.2302762],[-.7020817,-.784071,.2302762],[.02728827,-1.074865,.06806912],[.6667271,-.784071,-.3184664],[.8216855,-.09111555,-.6908285],[.6518908,.6755079,-.5286215],[-.1196038,.8751866,-.6168117],[-.8092336,.4758293,-.5286215],[-.9914803,-.2761507,-.3184664],[-.4467414,-.825648,-.5286215],[.1926974,-.5348539,-.915157],[.1846311,.2587032,-1.029416],[-.5049987,-.1406541,-.9412258]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,6],[6,13,14],[6,14,7],[7,14,15],[8,16,9],[9,16,17],[9,17,10],[10,17,18],[10,18,11],[11,18,19],[12,19,20],[12,20,13],[14,21,15],[15,21,22],[15,22,16],[16,22,17],[18,23,19],[19,23,20],[20,23,21],[21,23,22],[0,5,6,1],[2,9,10,3],[4,11,19,12],[7,15,16,8],[13,20,21,14],[17,22,23,18]]},i.icosidodecahedron={vertices:[[0,0,1.051462],[.618034,0,.8506508],[.2763932,.5527864,.8506508],[-.618034,0,.8506508],[-.2763932,-.5527864,.8506508],[1,0,.3249197],[.7236068,-.5527864,.5257311],[-.1708204,.8944272,.5257311],[.4472136,.8944272,.3249197],[-1,0,.3249197],[-.7236068,.5527864,.5257311],[.1708204,-.8944272,.5257311],[-.4472136,-.8944272,.3249197],[1,0,-.3249197],[.8944272,.5527864,0],[.5527864,-.8944272,0],[-.5527864,.8944272,0],[.4472136,.8944272,-.3249197],[-1,0,-.3249197],[-.8944272,-.5527864,0],[-.4472136,-.8944272,-.3249197],[.618034,0,-.8506508],[.7236068,-.5527864,-.5257311],[.1708204,-.8944272,-.5257311],[-.7236068,.5527864,-.5257311],[-.1708204,.8944272,-.5257311],[.2763932,.5527864,-.8506508],[-.618034,0,-.8506508],[-.2763932,-.5527864,-.8506508],[0,0,-1.051462]],faces:[[0,1,2],[0,3,4],[1,6,5],[2,8,7],[3,10,9],[4,12,11],[5,13,14],[6,11,15],[7,16,10],[8,14,17],[9,18,19],[12,19,20],[13,22,21],[15,23,22],[16,25,24],[17,26,25],[18,24,27],[20,28,23],[21,29,26],[27,29,28],[0,2,7,10,3],[0,4,11,6,1],[1,5,14,8,2],[3,9,19,12,4],[5,6,15,22,13],[7,8,17,25,16],[9,10,16,24,18],[11,12,20,23,15],[13,21,26,17,14],[18,27,28,20,19],[21,22,23,28,29],[24,25,26,29,27]]},i["truncated icosidodecahedron"]={vertices:[[0,0,1.008759],[.2629922,0,.973874],[-.00462747,.2629515,.973874],[-.2211363,-.1423503,.973874],[.2583647,.2629515,.9389886],[.4673861,-.1423503,.8825429],[-.2303913,.3835526,.9041033],[-.3159502,-.372678,.8825429],[-.4469001,-.02174919,.9041033],[.4581312,.3835526,.8127722],[.5351104,-.372678,.7696515],[.6671526,-.02174919,.7563265],[-.3326926,.5786893,.7563265],[-.4515276,.2412023,.8692179],[-.541714,-.2520769,.8127722],[-.248226,-.6030057,.7696515],[.518368,.5786893,.6434351],[.6625252,.2412023,.7214412],[.7348768,-.2520769,.6434351],[.4402965,-.6030057,.6783205],[-.5538289,.436339,.7214412],[-.2724557,.7738261,.5869894],[-.6997536,-.3618034,.6301101],[-.04383203,-.745356,.6783205],[-.4062656,-.7127322,.5869894],[.722762,.436339,.552104],[.4160667,.7738261,.4956583],[.8398294,-.3618034,.4258876],[.2191601,-.745356,.6434351],[.5452491,-.7127322,.460773],[-.7147284,.4891254,.5172187],[-.07268925,.8944272,.460773],[-.4333553,.8266125,.3827669],[-.8606531,-.309017,.4258876],[-.6320294,-.5921311,.5172187],[-.2018716,-.8550825,.4956583],[.8248546,.4891254,.3129962],[.1903029,.8944272,.4258876],[.5181594,.8266125,.2565505],[.9419221,-.309017,.1867798],[.7450156,-.5921311,.3345566],[.3241127,-.8550825,.4258876],[-.8727679,.3793989,.3345566],[-.6544916,.6842621,.3478816],[-.2335888,.9472136,.2565505],[-.7929289,-.5393447,.3129962],[-.9629544,-.1138803,.2781109],[-.096919,-.9648091,.2781109],[.9298072,.3793989,.09544872],[.7225533,.6842621,.1652194],[.2923956,.9472136,.1867798],[.8471082,-.5393447,.09544872],[1.002159,-.1138803,.01744268],[.1660732,-.9648091,.2432255],[-.8125311,.5745356,.1652194],[-.9675818,.1490712,.2432255],[-.1314961,1,.01744268],[-.8275059,-.5745356,.05232804],[-.9975315,-.1490712,.01744268],[-.1314961,-1,.01744268],[.8275059,.5745356,-.05232804],[.9975315,.1490712,-.01744268],[.1314961,1,-.01744268],[.8125311,-.5745356,-.1652194],[.9675818,-.1490712,-.2432255],[.1314961,-1,-.01744268],[-.8471082,.5393447,-.09544872],[-1.002159,.1138803,-.01744268],[-.1660732,.9648091,-.2432255],[-.7225533,-.6842621,-.1652194],[-.9298072,-.3793989,-.09544872],[-.2923956,-.9472136,-.1867798],[.7929289,.5393447,-.3129962],[.9629544,.1138803,-.2781109],[.096919,.9648091,-.2781109],[.6544916,-.6842621,-.3478816],[.8727679,-.3793989,-.3345566],[.2335888,-.9472136,-.2565505],[-.7450156,.5921311,-.3345566],[-.9419221,.309017,-.1867798],[-.3241127,.8550825,-.4258876],[-.8248546,-.4891254,-.3129962],[-.5181594,-.8266125,-.2565505],[-.1903029,-.8944272,-.4258876],[.6320294,.5921311,-.5172187],[.8606531,.309017,-.4258876],[.2018716,.8550825,-.4956583],[.7147284,-.4891254,-.5172187],[.4333553,-.8266125,-.3827669],[.07268925,-.8944272,-.460773],[-.8398294,.3618034,-.4258876],[-.5452491,.7127322,-.460773],[-.2191601,.745356,-.6434351],[-.722762,-.436339,-.552104],[-.4160667,-.7738261,-.4956583],[.6997536,.3618034,-.6301101],[.4062656,.7127322,-.5869894],[.04383203,.745356,-.6783205],[.5538289,-.436339,-.7214412],[.2724557,-.7738261,-.5869894],[-.7348768,.2520769,-.6434351],[-.4402965,.6030057,-.6783205],[-.6625252,-.2412023,-.7214412],[-.518368,-.5786893,-.6434351],[.541714,.2520769,-.8127722],[.248226,.6030057,-.7696515],[.4515276,-.2412023,-.8692179],[.3326926,-.5786893,-.7563265],[-.6671526,.02174919,-.7563265],[-.5351104,.372678,-.7696515],[-.4581312,-.3835526,-.8127722],[.4469001,.02174919,-.9041033],[.3159502,.372678,-.8825429],[.2303913,-.3835526,-.9041033],[-.4673861,.1423503,-.8825429],[-.2583647,-.2629515,-.9389886],[.2211363,.1423503,-.973874],[.00462747,-.2629515,-.973874],[-.2629922,0,-.973874],[0,0,-1.008759]],faces:[[0,1,4,2],[3,8,14,7],[5,10,18,11],[6,12,20,13],[9,17,25,16],[15,24,35,23],[19,28,41,29],[21,31,44,32],[22,33,45,34],[26,38,50,37],[27,40,51,39],[30,43,54,42],[36,48,60,49],[46,55,67,58],[47,59,65,53],[52,64,73,61],[56,62,74,68],[57,70,81,69],[63,75,87,76],[66,78,90,79],[71,82,94,83],[72,85,95,84],[77,89,99,88],[80,92,101,91],[86,96,105,97],[93,102,110,103],[98,107,113,106],[100,109,114,108],[104,111,116,112],[115,118,119,117],[0,2,6,13,8,3],[1,5,11,17,9,4],[7,14,22,34,24,15],[10,19,29,40,27,18],[12,21,32,43,30,20],[16,25,36,49,38,26],[23,35,47,53,41,28],[31,37,50,62,56,44],[33,46,58,70,57,45],[39,51,63,76,64,52],[42,54,66,79,67,55],[48,61,73,85,72,60],[59,71,83,89,77,65],[68,74,86,97,92,80],[69,81,93,103,94,82],[75,88,99,107,98,87],[78,91,101,109,100,90],[84,95,104,112,105,96],[102,108,114,118,115,110],[106,113,117,119,116,111],[0,3,7,15,23,28,19,10,5,1],[2,4,9,16,26,37,31,21,12,6],[8,13,20,30,42,55,46,33,22,14],[11,18,27,39,52,61,48,36,25,17],[24,34,45,57,69,82,71,59,47,35],[29,41,53,65,77,88,75,63,51,40],[32,44,56,68,80,91,78,66,54,43],[38,49,60,72,84,96,86,74,62,50],[58,67,79,90,100,108,102,93,81,70],[64,76,87,98,106,111,104,95,85,73],[83,94,103,110,115,117,113,107,99,89],[92,97,105,112,116,119,118,114,109,101]]},i.rhombicosidodecahedron={vertices:[[0,0,1.026054],[.447838,0,.9231617],[-.02363976,.4472136,.9231617],[-.4050732,.190983,.9231617],[-.1693344,-.4145898,.9231617],[.4241982,.4472136,.8202696],[.7673818,.190983,.6537868],[.5552827,-.4145898,.7566788],[-.2312241,.7562306,.6537868],[-.5744076,-.2236068,.8202696],[-.6126576,.5,.6537868],[.1738492,-.6708204,.7566788],[-.4669629,-.6381966,.6537868],[.493393,.7562306,.4873039],[.8748265,-.2236068,.4873039],[.8365765,.5,.320821],[.7054921,-.6381966,.3844118],[.08831973,.9472136,.3844118],[-.5434628,.809017,.320821],[-.8866463,-.1708204,.4873039],[-.9102861,.2763932,.3844118],[-.1237794,-.8944272,.4873039],[.3240586,-.8944272,.3844118],[-.7792016,-.5854102,.320821],[.6289922,.809017,.05144604],[1.010426,-.1708204,.05144604],[.9867859,.2763932,-.05144604],[.8410913,-.5854102,-.05144604],[-.223919,1,.05144604],[.223919,1,-.05144604],[-.8410913,.5854102,.05144604],[-.9867859,-.2763932,.05144604],[-1.010426,.1708204,-.05144604],[-.223919,-1,.05144604],[.223919,-1,-.05144604],[-.6289922,-.809017,-.05144604],[.7792016,.5854102,-.320821],[.9102861,-.2763932,-.3844118],[.8866463,.1708204,-.4873039],[.5434628,-.809017,-.320821],[-.3240586,.8944272,-.3844118],[.1237794,.8944272,-.4873039],[-.7054921,.6381966,-.3844118],[-.8365765,-.5,-.320821],[-.8748265,.2236068,-.4873039],[-.08831973,-.9472136,-.3844118],[-.493393,-.7562306,-.4873039],[.4669629,.6381966,-.6537868],[.6126576,-.5,-.6537868],[.5744076,.2236068,-.8202696],[.2312241,-.7562306,-.6537868],[-.1738492,.6708204,-.7566788],[-.5552827,.4145898,-.7566788],[-.7673818,-.190983,-.6537868],[-.4241982,-.4472136,-.8202696],[.1693344,.4145898,-.9231617],[.4050732,-.190983,-.9231617],[.02363976,-.4472136,-.9231617],[-.447838,0,-.9231617],[0,0,-1.026054]],faces:[[0,2,3],[1,6,5],[4,9,12],[7,16,14],[8,18,10],[11,21,22],[13,15,24],[17,29,28],[19,31,23],[20,30,32],[25,27,37],[26,38,36],[33,45,34],[35,43,46],[39,50,48],[40,41,51],[42,52,44],[47,49,55],[53,58,54],[56,57,59],[0,1,5,2],[0,3,9,4],[1,7,14,6],[2,8,10,3],[4,12,21,11],[5,6,15,13],[7,11,22,16],[8,17,28,18],[9,19,23,12],[10,18,30,20],[13,24,29,17],[14,16,27,25],[15,26,36,24],[19,20,32,31],[21,33,34,22],[23,31,43,35],[25,37,38,26],[27,39,48,37],[28,29,41,40],[30,42,44,32],[33,35,46,45],[34,45,50,39],[36,38,49,47],[40,51,52,42],[41,47,55,51],[43,53,54,46],[44,52,58,53],[48,50,57,56],[49,56,59,55],[54,58,59,57],[0,4,11,7,1],[2,5,13,17,8],[3,10,20,19,9],[6,14,25,26,15],[12,23,35,33,21],[16,22,34,39,27],[18,28,40,42,30],[24,36,47,41,29],[31,32,44,53,43],[37,48,56,49,38],[45,46,54,57,50],[51,55,59,58,52]]},i["snub dodecahedron"]={vertices:[[0,0,1.028031],[.4638569,0,.9174342],[.2187436,.4090409,.9174342],[-.2575486,.3857874,.9174342],[-.4616509,-.04518499,.9174342],[-.177858,-.4284037,.9174342],[.5726782,-.4284037,.7384841],[.8259401,-.04518499,.6104342],[.6437955,.3857874,.702527],[.349648,.7496433,.6104342],[-.421009,.7120184,.6104342],[-.6783139,.3212396,.702527],[-.6031536,-.4466658,.702527],[-.2749612,-.7801379,.6104342],[.1760766,-.6931717,.7384841],[.5208138,-.7801379,.4206978],[.8552518,-.4466658,.3547998],[1.01294,-.03548596,.1718776],[.7182239,.661842,.3208868],[.3633691,.9454568,.1758496],[-.04574087,.9368937,.4206978],[-.4537394,.905564,.1758496],[-.7792791,.5887312,.3208868],[-.9537217,.1462217,.3547998],[-.9072701,-.3283699,.3547998],[-.6503371,-.7286577,.3208868],[.08459482,-.9611501,.3547998],[.3949153,-.9491262,-.007072558],[.9360473,-.409557,-.1136978],[.9829382,.02692292,-.2999274],[.9463677,.4014808,-.007072558],[.6704578,.7662826,-.1419366],[-.05007646,1.025698,-.04779978],[-.4294337,.8845784,-.2999274],[-.9561681,.3719321,-.06525234],[-1.022036,-.1000338,-.04779978],[-.8659056,-.5502712,-.06525234],[-.5227761,-.8778535,-.1136978],[-.06856319,-1.021542,-.09273844],[.2232046,-.8974878,-.4489366],[.6515438,-.7200947,-.3373472],[.7969535,-.3253959,-.5619888],[.8066872,.4395354,-.461425],[.4468035,.735788,-.5619888],[.001488801,.8961155,-.503809],[-.3535403,.6537658,-.7102452],[-.7399517,.5547758,-.4489366],[-.9120238,.1102196,-.461425],[-.6593998,-.6182798,-.4896639],[-.2490651,-.8608088,-.503809],[.4301047,-.5764987,-.734512],[.5057577,-.1305283,-.8854492],[.5117735,.3422252,-.8232973],[.09739587,.5771941,-.8451093],[-.6018946,.2552591,-.7933564],[-.6879024,-.2100741,-.734512],[-.3340437,-.5171509,-.8232973],[.08570633,-.3414376,-.9658797],[.1277354,.1313635,-1.011571],[-.3044499,-.06760332,-.979586]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[1,6,7],[1,7,8],[1,8,2],[2,8,9],[3,10,11],[3,11,4],[4,12,5],[5,12,13],[5,13,14],[6,14,15],[6,15,16],[6,16,7],[7,16,17],[8,18,9],[9,18,19],[9,19,20],[10,20,21],[10,21,22],[10,22,11],[11,22,23],[12,24,25],[12,25,13],[13,26,14],[14,26,15],[15,26,27],[16,28,17],[17,28,29],[17,29,30],[18,30,31],[18,31,19],[19,32,20],[20,32,21],[21,32,33],[22,34,23],[23,34,35],[23,35,24],[24,35,36],[24,36,25],[25,36,37],[26,38,27],[27,38,39],[27,39,40],[28,40,41],[28,41,29],[29,42,30],[30,42,31],[31,42,43],[32,44,33],[33,44,45],[33,45,46],[34,46,47],[34,47,35],[36,48,37],[37,48,49],[37,49,38],[38,49,39],[39,50,40],[40,50,41],[41,50,51],[42,52,43],[43,52,53],[43,53,44],[44,53,45],[45,54,46],[46,54,47],[47,54,55],[48,55,56],[48,56,49],[50,57,51],[51,57,58],[51,58,52],[52,58,53],[54,59,55],[55,59,56],[56,59,57],[57,59,58],[0,5,14,6,1],[2,9,20,10,3],[4,11,23,24,12],[7,17,30,18,8],[13,25,37,38,26],[15,27,40,28,16],[19,31,43,44,32],[21,33,46,34,22],[29,41,51,52,42],[35,47,55,48,36],[39,49,56,57,50],[45,53,58,59,54]]},i["triangular prism"]={vertices:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],faces:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},i["pentagonal prism"]={vertices:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},i["hexagonal prism"]={vertices:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],faces:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},i["square pyramid"]={vertices:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],faces:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},i["pentagonal pyramid"]={vertices:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],faces:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},i["triangular bipyramid"]={vertices:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],faces:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},i["pentagonal bipyramid"]={vertices:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],faces:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]};var s=i[this.type];return null==s?(e.logger.c("no internal data associated to the name:"+this.type),null):t.dataToMamesh(s)},t}();t.Polyhedron=s,t.getPolyhedronAsync=i}(e.polyhedron||(e.polyhedron={}))}(mathis||(mathis={}));var mathis;!function(e){!function(i){var s=function(){function e(){}return e.prototype.permuteXYZ=function(e){if(3!=e.length)throw"xyzOrder must be an array of size 3 made with letter X,Y,Z";var t=this[e[0]],i=this[e[1]],s=this[e[2]];if(this.X=t,this.Y=i,this.Z=s,null==this.X||null==this.Y||null==this.Z)throw"xyzOrder must be an array of size 3 made with letter X,Y,Z";return this},e}();i.SurfaceEquation=s;var n=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[-e.PI,e.PI],i.rangeV=[-e.PI,e.PI],i.X=function(t,i){return-2/15*e.cos(t)*(3*e.cos(i)-30*e.sin(t)+90*Math.pow(e.cos(t),4)*e.sin(t)-60*Math.pow(e.cos(t),6)*e.sin(t)+5*e.cos(t)*e.cos(i)*e.sin(t))},i.Y=function(t,i){return-1/15*e.sin(t)*(3*e.cos(i)-3*Math.pow(e.cos(t),2)*e.cos(i)-48*Math.pow(e.cos(t),4)*e.cos(i)+48*Math.pow(e.cos(t),6)*e.cos(i)-60*e.sin(t)+5*e.cos(t)*e.cos(i)*e.sin(t)-5*Math.pow(e.cos(t),3)*e.cos(i)*e.sin(t)-80*Math.pow(e.cos(t),5)*e.cos(i)*e.sin(t)+80*Math.pow(e.cos(t),7)*e.cos(i)*e.sin(t))},i.Z=function(t,i){return 2/15*(3+5*e.cos(t)*e.sin(t))*e.sin(i)},i}return __extends(i,t),i}(s);i.KleinBottle=n;var r=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.r=2.1,i.X=function(t,s){return(i.r+e.cos(t/2)*e.sin(s)-e.sin(t/2)*e.sin(2*s))*e.cos(t)},i.Y=function(t,s){return(i.r+e.cos(t/2)*e.sin(s)-e.sin(t/2)*e.sin(2*s))*e.sin(t)},i.Z=function(t,i){return e.sin(t/2)*e.sin(i)+e.cos(t/2)*e.sin(2*i)},i}return __extends(i,t),i}(s);i.KleinBagel=r;var o=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.X=function(t,i){return e.cos(t)},i.Y=function(e,t){return t},i.Z=function(t,i){return e.sin(t)},i}return __extends(i,t),i}(s);i.Cylinder=o;var a=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[-e.PI,e.PI],i.rangeV=[-.5,.5],i.X=function(t,i){return(1-1*i*e.sin(t/2))*e.sin(t)},i.Y=function(t,i){return(1-1*i*e.sin(t/2))*e.cos(t)},i.Z=function(t,i){return 1*i*e.cos(t/2)},i}return __extends(i,t),i}(s);i.Moebius=a;var h=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.r=.3,i.a=.7,i.X=function(t,s){return(i.r*e.cos(t)+i.a)*e.cos(s)},i.Y=function(t,s){return(i.r*e.cos(t)+i.a)*e.sin(s)},i.Z=function(t,s){return i.r*e.sin(t)},i}return __extends(i,t),i}(s);i.Torus=h;var l=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.X=function(t,i){return 2/3*(e.cos(t)*e.cos(2*i)+e.sqrt(2)*e.sin(t)*e.cos(i))*e.cos(t)/(e.sqrt(2)-e.sin(2*t)*e.sin(3*i))},i.Y=function(t,i){return 2/3*(e.cos(t)*e.sin(2*i)-e.sqrt(2)*e.sin(t)*e.sin(i))*e.cos(t)/(e.sqrt(2)-e.sin(2*t)*e.sin(3*i))},i.Z=function(t,i){return-e.sqrt(2)*e.cos(t)*e.cos(t)/(e.sqrt(2)-e.sin(2*t)*e.sin(3*i))},i}return __extends(i,t),i}(s);i.Boy=l;var u=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.a=.5,i.D=function(t,s){return 2-i.a*e.sqrt(2)*e.sin(3*t)*e.sin(2*s)},i.X=function(t,i){return e.sqrt(2)*e.cos(2*t)*Math.pow(e.cos(i),2)+e.cos(t)*e.sin(2*i)},i.Y=function(t,i){return e.sqrt(2)*e.sin(2*i)*Math.pow(e.cos(i),2)-e.sin(t)*e.sin(2*i)},i.Z=function(t,s){return 3*Math.pow(e.cos(s),2)/i.D(t,s)},i}return __extends(i,t),i}(s);i.BoyAppery=u;var c=function(i){function s(){var s=null!==i&&i.apply(this,arguments)||this;return s.rangeU=[0,2*e.PI],s.rangeV=[0,2*e.PI],s.X=function(t,i){return(1+e.cos(i))*e.cos(t)},s.Y=function(t,i){return(1+e.cos(i))*e.sin(t)},s.Z=function(i,s){return t.tanh(i-e.PI)*e.sin(s)},s}return __extends(s,i),s}(s);i.CrossCappedDisk=c;var m=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.rangeU=[0,2*e.PI],i.rangeV=[0,2*e.PI],i.X=function(t,i){return i*e.cos(2*t)},i.Y=function(t,i){return i*e.sin(2*t)},i.Z=function(t,i){return i*e.cos(t)},i}return __extends(i,t),i}(s);i.SelfIntersectingDisk=m;var p=function(){function t(){this.m=[]}return t.prototype.XYZ=function(t,i){var s=new e.XYZ(0,0,0),n=0;n+=Math.pow(e.sin(this.m[0]*i),this.m[1]),n+=Math.pow(e.cos(this.m[2]*i),this.m[3]),n+=Math.pow(e.sin(this.m[4]*t),this.m[5]),n+=Math.pow(e.cos(this.m[6]*t),this.m[7]);var r=e.sin(i);return s.x=n*r*e.cos(t),s.y=n*e.cos(i),s.z=n*r*e.sin(t),s},t}();i.SphericalHarmonic=p;var d=function(t){function i(e){var i=t.call(this)||this;return i.originalEquation=e,i}return __extends(i,t),i.prototype.scale=function(t){var i=this;if(t instanceof e.XYZ){var s=t;this.X=function(e,t){return s.x*i.originalEquation.X()},this.Y=function(e,t){return s.y*i.originalEquation.Y()},this.Z=function(e,t){return s.z*i.originalEquation.Z()}}else{var n=t;this.X=function(e,t){return n*i.originalEquation.X()},this.Y=function(e,t){return n*i.originalEquation.Y()},this.Z=function(e,t){return n*i.originalEquation.Z()}}return this},i.prototype.permuteXYZ=function(e){if(3!=e.length)throw"xyzOrder must be an array of size 3 made with letter X,Y,Z";if(this.X=this.originalEquation[e[0]],this.Y=this.originalEquation[e[1]],this.Z=this.originalEquation[e[2]],null==this.X||null==this.Y||null==this.Z)throw"xyzOrder must be an array of size 3 made with letter X,Y,Z";return this},i}(s);i.SurfaceEquationModified=d}(e.equations||(e.equations={}));var t;!function(t){t.sinh=function(t){return(e.exp(t)-e.exp(-t))/2},t.cosh=function(t){return(e.exp(t)+e.exp(-t))/2},t.tanh=function(t){return(e.exp(t)-e.exp(-t))/(e.exp(t)+e.exp(-t))},t.sech=function(t){return 2/(e.exp(t)+e.exp(-t))},t.sechP=function(e){return-t.tanh(e)*t.sech(e)},t.sechPP=function(e){return-t.tanhP(e)*t.sech(e)-t.tanh(e)*t.sechP(e)},t.tanhP=function(e){var i=t.tanh(e);return 1-i*i},t.tanhPP=function(e){return-2*t.tanh(e)*t.tanhP(e)},t.tractrice=function(i){return new e.XYZ(t.sech(i),i-t.tanh(i),0)},t.tractriceP=function(i){return new e.XYZ(t.sechP(i),1-t.tanhP(i),0)},t.tractricePP=function(i){return new e.XYZ(t.sechPP(i),-t.tanhPP(i),0)},t.rotationYAxis=function(t){var i=new e.MM,s=e.cos(t),n=e.sin(t);return e.geo.numbersToMM(s,0,n,0,0,1,0,0,-n,0,s,0,0,0,0,1,i),i},t.rotationYAxisP=function(t){var i=new e.MM,s=e.cos(t),n=e.sin(t);return e.geo.numbersToMM(-n,0,s,0,0,0,0,0,-s,0,-n,0,0,0,0,1,i),i},t.rotationYAxisPP=function(t){var i=new e.MM,s=e.cos(t),n=e.sin(t);return e.geo.numbersToMM(-s,0,-n,0,0,0,0,0,n,0,-s,0,0,0,0,1,i),i}}(t=e.specialFunctions||(e.specialFunctions={}));!function(i){var s=function(){function t(){this.orientationCoef=1,this.unit=1,this.point=new e.XYZ(0,0,0),this._meanLinkLengthAtArrival=null}return t.prototype.xyzToUV=function(t,i){if(void 0===i&&(i=!1),null==this.maillage)throw"you must give a maillage to use xyzToUV ";for(var s=new e.UV(0,0),n=Number.MAX_VALUE,r=Number.MAX_VALUE,o=null,a=0,h=this.maillage.vertices;a<h.length;a++){var l=(o=h[a]).position.x,u=o.position.y;this.point.copyFrom(this.X(l,u));var c=e.geo.distance(this.point,t);if(c<n&&(n=c,s.u=l,s.v=u),o.hasMark(e.Vertex.Markers.border)){var m=e.geo.distance(t,this.point);m<r&&(r=m)}}return(i||null==this._meanLinkLengthAtArrival)&&(this._meanLinkLengthAtArrival=this.meanLinkLengthAtArrival()),n<1.1*this._meanLinkLengthAtArrival?{uv:s,distToBorder:r,distToNearestArrivalMesh:n}:null},t.prototype.e=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuu(t,i))},t.prototype.f=function(t,i){return e.geo.dot(this.newN(t,i),this.Xuv(t,i))},t.prototype.g=function(t,i){return e.geo.dot(this.newN(t,i),this.Xvv(t,i))},t.prototype.E=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xu(t,i))},t.prototype.F=function(t,i){return e.geo.dot(this.Xu(t,i),this.Xv(t,i))},t.prototype.G=function(t,i){return e.geo.dot(this.Xv(t,i),this.Xv(t,i))},t.prototype.createArrivalMeshFromMaillage=function(){var t=this,i=new e.mameshModification.MameshDeepCopier(this.maillage);i.copyCutSegmentsDico=!1,this.arrivalOpenMesh=i.go(),this.arrivalOpenMesh.vertices.forEach(function(e){var i=e.position.x,s=e.position.y;e.position=t.X(i,s)})},t.prototype.dNinTangentBasis=function(t,i){var s=new e.M22,n=this.e(t,i),r=this.f(t,i),o=this.g(t,i),a=this.E(t,i),h=this.F(t,i),l=this.G(t,i),u=a*l-h*h;return s.m11=(r*h-n*l)/u,s.m12=(o*h-r*l)/u,s.m21=(n*h-r*a)/u,s.m22=(r*h-o*a)/u,s},t.prototype.dNaction=function(e,t,i){var s=this.dNinTangentBasis(e,t),n=this.canonicalToTangentBasis(e,t,i),r=s.multiplyUV(n);return this.tagentToCanonicalBasis(e,t,r)},t.prototype.canonicalToTangentBasis=function(t,i,s){var n=this.Xu(t,i),r=this.Xv(t,i),o=new e.M22;o.m11=n.x,o.m21=n.y,o.m21=r.x,o.m22=r.y;var a=o.inverse();cc(a.determinant());var h=new e.UV(s.x,s.y);return a.multiplyUV(h)},t.prototype.tagentToCanonicalBasis=function(e,t,i){var s=this.Xu(e,t),n=this.Xv(e,t);return s.scale(i.u),n.scale(i.v),s.add(n)},t.prototype.newN=function(t,i){var s=new e.XYZ(0,0,0);return e.geo.cross(this.Xu(t,i),this.Xv(t,i),s),s.normalize().scale(this.unit*this.orientationCoef),s},t.prototype.meanLinkLengthAtArrival=function(){var t=this,i=0,s=0;return this.maillage.vertices.forEach(function(n){n.links.forEach(function(r){s++,i+=e.geo.distance(t.X(n.position.x,n.position.y),t.X(r.to.position.x,r.to.position.y))})}),i/s},t}();i.Carte=s;var n=function(){function t(){this.cartes=[]}return t.prototype.drawTheWholeSurface=function(e){this.drawOneMesh(this.wholeSurfaceMesh,e)},t.prototype.drawOneCarte=function(e,t){this.drawOneMesh(this.cartes[e].arrivalOpenMesh,t)},t.prototype.drawOneMesh=function(t,i){var s=new e.visu3d.LinesViewer(t,i);s.radiusAbsolute=.01,s.go().forEach(function(e){return e.isPickable=!1});var n=new e.visu3d.SurfaceViewer(t,i);n.alpha=.5;n.go()},t.prototype.findBestCarte=function(e){var t=-1,i=null,s=null;if(this.cartes.forEach(function(n){var r=n.xyzToUV(e);null!=r&&r.distToBorder>t&&(t=r.distToBorder,i=n,s=r.uv)}),null==s)throw cc("the point which is not in any cart arrival is:",e.toString()),"strange, the xyz do not belong to any carte-arrival";return{uv:s,carte:i}},t}();i.Surface=n;var r;!function(e){e[e.selle=0]="selle",e[e.cylinder=1]="cylinder",e[e.torus=2]="torus",e[e.pseudoSphere=3]="pseudoSphere"}(r=i.SurfaceName||(i.SurfaceName={}));var o=function(){function o(t){this.vertexToCarte=new e.HashMap,this.carteIndexToMinimalArrivalMesh=[],this.surfaceName=t}return o.prototype.go=function(){if(this.surface=new n,this.surface.cartes=[],this.surfaceName==r.torus){var o=function(t,i){var n=new e.reseau.BasisForRegularReseau;n.origin=t,n.end=i,n.nbU=32,n.nbV=64;var r=new e.reseau.Regular2d(n).go(),o=new e.reseau.Regular2d(n).go(),a=.3,h=.7,l=new s;return l.maillage=r,l.arrivalOpenMesh=o,l.X=function(t,i){return new e.XYZ((a*e.cos(t)+h)*e.cos(i),(a*e.cos(t)+h)*e.sin(i),a*e.sin(t))},l.Xu=function(t,i){return new e.XYZ(-a*e.sin(t)*e.cos(i),-a*e.sin(t)*e.sin(i),a*e.cos(t))},l.Xv=function(t,i){return new e.XYZ(-(a*e.cos(t)+h)*e.sin(i),(a*e.cos(t)+h)*e.cos(i),0)},l.Xuu=function(t,i){return new e.XYZ(-a*e.cos(t)*e.cos(i),-a*e.cos(t)*e.sin(i),-a*e.sin(t))},l.Xuv=function(t,i){return new e.XYZ(a*e.sin(t)*e.sin(i),-a*e.sin(t)*e.cos(i),0)},l.Xvv=function(t,i){return new e.XYZ(-(a*e.cos(t)+h)*e.cos(i),-(a*e.cos(t)+h)*e.sin(i),0)},o.vertices.forEach(function(e){var t=e.position.x,i=e.position.y;e.position=l.X(t,i)}),l},a=.1;this.surface.cartes.push(o(new e.XYZ(a,a,0),new e.XYZ(2*e.PI-a,2*e.PI-a,0))),this.surface.cartes.push(o(new e.XYZ(-e.PI+a,-e.PI+a,0),new e.XYZ(e.PI-a,e.PI-a,0))),this.surface.wholeSurfaceMesh=o(new e.XYZ(0,0,0),new e.XYZ(2*e.PI,2*e.PI,0)).arrivalOpenMesh}else if(this.surfaceName==r.cylinder){var o=function(t,i){var n=new e.reseau.BasisForRegularReseau;n.origin=t,n.end=i,n.nbU=41,n.nbV=41;var r=new e.reseau.Regular2d(n).go(),o=new e.reseau.Regular2d(n).go(),a=new s;return a.maillage=r,a.arrivalOpenMesh=o,a.X=function(t,i){return new e.XYZ(.5*e.cos(t),i,.5*e.sin(t))},a.Xu=function(t,i){return new e.XYZ(-.5*e.sin(t),0,.5*e.cos(t))},a.Xv=function(t,i){return new e.XYZ(0,1,0)},a.Xuu=function(t,i){return new e.XYZ(-.5*e.cos(t),0,-.5*e.sin(t))},a.Xuv=function(t,i){return new e.XYZ(0,0,0)},a.Xvv=function(t,i){return new e.XYZ(0,0,0)},o.vertices.forEach(function(e){var t=e.position.x,i=e.position.y;e.position=a.X(t,i)}),a},a=.3;this.surface.cartes.push(o(new e.XYZ(a,-.5,0),new e.XYZ(2*e.PI-a,.5,0))),this.surface.cartes.push(o(new e.XYZ(a-e.PI,-.5,0),new e.XYZ(e.PI-a,.5,0))),this.surface.wholeSurfaceMesh=o(new e.XYZ(0,-.5,0),new e.XYZ(2*Math.PI,.5,0)).arrivalOpenMesh}else if(this.surfaceName==r.pseudoSphere){var o=function(s,n){var r=new e.reseau.BasisForRegularReseau;r.origin=s,r.end=n,r.nbU=33,r.nbV=21;var o=new e.reseau.Regular2d(r).go(),a=new e.reseau.Regular2d(r).go(),h=new i.RotationCarteMaker(t.tractrice);h.translation=new e.XYZ(0,-1,0);h.scaling=new e.XYZ(1,1,1),h.curveP=t.tractriceP,h.curvePP=t.tractricePP;var l=h.go();return l.maillage=o,l.arrivalOpenMesh=a,a.vertices.forEach(function(e){var t=e.position.x,i=e.position.y;e.position=l.X(t,i)}),l},a=.3;this.surface.cartes.push(o(new e.XYZ(a,.1,0),new e.XYZ(2*e.PI-a,3.5,0))),this.surface.cartes.push(o(new e.XYZ(-e.PI+a,.1,0),new e.XYZ(e.PI-a,3.5,0))),this.surface.wholeSurfaceMesh=o(new e.XYZ(0,.1,0),new e.XYZ(2*e.PI,3.5,0)).arrivalOpenMesh}else{if(this.surfaceName!=r.selle)throw"not yet";o=function(t,i){var n=new e.reseau.BasisForRegularReseau;n.origin=t,n.end=i,n.nbU=41,n.nbV=41;var r=new e.reseau.Regular2d(n).go(),o=new e.reseau.Regular2d(n).go(),a=new s;return a.maillage=r,a.arrivalOpenMesh=o,a.X=function(t,i){return new e.XYZ(t,i,i*i-t*t)},a.Xu=function(t,i){return new e.XYZ(1,0,-2*t)},a.Xv=function(t,i){return new e.XYZ(0,1,2*i)},a.Xuu=function(t,i){return new e.XYZ(0,0,-2)},a.Xuv=function(t,i){return new e.XYZ(0,0,0)},a.Xvv=function(t,i){return new e.XYZ(0,0,2)},o.vertices.forEach(function(e){var t=e.position.x,i=e.position.y;e.position=a.X(t,i)}),a};this.surface.cartes.push(o(new e.XYZ(-.7,-.7,0),new e.XYZ(.7,.7,0))),this.surface.wholeSurfaceMesh=o(new e.XYZ(-.7,-.7,0),new e.XYZ(.7,.7,0)).arrivalOpenMesh}return this.makeMinimalMeshesForEachCarte(),this.surface},o.prototype.makeMinimalMeshesForEachCarte=function(){for(var t=this,i=this,s=0;s<this.surface.cartes.length;s++)!function(s){var n=i.surface.cartes[s],r=[];n.arrivalOpenMesh.vertices.forEach(function(e){t.surface.findBestCarte(e.position).carte==n&&(t.vertexToCarte.putValue(e,n),r.push(e))});var o=new e.grateAndGlue.SubMameshExtractor(n.arrivalOpenMesh,r).go();i.carteIndexToMinimalArrivalMesh[s]=o}(s)},o}();i.SurfaceMaker=o;var a=function(){function i(t){this.translation=new e.XYZ(0,0,0),this.scaling=new e.XYZ(1,1,1),this.curve=t}return i.prototype.go=function(){var i=this,n=new s;return n.X=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxis(s),i.curve(n),r),r.resizes(i.scaling).add(i.translation),r},n.Xu=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxisP(s),i.curve(n),r),r.resizes(i.scaling),r},n.Xuu=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxisPP(s),i.curve(n),r),r.resizes(i.scaling),r},n.Xv=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxis(s),i.curveP(n),r),r.resizes(i.scaling),r},n.Xvv=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxis(s),i.curvePP(n),r),r.resizes(i.scaling),r},n.Xuv=function(s,n){var r=new e.XYZ(0,0,0);return e.geo.multiplicationMatrixVector(t.rotationYAxisP(s),i.curveP(n),r),r.resizes(i.scaling),r},n},i}();i.RotationCarteMaker=a}(e.riemann||(e.riemann={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(t){this.referenceDistanceBetweenVertexWithZeroDichoLevel=.1,this.deformationFromCenterVersusFromDirection=!0,this.center=new e.XYZ(0,0,0),this.direction=new e.XYZ(0,0,1),this.alpha=1.7,this.beta=.7,this.seed=22345,this.mamesh=t}return t.prototype.go=function(){this.simuStable=new e.proba.StableLaw,this.simuStable.alpha=this.alpha,this.simuStable.beta=this.beta,this.simuStable.nbSimu=this.mamesh.vertices.length;var t=new e.proba.Random(this.seed);this.simuStable.basicGenerator=function(){return t.pseudoRand()};for(var i=this.simuStable.go(),s=!0,n=0,r=0,o=new e.XYZ(0,0,0),a=new e.XYZ(0,0,0);s;){s=!1;for(var h in this.mamesh.cutSegmentsDico){var l=this.mamesh.cutSegmentsDico[h];if(Math.max(l.a.dichoLevel,l.b.dichoLevel)==r){s=!0;var u=i[n++]*Math.pow(this.referenceDistanceBetweenVertexWithZeroDichoLevel/Math.pow(2,r),1/this.simuStable.alpha);e.geo.between(l.a.position,l.b.position,.5,o),this.deformationFromCenterVersusFromDirection?(o.substract(this.center),o.scale(1+u)):(a.copyFrom(this.direction).scale(u),o.add(a)),l.middle.position.copyFrom(o)}}r++}},t}();t.StableRandomFractal=i}(e.fractal||(e.fractal={}))}(mathis||(mathis={}));var mathis;!function(e){!function(t){var i=function(){function t(e){this.nbActionsPerIteration=1e3,this.q=Number.POSITIVE_INFINITY,this.beta=.01,this.graph=e}return t.prototype.checkArgs=function(){if(null==this.q||null==this.beta)throw"q or beta is null";if(this.q<=0)throw"q must be positive"},t.prototype.go=function(){this.checkArgs(),this.q==Number.POSITIVE_INFINITY?this.possibleValues=[-1,1]:this.possibleValues=[-1,0,1],this.initialisation()},t.prototype.iterateAndGetChangedVertices=function(){for(var t=new e.HashMap(!0),i=0;i<this.nbActionsPerIteration;i++){var s=void 0,n=void 0;if(this.beta!=Number.POSITIVE_INFINITY){r=Math.floor(Math.random()*this.graph.length);s=this.graph[r],n=this.newValue()}else for(;;){var r=Math.floor(Math.random()*this.graph.length);s=this.graph[r],n=this.newValue();for(var o=0,a=s.links;o<a.length;o++)if(a[o].to.customerObject.value*n==-1){!1;break}}var h=this.energyRatio(s,n);(h>=1||Math.random()<h)&&(s.customerObject.value=n,t.putValue(s,n))}return t},t.prototype.newValue=function(){var e=Math.floor(Math.random()*this.possibleValues.length);return this.possibleValues[e]},t.prototype.energyRatio=function(e,t){var i=1;if(1!=this.q&&this.q!=Number.POSITIVE_INFINITY&&(i=Math.pow(this.q,Math.abs(t)-Math.abs(e.customerObject.value))),0!=this.beta&&this.beta!=Number.POSITIVE_INFINITY){var s=t-e.customerObject.value;if(0!=this.beta&&this.beta!=Number.POSITIVE_INFINITY){var n=0;e.links.forEach(function(e){n+=s*e.to.customerObject.value}),i*=Math.exp(this.beta*n)}}return i},t.prototype.initialisation=function(){this.graph.forEach(function(e){e.customerObject.value=0})},t}();t.IsingModel=i}(e.metropolis||(e.metropolis={}))}(mathis||(mathis={}));var mathis;!function(e){!function(e){function t(e,t){var i,s=!1;return function(){var n;if(s)n=i,s=!1;else{var r,o,a;do{a=(r=2*Math.random()-1)*r+(o=2*Math.random()-1)*o}while(a>=1);n=r*(a=Math.sqrt(-2*Math.log(a)/a)),i=o*a,s=!0}var h=e+t*n;return h>0?h:-h}}var i=function(){function e(e){void 0===e&&(e=1234567),this.seed=e}return e.prototype.pseudoRand=function(){var e=Math.pow(2,32);return this.seed+=this.seed*this.seed|5,(this.seed>>>32)/e},e.prototype.pseudoRandInt=function(e){var t=Math.floor(e*this.pseudoRand());return t==e&&t--,t},e}();e.Random=i;var s=function(){function e(){this.mean=0,this.stdev=1,this.knuthVersusBowMuller=!0,this.use_last=!1}return e.prototype.go=function(){return this.knuthVersusBowMuller?this.knuth():this.bowMuller()},e.prototype.bowMuller=function(){var e=1-Math.random(),t=1-Math.random();return this.mean+this.stdev*Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)},e.prototype.knuth=function(){var e;if(this.use_last)e=this.y2,this.use_last=!1;else{var t,i,s;do{s=(t=2*Math.random()-1)*t+(i=2*Math.random()-1)*i}while(s>=1);e=t*(s=Math.sqrt(-2*Math.log(s)/s)),this.y2=i*s,this.use_last=!0}var n=this.mean+this.stdev*e;return n>0?n:-n},e}();e.Gaussian=s,e.gaussian=t;var n=function(){function e(){this.nbSimu=1,this.alpha=1.5,this.beta=0,this.sigma=1,this.mu=0,this.basicGenerator=Math.random}return e.prototype.checkArgs=function(){if(this.alpha>2||this.alpha<=0)throw"alpha must be in (0,2]";if(this.beta<-1||this.beta>1)throw"beta must be in [-1,1]"},e.prototype.go=function(){this.checkArgs();for(var e=[],t=0;t<this.nbSimu;t++){var i=this.basicGenerator()*Math.PI-Math.PI/2,s=-Math.log(this.basicGenerator());if(1!=this.alpha){var n=Math.tan(Math.PI*this.alpha/2),r=Math.atan(this.beta*n)/this.alpha,o=1+this.beta^2*n^2^.5/this.alpha;e[t]=o*Math.sin(this.alpha*(i+r))/Math.pow(Math.cos(i),1/this.alpha)*Math.pow(Math.cos(i-this.alpha*(i+r))/s,(1-this.alpha)/this.alpha),e[t]=this.sigma*e[t]+this.mu}else 1==this.alpha&&(e[t]=2/Math.PI*((Math.PI/2+this.beta*i)*Math.tan(i)-this.beta*Math.log(s*Math.cos(i)/(Math.PI/2+this.beta*i))),e[t]=this.sigma*e[t]+2/Math.PI*this.beta*this.sigma*Math.log(this.sigma)+this.mu)}return e},e}();e.StableLaw=n}(e.proba||(e.proba={}))}(mathis||(mathis={}));